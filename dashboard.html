<!DOCTYPE html>
<html lang="en-GB">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Spark Your Potential</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            padding: 40px;
            color: #333;
        }
        .container { max-width: 1000px; margin: 0 auto; }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }
        .header h1 {
            font-size: 2.5em;
            font-weight: 800;
            margin-bottom: 10px;
        }
        .header .subtitle {
            font-size: 1.2em;
            opacity: 0.8;
        }
        .user-name {
            font-size: 1.3em;
            color: #FFB627;
            margin-top: 15px;
            font-weight: 600;
        }

        /* User Menu */
        .user-menu {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .user-email {
            color: white;
            opacity: 0.8;
            font-size: 0.9em;
        }
        .logout-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 0.85em;
            cursor: pointer;
            transition: all 0.2s;
        }
        .logout-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        /* Login Section */
        .login-section {
            background: white;
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        .login-section h2 {
            color: #667eea;
            margin-bottom: 20px;
        }
        .login-section p {
            color: #666;
            margin-bottom: 25px;
        }
        .email-input {
            width: 100%;
            max-width: 400px;
            padding: 15px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1em;
            margin-bottom: 15px;
        }
        .email-input:focus {
            outline: none;
            border-color: #667eea;
        }
        .login-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 10px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        /* Dashboard Content */
        .dashboard-content { display: none; }
        .dashboard-content.visible { display: block; }

        /* Tool Cards Grid */
        .tools-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }

        .tool-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .tool-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 50px rgba(0,0,0,0.3);
        }

        .tool-icon {
            font-size: 2.5em;
            margin-bottom: 15px;
        }
        .tool-title {
            font-size: 1.3em;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        .tool-description {
            color: #666;
            font-size: 0.95em;
            line-height: 1.6;
            margin-bottom: 20px;
        }
        .tool-status {
            font-size: 0.85em;
            padding: 6px 12px;
            border-radius: 20px;
            display: inline-block;
            margin-bottom: 15px;
        }
        .status-complete {
            background: #e5ffe5;
            color: #4CAF50;
        }
        .status-pending {
            background: #fff3e0;
            color: #FF9800;
        }
        .status-locked {
            background: #f5f5f5;
            color: #999;
        }

        .tool-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .tool-btn {
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 0.9em;
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: all 0.2s;
        }
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        .btn-secondary {
            background: #f0f0f0;
            color: #555;
        }
        .btn-secondary:hover {
            background: #e0e0e0;
        }
        .btn-disabled {
            background: #e0e0e0;
            color: #999;
            cursor: not-allowed;
        }

        /* Quick Stats */
        .stats-bar {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px 30px;
            display: flex;
            justify-content: space-around;
            margin-bottom: 30px;
            color: white;
        }
        .stat-item {
            text-align: center;
        }
        .stat-value {
            font-size: 2em;
            font-weight: 700;
            color: #FFB627;
        }
        .stat-label {
            font-size: 0.85em;
            opacity: 0.8;
            margin-top: 5px;
        }

        /* Footer */
        .footer {
            text-align: center;
            color: white;
            opacity: 0.6;
            margin-top: 40px;
            font-size: 0.9em;
        }

        /* Responsive */
        @media (max-width: 600px) {
            body { padding: 20px; }
            .header h1 { font-size: 1.8em; }
            .stats-bar { flex-direction: column; gap: 20px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- User Menu (shown when logged in) -->
        <div class="user-menu" id="userMenu" style="display: none;">
            <span class="user-email" id="userEmail"></span>
            <button class="logout-btn" onclick="logout()">Log out</button>
        </div>

        <div class="header">
            <h1>‚ö° Your Career Toolkit</h1>
            <div class="subtitle">Spark Your Potential</div>
            <div class="user-name" id="userName"></div>
        </div>

        <!-- Login Section -->
        <div class="login-section" id="loginSection">
            <h2>Welcome Back</h2>
            <p>Enter your credentials to access your career toolkit</p>
            <input type="email" class="email-input" id="emailInput" placeholder="your@email.com">
            <br>
            <input type="password" class="email-input" id="passwordInput" placeholder="Password" style="margin-top: 10px;">
            <br>
            <button class="login-btn" onclick="login()">Login</button>
            <p id="loginError" style="color: #e74c3c; margin-top: 15px; display: none;"></p>
            <div style="margin-top: 30px; padding-top: 30px; border-top: 1px solid #e0e0e0;">
                <p style="color: #888; margin-bottom: 15px;">Want to see how it works first?</p>
                <button class="login-btn" style="background: linear-gradient(135deg, #FF6B35 0%, #FFB627 100%);" onclick="loadDemo()">
                    Try Demo (Sarah Mitchell)
                </button>
                <button class="login-btn" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); margin-top: 10px;" onclick="loadCoach()">
                    üî• Coach Mode (Lisa)
                </button>
            </div>
        </div>

        <!-- Coach Mode - Client Management (visible only to Lisa) -->
        <div class="coach-mode" id="coachMode" style="display: none;">
            <div style="background: linear-gradient(135deg, #FF6B35 0%, #FFB627 100%); color: white; border-radius: 15px; padding: 30px; margin-bottom: 30px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <div>
                        <h2 style="font-size: 1.8em; margin-bottom: 5px;">üî• Coach Mode</h2>
                        <p style="opacity: 0.9;">Manage your Career Booster clients</p>
                    </div>
                    <button onclick="addNewClient()" style="background: white; color: #FF6B35; border: none; padding: 12px 25px; border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 1em;">
                        + Add New Client
                    </button>
                </div>

                <!-- Client List -->
                <div id="clientList" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 15px;">
                    <!-- Client cards will be populated here -->
                </div>
            </div>

            <!-- Journey View (shown when client selected) -->
            <div id="journeyView" style="display: none; background: white; border-radius: 15px; padding: 30px; margin-bottom: 30px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                    <div>
                        <h3 id="journeyClientName" style="color: #667eea; font-size: 1.5em;"></h3>
                        <p id="journeyClientStatus" style="color: #666;"></p>
                    </div>
                    <button onclick="closeJourneyView()" style="background: #f0f0f0; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer;">‚Üê Back</button>
                </div>

                <!-- 4-Week Journey Timeline -->
                <div id="journeyTimeline" style="display: flex; gap: 10px; justify-content: space-between; margin-bottom: 30px;">
                    <!-- Week cards will be populated here -->
                </div>

                <!-- Week Actions -->
                <div id="weekActions" style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                    <!-- Actions for current week -->
                </div>
            </div>
        </div>

        <!-- Dashboard Content -->
        <div class="dashboard-content" id="dashboardContent">
            <!-- Stats Bar -->
            <div class="stats-bar">
                <div class="stat-item">
                    <div class="stat-value" id="blueprintCount">0</div>
                    <div class="stat-label">Blueprints</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="toolsComplete">0/5</div>
                    <div class="stat-label">Tools Used</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="lastUpdated">-</div>
                    <div class="stat-label">Last Updated</div>
                </div>
            </div>

            <!-- Tools Grid -->
            <div class="tools-grid">
                <!-- Step 1: Questionnaire -->
                <div class="tool-card" id="questionnaireCard">
                    <div class="tool-icon">üìù</div>
                    <div class="tool-title">Discovery Questionnaire</div>
                    <div class="tool-status status-complete" id="questionnaireStatus">‚úì Completed</div>
                    <div class="tool-description">
                        Deep reflection questions about your patterns, superpowers, and career journey. Your answers fuel the analysis.
                    </div>
                    <div class="tool-actions">
                        <button class="tool-btn btn-primary" onclick="openQuestionnaire()">View Responses</button>
                    </div>
                </div>

                <!-- Step 2: Career Insights Report - ¬£99 Deliverable -->
                <div class="tool-card" style="border: 2px solid #667eea;">
                    <div class="tool-icon">üìä</div>
                    <div class="tool-title">Career Insights Report</div>
                    <div class="tool-status status-complete" id="reportStatus">‚úì Completed</div>
                    <div class="tool-description">
                        Lisa's deep-dive analysis of your questionnaire responses. Your core pattern, unique thread, and career direction.
                    </div>
                    <div class="tool-actions">
                        <button class="tool-btn btn-primary" onclick="openInsightsReport()">View Report</button>
                    </div>
                </div>

                <!-- Step 3: Career Blueprint - Built through coaching -->
                <div class="tool-card" id="blueprintCard">
                    <div class="tool-icon">üìò</div>
                    <div class="tool-title">Transformation Blueprint</div>
                    <div class="tool-status status-complete" id="blueprintStatus">‚úì Completed</div>
                    <div class="tool-description">
                        Your complete positioning document built through coaching sessions. Evidence, belief moments, unique thread.
                    </div>
                    <div class="tool-actions">
                        <button class="tool-btn btn-primary" id="openBlueprintBtn" onclick="openBlueprint()">View Blueprint</button>
                    </div>
                </div>

                <!-- CV Builder -->
                <div class="tool-card" id="cvCard">
                    <div class="tool-icon">üìù</div>
                    <div class="tool-title">CV Builder</div>
                    <div class="tool-status status-locked" id="cvStatus">Requires Blueprint</div>
                    <div class="tool-description">
                        Build your CV with fields pre-filled from your Blueprint. Edit and refine your positioning.
                    </div>
                    <div class="tool-actions">
                        <button class="tool-btn btn-disabled" id="openCvBtn" onclick="openCVBuilder()" disabled>Open Builder</button>
                        <button class="tool-btn btn-secondary btn-disabled" id="exportCvBtn" onclick="exportCV()" disabled>Export PDF</button>
                    </div>
                </div>

                <!-- Mapping Guide -->
                <div class="tool-card">
                    <div class="tool-icon">üó∫Ô∏è</div>
                    <div class="tool-title">Mapping Guide</div>
                    <div class="tool-status status-pending">Reference</div>
                    <div class="tool-description">
                        A visual guide showing where your Blueprint content goes across LinkedIn, CV, and interviews.
                    </div>
                    <div class="tool-actions">
                        <button class="tool-btn btn-primary" onclick="openMappingGuide()">View Guide</button>
                    </div>
                </div>

                <!-- Decision Framework -->
                <div class="tool-card">
                    <div class="tool-icon">‚öñÔ∏è</div>
                    <div class="tool-title">Decision Framework</div>
                    <div class="tool-status status-locked" id="decisionStatus">Requires Blueprint</div>
                    <div class="tool-description">
                        Evaluate opportunities against your red flags and green flags. Score roles objectively.
                    </div>
                    <div class="tool-actions">
                        <button class="tool-btn btn-disabled" id="openDecisionBtn" onclick="openDecisionFramework()" disabled>Open Scorecard</button>
                    </div>
                </div>

                <!-- AI Prompt Library -->
                <div class="tool-card">
                    <div class="tool-icon">ü§ñ</div>
                    <div class="tool-title">AI Prompt Library</div>
                    <div class="tool-status status-pending">Ready</div>
                    <div class="tool-description">
                        Ready-to-use AI prompts for cover letters, LinkedIn posts, interview prep, and more.
                    </div>
                    <div class="tool-actions">
                        <button class="tool-btn btn-primary" onclick="openPromptLibrary()">Browse Prompts</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="footer">
            Spark Your Potential by Harness the Spark | harnessthespark.co.uk
        </div>
    </div>

    <script>
        // State
        let currentUser = null;
        let currentBlueprint = null;

        // Client Database (simulated - in production this would be a backend)
        const CLIENT_DATABASE = {
            'donald@example.com': {
                id: 'donald-001',
                name: 'Donald Pirie',
                email: 'donald@example.com',
                folder: 'Donald',
                status: 'complete', // 'pre-programme', 'week-1', 'week-2', 'week-3', 'week-4', 'complete'
                enrolledDate: '2024-10-20',
                completedDate: '2024-11-24',
                progress: {
                    questionnaire: true,
                    insightsReport: true,
                    blueprint: true,
                    decisionFramework: true,
                    cvBuilder: true,
                    mappingGuide: true
                }
            },
            'sarah@demo.com': {
                id: 'demo-sarah',
                name: 'Sarah Mitchell',
                email: 'sarah@demo.com',
                folder: '',
                status: 'complete',
                enrolledDate: '2024-09-15',
                completedDate: '2024-10-15',
                progress: {
                    questionnaire: true,
                    insightsReport: true,
                    blueprint: true,
                    decisionFramework: true,
                    cvBuilder: true,
                    mappingGuide: true
                }
            }
        };

        // Week descriptions for journey display
        const WEEK_INFO = {
            'pre-programme': { label: 'Pre-Programme', icon: 'üìã', description: 'Welcome & Questionnaire' },
            'week-1': { label: 'Week 1', icon: 'üå±', description: 'Foundation - Patterns & Evidence' },
            'week-2': { label: 'Week 2', icon: 'üß≠', description: 'Direction - Insights & Decisions' },
            'week-3': { label: 'Week 3', icon: 'üéØ', description: 'Positioning - Brand & Headlines' },
            'week-4': { label: 'Week 4', icon: 'üöÄ', description: 'Implementation - CV & LinkedIn' },
            'complete': { label: 'Complete', icon: 'üèÜ', description: 'Programme Finished' }
        };

        // Check for existing session
        window.onload = function() {
            const savedUser = localStorage.getItem('syp_user');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                showDashboard();
            }
        };

        // Login with password
        async function login() {
            const email = document.getElementById('emailInput').value.trim();
            const password = document.getElementById('passwordInput').value;
            const errorEl = document.getElementById('loginError');

            errorEl.style.display = 'none';

            if (!email || !email.includes('@')) {
                errorEl.textContent = 'Please enter a valid email address';
                errorEl.style.display = 'block';
                return;
            }

            if (!password) {
                errorEl.textContent = 'Please enter your password';
                errorEl.style.display = 'block';
                return;
            }

            try {
                const response = await fetch('/api/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });

                const data = await response.json();
                if (data.success) {
                    currentUser = data.user;
                    localStorage.setItem('syp_user', JSON.stringify(currentUser));
                    showDashboard();
                } else {
                    errorEl.textContent = data.error || 'Login failed';
                    errorEl.style.display = 'block';
                }
            } catch (error) {
                console.error('Login error:', error);
                errorEl.textContent = 'Could not connect to server. Please try again.';
                errorEl.style.display = 'block';
            }
        }

        // Show dashboard after login
        async function showDashboard() {
            document.getElementById('loginSection').style.display = 'none';
            document.getElementById('dashboardContent').classList.add('visible');
            document.getElementById('userName').textContent = `Welcome, ${currentUser.name || currentUser.email}`;

            // Show user menu
            document.getElementById('userMenu').style.display = 'flex';
            document.getElementById('userEmail').textContent = currentUser.email;

            // Show Coach Mode if Lisa is logged in
            if (isCoach()) {
                showCoachMode();
            }

            // Fetch user's blueprint
            await loadBlueprint();
        }

        // Load blueprint data
        async function loadBlueprint() {
            // For static demo site (no backend), assume blueprint is complete
            // This allows all tools to work with the static HTML files
            if (!window.location.hostname.includes('localhost') || currentUser.id.startsWith('demo')) {
                // Static hosting or demo mode - skip API call, unlock all tools
                currentBlueprint = {
                    id: 'static-blueprint',
                    created_at: new Date().toISOString(),
                    updated_at: new Date().toISOString()
                };
                updateDashboardState(true);
                return;
            }

            // Only try API if running with backend server
            try {
                const response = await fetch(`/api/blueprint/${currentUser.id}`);
                const data = await response.json();

                if (data.success && data.blueprint) {
                    currentBlueprint = data.blueprint;
                    updateDashboardState(true);
                } else {
                    updateDashboardState(false);
                }
            } catch (error) {
                console.error('Error loading blueprint:', error);
                // Fallback: assume complete for demo purposes
                updateDashboardState(true);
            }
        }

        // Update dashboard based on blueprint status
        function updateDashboardState(hasBlueprint) {
            const blueprintStatus = document.getElementById('blueprintStatus');
            const openBlueprintBtn = document.getElementById('openBlueprintBtn');
            const cvStatus = document.getElementById('cvStatus');
            const openCvBtn = document.getElementById('openCvBtn');
            const exportCvBtn = document.getElementById('exportCvBtn');
            const decisionStatus = document.getElementById('decisionStatus');
            const openDecisionBtn = document.getElementById('openDecisionBtn');

            if (hasBlueprint) {
                // Blueprint complete - unlock everything
                blueprintStatus.textContent = '‚úì Completed';
                blueprintStatus.className = 'tool-status status-complete';
                openBlueprintBtn.disabled = false;
                openBlueprintBtn.classList.remove('btn-disabled');
                openBlueprintBtn.classList.add('btn-primary');

                // Unlock CV Builder
                cvStatus.textContent = 'Ready';
                cvStatus.className = 'tool-status status-pending';
                openCvBtn.disabled = false;
                openCvBtn.classList.remove('btn-disabled');
                openCvBtn.classList.add('btn-primary');
                exportCvBtn.disabled = false;
                exportCvBtn.classList.remove('btn-disabled');

                // Unlock Decision Framework
                decisionStatus.textContent = 'Ready';
                decisionStatus.className = 'tool-status status-pending';
                openDecisionBtn.disabled = false;
                openDecisionBtn.classList.remove('btn-disabled');
                openDecisionBtn.classList.add('btn-primary');

                // Update stats
                document.getElementById('blueprintCount').textContent = '1';
                document.getElementById('toolsComplete').textContent = '6/6';

                const date = new Date(currentBlueprint.updated_at || currentBlueprint.created_at);
                document.getElementById('lastUpdated').textContent = date.toLocaleDateString('en-GB');
            } else {
                // No blueprint yet
                blueprintStatus.textContent = 'Requires Report';
                blueprintStatus.className = 'tool-status status-locked';
            }
        }

        // Navigation functions - Load user-specific documents
        function getUserPrefix() {
            // Return document prefix based on logged-in user
            if (!currentUser) return 'Sarah_Mitchell';

            const email = currentUser.email.toLowerCase();
            if (email.includes('donald')) {
                return 'Donald/Donald_Pirie';
            }
            // Default to Sarah for demo
            return 'Sarah_Mitchell';
        }

        function openQuestionnaire() {
            const prefix = getUserPrefix();
            if (prefix.includes('Donald')) {
                // Donald's completed questionnaire responses
                window.open('/donald-questionnaire', '_blank');
            } else {
                window.open('Sarah_Mitchell_Questionnaire.html', '_blank');
            }
        }

        function openInsightsReport() {
            const prefix = getUserPrefix();
            if (prefix.includes('Donald')) {
                window.open('Donald/Donald_Pirie_Career_Insights_Report.html', '_blank');
            } else {
                window.open('Sarah_Mitchell_Career_Insights_Report.html', '_blank');
            }
        }

        function openBlueprint() {
            const prefix = getUserPrefix();
            if (prefix.includes('Donald')) {
                window.open('Donald/Donald_Pirie_Career_Blueprint_LIVE.html', '_blank');
            } else {
                window.open('Sarah_Mitchell_Blueprint.html', '_blank');
            }
        }

        function viewBlueprint() {
            openBlueprint();
        }

        function openCVBuilder() {
            const prefix = getUserPrefix();
            if (prefix.includes('Donald')) {
                window.open('Donald/Donald_Interactive_CV_Builder.html', '_blank');
            } else {
                window.open('Sarah_Mitchell_CV_Builder.html', '_blank');
            }
        }

        function openMappingGuide() {
            const prefix = getUserPrefix();
            if (prefix.includes('Donald')) {
                window.open('Donald/Donald_Blueprint_CV_LinkedIn_Mapping_Guide_1.html', '_blank');
            } else {
                window.open('Sarah_Mitchell_Mapping_Guide.html', '_blank');
            }
        }

        function openDecisionFramework() {
            const prefix = getUserPrefix();
            if (prefix.includes('Donald')) {
                window.open('Donald/Donald_Decision_Framework_Updated_1.html', '_blank');
            } else {
                window.open('Sarah_Mitchell_Decision_Framework.html', '_blank');
            }
        }

        function openPromptLibrary() {
            window.open('AI_Prompt_Library.html', '_blank');
        }

        function exportCV() {
            alert('PDF export coming soon! For now, use your browser\'s Print function (Ctrl/Cmd + P) to save as PDF.');
        }

        // Logout
        function logout() {
            if (confirm('Are you sure you want to log out?')) {
                localStorage.removeItem('syp_user');
                currentUser = null;
                currentBlueprint = null;
                window.location.reload();
            }
        }

        // Load Coach Mode (Lisa) - Works without server!
        function loadCoach() {
            currentUser = {
                id: 'coach-lisa',
                name: 'Lisa Gills',
                email: 'lisa@harnessthespark.com'
            };

            currentBlueprint = {
                id: 'coach-blueprint',
                created_at: new Date().toISOString(),
                updated_at: new Date().toISOString()
            };

            localStorage.setItem('syp_user', JSON.stringify(currentUser));

            // Show dashboard with coach mode
            document.getElementById('loginSection').style.display = 'none';
            document.getElementById('dashboardContent').classList.add('visible');
            document.getElementById('userName').textContent = `Welcome, ${currentUser.name}`;

            // Show user menu
            document.getElementById('userMenu').style.display = 'flex';
            document.getElementById('userEmail').textContent = currentUser.email;

            // Show Coach Mode panel
            showCoachMode();

            // Update state to show blueprint is complete (all tools unlocked)
            updateDashboardState(true);
        }

        // Load demo (Sarah Mitchell) - Works without server!
        function loadDemo() {
            // Create demo user locally (no server needed)
            currentUser = {
                id: 'demo-sarah',
                name: 'Sarah Mitchell',
                email: 'sarah@demo.com'
            };

            currentBlueprint = {
                id: 'demo-blueprint',
                created_at: new Date().toISOString(),
                updated_at: new Date().toISOString()
            };

            localStorage.setItem('syp_user', JSON.stringify(currentUser));

            // Show dashboard with demo data
            document.getElementById('loginSection').style.display = 'none';
            document.getElementById('dashboardContent').classList.add('visible');
            document.getElementById('userName').textContent = `Demo: ${currentUser.name}`;

            // Show user menu
            document.getElementById('userMenu').style.display = 'flex';
            document.getElementById('userEmail').textContent = currentUser.email + ' (demo)';

            // Update state to show blueprint is complete (all tools unlocked)
            updateDashboardState(true);
        }

        // ============================================================
        // COACH MODE FUNCTIONS
        // ============================================================

        // Check if current user is Lisa (coach)
        function isCoach() {
            if (!currentUser) return false;
            const email = currentUser.email.toLowerCase();
            return email.includes('lisa@') || email.includes('harnessthespark') || email === 'admin';
        }

        // Show coach mode interface
        function showCoachMode() {
            if (!isCoach()) return;
            document.getElementById('coachMode').style.display = 'block';
            renderClientList();
        }

        // Render the client list cards
        function renderClientList() {
            const container = document.getElementById('clientList');
            const clients = getStoredClients();

            container.innerHTML = Object.values(clients).map(client => `
                <div style="background: rgba(255,255,255,0.95); border-radius: 12px; padding: 20px; cursor: pointer;" onclick="viewClientJourney('${client.email}')">
                    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px;">
                        <h4 style="color: #333; margin: 0;">${client.name}</h4>
                        <span style="background: ${getStatusColour(client.status)}; color: white; padding: 3px 10px; border-radius: 12px; font-size: 0.75em;">
                            ${WEEK_INFO[client.status].label}
                        </span>
                    </div>
                    <p style="color: #666; font-size: 0.85em; margin-bottom: 8px;">${client.email}</p>
                    <p style="color: #888; font-size: 0.8em;">
                        ${WEEK_INFO[client.status].icon} ${WEEK_INFO[client.status].description}
                    </p>
                    <div style="margin-top: 10px; height: 4px; background: #e0e0e0; border-radius: 2px;">
                        <div style="height: 100%; width: ${getProgressPercentage(client.status)}%; background: ${getStatusColour(client.status)}; border-radius: 2px;"></div>
                    </div>
                </div>
            `).join('');
        }

        // Get status colour
        function getStatusColour(status) {
            const colours = {
                'pre-programme': '#9b59b6',
                'week-1': '#3498db',
                'week-2': '#2ecc71',
                'week-3': '#f39c12',
                'week-4': '#e74c3c',
                'complete': '#27ae60'
            };
            return colours[status] || '#667eea';
        }

        // Get progress percentage
        function getProgressPercentage(status) {
            const percentages = {
                'pre-programme': 10,
                'week-1': 30,
                'week-2': 50,
                'week-3': 70,
                'week-4': 90,
                'complete': 100
            };
            return percentages[status] || 0;
        }

        // View client journey
        function viewClientJourney(email) {
            const clients = getStoredClients();
            const client = clients[email];
            if (!client) return;

            document.getElementById('journeyView').style.display = 'block';
            document.getElementById('journeyClientName').textContent = client.name;
            document.getElementById('journeyClientStatus').textContent = `Enrolled: ${client.enrolledDate} | Current: ${WEEK_INFO[client.status].label}`;

            // Render timeline
            const timeline = document.getElementById('journeyTimeline');
            const stages = ['pre-programme', 'week-1', 'week-2', 'week-3', 'week-4', 'complete'];
            const currentIndex = stages.indexOf(client.status);

            timeline.innerHTML = stages.map((stage, index) => {
                const info = WEEK_INFO[stage];
                const isComplete = index < currentIndex || client.status === 'complete';
                const isCurrent = index === currentIndex;
                const isLocked = index > currentIndex;

                return `
                    <div style="flex: 1; text-align: center; padding: 15px 10px; border-radius: 10px;
                         background: ${isComplete ? '#e8f5e9' : isCurrent ? '#e3f2fd' : '#f5f5f5'};
                         border: 2px solid ${isComplete ? '#4caf50' : isCurrent ? '#2196f3' : '#e0e0e0'};
                         opacity: ${isLocked ? '0.5' : '1'};">
                        <div style="font-size: 1.8em; margin-bottom: 8px;">${isComplete ? '‚úÖ' : info.icon}</div>
                        <div style="font-weight: 600; color: ${isComplete ? '#4caf50' : isCurrent ? '#2196f3' : '#666'}; font-size: 0.9em;">
                            ${info.label}
                        </div>
                        <div style="font-size: 0.75em; color: #888; margin-top: 5px;">
                            ${info.description.split(' - ')[0]}
                        </div>
                    </div>
                `;
            }).join('');

            // Render week actions
            renderWeekActions(client);
        }

        // Render actions for the current week (using worksheets, not automation)
        function renderWeekActions(client) {
            const container = document.getElementById('weekActions');
            const status = client.status;

            const actions = {
                'pre-programme': `
                    <h4 style="color: #9b59b6; margin-bottom: 15px;">üìã Pre-Programme Setup</h4>
                    <div style="display: grid; gap: 10px;">
                        <a href="ability-recognition-visual.html" target="_blank" class="action-btn">üìù Send Questionnaire Link</a>
                        <button onclick="openClientQuestionnaire('${client.email}')" class="action-btn">üëÅÔ∏è View Responses</button>
                        <button onclick="advanceClient('${client.email}', 'week-1')" class="action-btn advance">‚úÖ Mark Questionnaire Complete ‚Üí Week 1</button>
                    </div>
                `,
                'week-1': `
                    <h4 style="color: #3498db; margin-bottom: 15px;">üå± Week 1: Foundation Session</h4>
                    <p style="color: #666; margin-bottom: 15px;">Work through patterns, evidence collection, and thread discovery.</p>
                    <div style="display: grid; gap: 10px;">
                        <button onclick="openClientBlueprint('${client.email}')" class="action-btn">üìò Open Blueprint (Week 1)</button>
                        <button onclick="advanceClient('${client.email}', 'week-2')" class="action-btn advance">‚úÖ Complete Week 1 ‚Üí Week 2</button>
                    </div>
                `,
                'week-2': `
                    <h4 style="color: #2ecc71; margin-bottom: 15px;">üß≠ Week 2: Direction Session</h4>
                    <p style="color: #666; margin-bottom: 15px;">Career insights, decision framework, charges & drains.</p>
                    <div style="display: grid; gap: 10px;">
                        <button onclick="openClientInsights('${client.email}')" class="action-btn">üìä Open Career Insights Report</button>
                        <button onclick="openClientDecision('${client.email}')" class="action-btn">‚öñÔ∏è Open Decision Framework</button>
                        <button onclick="openClientBlueprint('${client.email}')" class="action-btn">üìò Update Blueprint (Week 2)</button>
                        <button onclick="advanceClient('${client.email}', 'week-3')" class="action-btn advance">‚úÖ Complete Week 2 ‚Üí Week 3</button>
                    </div>
                `,
                'week-3': `
                    <h4 style="color: #f39c12; margin-bottom: 15px;">üéØ Week 3: Positioning Session</h4>
                    <p style="color: #666; margin-bottom: 15px;">One-sentence intro, LinkedIn headlines, elevator pitches.</p>
                    <div style="display: grid; gap: 10px;">
                        <button onclick="openClientBlueprint('${client.email}')" class="action-btn">üìò Update Blueprint (Week 3)</button>
                        <button onclick="openClientMapping('${client.email}')" class="action-btn">üó∫Ô∏è Open Mapping Guide</button>
                        <button onclick="advanceClient('${client.email}', 'week-4')" class="action-btn advance">‚úÖ Complete Week 3 ‚Üí Week 4</button>
                    </div>
                `,
                'week-4': `
                    <h4 style="color: #e74c3c; margin-bottom: 15px;">üöÄ Week 4: Implementation Session</h4>
                    <p style="color: #666; margin-bottom: 15px;">CV Builder, LinkedIn updates, AI prompts.</p>
                    <div style="display: grid; gap: 10px;">
                        <button onclick="openClientCV('${client.email}')" class="action-btn">üìù Open CV Builder</button>
                        <button onclick="openClientMapping('${client.email}')" class="action-btn">üó∫Ô∏è Open Mapping Guide</button>
                        <a href="AI_Prompt_Library.html" target="_blank" class="action-btn">ü§ñ AI Prompt Library</a>
                        <button onclick="advanceClient('${client.email}', 'complete')" class="action-btn advance">üèÜ Mark Programme Complete</button>
                    </div>
                `,
                'complete': `
                    <h4 style="color: #27ae60; margin-bottom: 15px;">üèÜ Programme Complete!</h4>
                    <p style="color: #666; margin-bottom: 15px;">Client has completed the Career Booster programme.</p>
                    <div style="display: grid; gap: 10px;">
                        <button onclick="openClientBlueprint('${client.email}')" class="action-btn">üìò View Final Blueprint</button>
                        <button onclick="openClientCV('${client.email}')" class="action-btn">üìù View CV Builder</button>
                        <button onclick="openAllClientDocs('${client.email}')" class="action-btn">üìÅ View All Documents</button>
                    </div>
                `
            };

            container.innerHTML = `
                <style>
                    .action-btn {
                        display: block;
                        width: 100%;
                        padding: 12px 20px;
                        background: #f0f0f0;
                        border: 1px solid #ddd;
                        border-radius: 8px;
                        text-align: left;
                        cursor: pointer;
                        font-size: 0.95em;
                        color: #333;
                        text-decoration: none;
                        transition: all 0.2s;
                    }
                    .action-btn:hover { background: #e8e8e8; }
                    .action-btn.advance {
                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                        color: white;
                        border: none;
                        font-weight: 600;
                    }
                    .action-btn.advance:hover { opacity: 0.9; }
                </style>
                ${actions[status] || '<p>No actions available for this status.</p>'}
            `;
        }

        // Advance client to next stage (manual progression via worksheets)
        function advanceClient(email, newStatus) {
            const clients = getStoredClients();
            if (clients[email]) {
                clients[email].status = newStatus;
                if (newStatus === 'complete') {
                    clients[email].completedDate = new Date().toISOString().split('T')[0];
                }
                saveStoredClients(clients);
                viewClientJourney(email);
                renderClientList();
                alert(`‚úÖ ${clients[email].name} advanced to ${WEEK_INFO[newStatus].label}`);
            }
        }

        // Add new client
        function addNewClient() {
            const name = prompt('Client Name:');
            if (!name) return;

            const email = prompt('Client Email:');
            if (!email || !email.includes('@')) {
                alert('Please enter a valid email address');
                return;
            }

            const clients = getStoredClients();
            if (clients[email]) {
                alert('A client with this email already exists');
                return;
            }

            // Create client folder name from name
            const folderName = name.replace(/\s+/g, '_');

            clients[email] = {
                id: 'client-' + Date.now(),
                name: name,
                email: email,
                folder: folderName,
                status: 'pre-programme',
                enrolledDate: new Date().toISOString().split('T')[0],
                completedDate: null,
                progress: {
                    questionnaire: false,
                    insightsReport: false,
                    blueprint: false,
                    decisionFramework: false,
                    cvBuilder: false,
                    mappingGuide: false
                }
            };

            saveStoredClients(clients);
            renderClientList();
            alert(`‚úÖ ${name} added! You can now send them the questionnaire link.`);
        }

        // Close journey view
        function closeJourneyView() {
            document.getElementById('journeyView').style.display = 'none';
        }

        // Storage helpers
        function getStoredClients() {
            const stored = localStorage.getItem('syp_clients');
            if (stored) {
                return JSON.parse(stored);
            }
            // Return default clients (Donald and Sarah)
            return CLIENT_DATABASE;
        }

        function saveStoredClients(clients) {
            localStorage.setItem('syp_clients', JSON.stringify(clients));
        }

        // Client document openers (based on folder structure)
        function openClientQuestionnaire(email) {
            const clients = getStoredClients();
            const client = clients[email];
            if (client.folder === 'Donald') {
                window.open('/donald-questionnaire', '_blank');
            } else if (client.folder) {
                window.open(`${client.folder}/${client.folder}_Questionnaire_Responses.html`, '_blank');
            } else {
                window.open('ability-recognition-visual.html', '_blank');
            }
        }

        function openClientBlueprint(email) {
            const clients = getStoredClients();
            const client = clients[email];
            if (client.folder === 'Donald') {
                window.open('Donald/Donald_Pirie_Career_Blueprint_LIVE.html', '_blank');
            } else if (client.folder) {
                window.open(`${client.folder}/${client.folder}_Career_Blueprint.html`, '_blank');
            }
        }

        function openClientInsights(email) {
            const clients = getStoredClients();
            const client = clients[email];
            if (client.folder === 'Donald') {
                window.open('Donald/Donald_Pirie_Career_Insights_Report.html', '_blank');
            } else if (client.folder) {
                window.open(`${client.folder}/${client.folder}_Career_Insights_Report.html`, '_blank');
            }
        }

        function openClientDecision(email) {
            const clients = getStoredClients();
            const client = clients[email];
            if (client.folder === 'Donald') {
                window.open('Donald/Donald_Decision_Framework_Updated_1.html', '_blank');
            } else if (client.folder) {
                window.open(`${client.folder}/${client.folder}_Decision_Framework.html`, '_blank');
            }
        }

        function openClientCV(email) {
            const clients = getStoredClients();
            const client = clients[email];
            if (client.folder === 'Donald') {
                window.open('Donald/Donald_Interactive_CV_Builder.html', '_blank');
            } else if (client.folder) {
                window.open(`${client.folder}/${client.folder}_CV_Builder.html`, '_blank');
            }
        }

        function openClientMapping(email) {
            const clients = getStoredClients();
            const client = clients[email];
            if (client.folder === 'Donald') {
                window.open('Donald/Donald_Blueprint_CV_LinkedIn_Mapping_Guide_1.html', '_blank');
            } else if (client.folder) {
                window.open(`${client.folder}/${client.folder}_Mapping_Guide.html`, '_blank');
            }
        }

        function openAllClientDocs(email) {
            const clients = getStoredClients();
            const client = clients[email];
            if (client.folder) {
                // Open folder listing (in production, this would show a document list)
                alert(`Documents for ${client.name}:\n\n- Career Blueprint\n- Career Insights Report\n- Decision Framework\n- CV Builder\n- Mapping Guide\n- AI Prompt Library`);
            }
        }
    </script>
</body>
</html>
