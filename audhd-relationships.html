<!DOCTYPE html>
<html lang="en-GB">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Boundaries & Communication Toolkit - Spark Your Potential</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ü§ù</text></svg>">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #2d1b4e 100%);
            min-height: 100vh;
            padding: 30px;
            color: #333;
        }
        .container { max-width: 1000px; margin: 0 auto; }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }
        .header h1 {
            font-size: 2.2em;
            font-weight: 800;
            margin-bottom: 10px;
        }
        .header .subtitle {
            font-size: 1.1em;
            opacity: 0.8;
            margin-bottom: 15px;
        }
        .paradox-reminder {
            background: rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 15px 25px;
            display: inline-block;
            font-style: italic;
            color: #E91E78;
        }

        /* Navigation Tabs */
        .nav-tabs {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        .nav-tab {
            background: rgba(255,255,255,0.1);
            color: white;
            border: 2px solid rgba(255,255,255,0.2);
            padding: 12px 25px;
            border-radius: 25px;
            font-size: 0.95em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        .nav-tab:hover {
            background: rgba(255,255,255,0.2);
            border-color: #E91E78;
        }
        .nav-tab.active {
            background: linear-gradient(135deg, #E91E78 0%, #F97B4D 100%);
            border-color: transparent;
        }

        /* Section Cards */
        .section-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            display: none;
        }
        .section-card.active {
            display: block;
        }
        .section-title {
            font-size: 1.4em;
            color: #2d1b4e;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .section-intro {
            color: #666;
            margin-bottom: 25px;
            line-height: 1.6;
        }

        /* Spark Insight Boxes */
        .audhd-insight {
            background: linear-gradient(135deg, #fdf4ff 0%, #fce7f3 100%);
            border-left: 4px solid #E91E78;
            border-radius: 12px;
            padding: 18px 20px;
            margin-bottom: 25px;
        }
        .audhd-insight h4 {
            color: #E91E78;
            font-size: 0.9em;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .audhd-insight p {
            color: #666;
            font-size: 0.95em;
            line-height: 1.5;
        }

        /* Boundary Categories */
        .boundary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        .boundary-card {
            background: #f8f9fa;
            border-radius: 16px;
            padding: 20px;
            border: 2px solid #e0e0e0;
            transition: all 0.2s;
        }
        .boundary-card:hover {
            border-color: #E91E78;
        }
        .boundary-card h4 {
            color: #2d1b4e;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .boundary-card textarea {
            width: 100%;
            min-height: 100px;
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 12px;
            font-family: inherit;
            font-size: 0.95em;
            resize: vertical;
        }
        .boundary-card textarea:focus {
            outline: none;
            border-color: #E91E78;
            box-shadow: 0 0 0 3px rgba(233, 30, 120, 0.1);
        }
        .boundary-card .prompt {
            font-size: 0.85em;
            color: #888;
            margin-bottom: 10px;
            font-style: italic;
        }

        /* Scripts Section */
        .scripts-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .script-card {
            background: #f8f9fa;
            border-radius: 16px;
            padding: 20px;
            border: 2px solid #e0e0e0;
        }
        .script-card h4 {
            color: #2d1b4e;
            margin-bottom: 8px;
        }
        .script-card .situation {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 15px;
        }
        .script-example {
            background: white;
            border-radius: 10px;
            padding: 15px;
            border-left: 3px solid #10B981;
            margin-bottom: 10px;
        }
        .script-example strong {
            color: #10B981;
            display: block;
            margin-bottom: 5px;
            font-size: 0.85em;
        }
        .script-example p {
            color: #333;
            font-size: 0.95em;
            line-height: 1.5;
        }
        .script-your-version {
            margin-top: 15px;
        }
        .script-your-version label {
            display: block;
            color: #555;
            font-size: 0.9em;
            font-weight: 600;
            margin-bottom: 8px;
        }
        .script-your-version textarea {
            width: 100%;
            min-height: 80px;
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 12px;
            font-family: inherit;
            font-size: 0.95em;
            resize: vertical;
        }
        .script-your-version textarea:focus {
            outline: none;
            border-color: #10B981;
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }

        /* Masking Awareness */
        .masking-scale {
            background: linear-gradient(135deg, #fff7ed 0%, #ffedd5 100%);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 25px;
        }
        .masking-scale h4 {
            color: #c2410c;
            margin-bottom: 15px;
        }
        .masking-slider-container {
            margin-bottom: 20px;
        }
        .masking-slider-container label {
            display: block;
            color: #555;
            margin-bottom: 8px;
            font-size: 0.9em;
        }
        .masking-slider {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            -webkit-appearance: none;
            appearance: none;
            background: linear-gradient(90deg, #10B981 0%, #fbbf24 50%, #ef4444 100%);
        }
        .masking-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: white;
            border: 3px solid #2d1b4e;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
        .masking-labels {
            display: flex;
            justify-content: space-between;
            font-size: 0.8em;
            color: #666;
            margin-top: 5px;
        }

        /* Overshare/Undershare Balance */
        .balance-section {
            background: linear-gradient(135deg, #ede9fe 0%, #ddd6fe 100%);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 25px;
        }
        .balance-section h4 {
            color: #6d28d9;
            margin-bottom: 15px;
        }
        .balance-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        @media (max-width: 600px) {
            .balance-grid { grid-template-columns: 1fr; }
        }
        .balance-column h5 {
            color: #555;
            margin-bottom: 10px;
            font-size: 0.95em;
        }
        .balance-column ul {
            list-style: none;
            padding: 0;
        }
        .balance-column li {
            background: white;
            padding: 10px 15px;
            border-radius: 8px;
            margin-bottom: 8px;
            font-size: 0.9em;
            color: #444;
            display: flex;
            align-items: flex-start;
            gap: 8px;
        }
        .balance-column li::before {
            flex-shrink: 0;
        }
        .overshare-list li::before { content: 'üó£Ô∏è'; }
        .undershare-list li::before { content: 'ü§ê'; }

        /* Relationship Type Reflections */
        .reflection-accordion {
            margin-bottom: 25px;
        }
        .reflection-item {
            background: #f8f9fa;
            border-radius: 12px;
            margin-bottom: 10px;
            overflow: hidden;
            border: 2px solid #e0e0e0;
        }
        .reflection-header {
            padding: 18px 20px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.2s;
        }
        .reflection-header:hover {
            background: #f0f0f0;
        }
        .reflection-header h4 {
            color: #2d1b4e;
            font-size: 1em;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .reflection-header .arrow {
            transition: transform 0.2s;
            color: #888;
        }
        .reflection-item.open .arrow {
            transform: rotate(180deg);
        }
        .reflection-content {
            padding: 0 20px 20px 20px;
            display: none;
        }
        .reflection-item.open .reflection-content {
            display: block;
        }
        .reflection-question {
            margin-bottom: 15px;
        }
        .reflection-question label {
            display: block;
            color: #555;
            font-size: 0.9em;
            margin-bottom: 8px;
        }
        .reflection-question textarea {
            width: 100%;
            min-height: 80px;
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 12px;
            font-family: inherit;
            font-size: 0.95em;
            resize: vertical;
        }

        /* Quick Reference Cards */
        .quick-ref-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }
        .quick-ref-card {
            background: white;
            border-radius: 12px;
            padding: 18px;
            border: 2px solid #e0e0e0;
        }
        .quick-ref-card h5 {
            color: #2d1b4e;
            margin-bottom: 10px;
            font-size: 0.95em;
        }
        .quick-ref-card p {
            color: #555;
            font-size: 0.9em;
            line-height: 1.5;
            background: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
            font-style: italic;
        }

        /* Save Button */
        .save-section {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }
        .save-btn {
            background: linear-gradient(135deg, #E91E78 0%, #F97B4D 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 12px;
            font-size: 1.1em;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
        }
        .save-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(233, 30, 120, 0.3);
        }
        .save-status {
            margin-top: 10px;
            font-size: 0.9em;
            color: #666;
        }
        .save-status.success {
            color: #10B981;
        }

        /* Back Button */
        .back-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 0.9em;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        /* Mobile fix for back button */
        @media (max-width: 600px) {
            .back-btn {
                position: relative;
                top: auto;
                left: auto;
                display: block;
                margin: 10px auto 20px;
                text-align: center;
                width: fit-content;
            }
        }

        .back-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        /* Data Source Indicator */
        .data-source {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75em;
            font-weight: 600;
            margin-top: 10px;
        }
        .data-source.live {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
        }
        .data-source.cached {
            background: rgba(251, 191, 36, 0.2);
            color: #fbbf24;
        }

        /* Enhanced Mobile Responsive */
        @media (max-width: 768px) {
            body { padding: 15px 10px; }
            .container { max-width: 100%; }

            .header h1 { font-size: 1.6em; }
            .header .subtitle { font-size: 0.95em; }
            .paradox-reminder { padding: 12px 15px; font-size: 0.9em; }

            /* Navigation tabs scrollable */
            .nav-tabs {
                overflow-x: auto;
                flex-wrap: nowrap;
                justify-content: flex-start;
                padding-bottom: 10px;
                -webkit-overflow-scrolling: touch;
            }
            .nav-tab {
                flex-shrink: 0;
                padding: 10px 16px;
                font-size: 0.85em;
            }

            /* Section cards */
            .section-card {
                padding: 20px 15px;
                border-radius: 16px;
            }
            .section-title { font-size: 1.2em; }
            .section-intro { font-size: 0.9em; }

            /* Spark insight boxes */
            .audhd-insight { padding: 15px; }
            .audhd-insight h4 { font-size: 0.85em; }
            .audhd-insight p { font-size: 0.9em; }

            /* Boundary grid single column */
            .boundary-grid { grid-template-columns: 1fr; gap: 15px; }
            .boundary-card { padding: 15px; }
            .boundary-card h4 { font-size: 0.95em; }
            .boundary-card textarea {
                font-size: 16px; /* Prevent iOS zoom */
                min-height: 100px;
            }

            /* Values grid smaller */
            .values-grid { grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 8px; }
            .value-chip { padding: 10px 12px; font-size: 0.85em; }

            /* Scripts */
            .script-card { padding: 15px; }
            .script-card h4 { font-size: 1em; }
            .script-example { padding: 12px; }
            .script-your-version textarea {
                font-size: 16px; /* Prevent iOS zoom */
            }

            /* Masking section */
            .masking-scale { padding: 20px 15px; }
            .masking-slider-container label { font-size: 0.85em; }

            /* Balance section */
            .balance-section { padding: 20px 15px; }
            .balance-column li { padding: 8px 12px; font-size: 0.85em; }

            /* Reflection accordions */
            .reflection-header { padding: 15px; }
            .reflection-header h4 { font-size: 0.95em; }
            .reflection-content { padding: 0 15px 15px 15px; }
            .reflection-question textarea {
                font-size: 16px; /* Prevent iOS zoom */
            }

            /* Quick reference grid */
            .quick-ref-grid { grid-template-columns: 1fr; }
            .quick-ref-card { padding: 15px; }
            .quick-ref-card h5 { font-size: 0.9em; }
            .quick-ref-card p { padding: 10px; font-size: 0.85em; }

            /* Save button sticky on mobile */
            .save-section {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                background: linear-gradient(135deg, #1a1a2e 0%, #2d1b4e 100%);
                padding: 15px 20px;
                margin: 0;
                border-top: none;
                box-shadow: 0 -4px 20px rgba(0,0,0,0.3);
                z-index: 100;
            }
            .save-btn {
                width: 100%;
                padding: 15px;
            }

            /* Add padding at bottom for sticky button */
            .section-card { padding-bottom: 100px; }

            /* Top value inputs */
            .balance-section input[type="text"] {
                font-size: 16px; /* Prevent iOS zoom */
            }

            /* Lucky to have textarea */
            #lucky-to-have {
                font-size: 16px; /* Prevent iOS zoom */
            }
        }

        /* Print Styles */
        @media print {
            body { background: white; padding: 20px; }
            .nav-tabs, .back-btn, .save-section { display: none; }
            .section-card { display: block !important; box-shadow: none; border: 1px solid #ddd; page-break-inside: avoid; }
        }
    </style>
</head>
<body>
    <a href="#" onclick="goBackToPortal(); return false;" class="back-btn">‚Üê Back to Dashboard</a>

    <div class="container">
        <div class="header">
            <h1>ü§ù Boundaries & Communication Toolkit</h1>
            <div class="subtitle">Navigate relationships as your authentic Spark self</div>
            <div class="paradox-reminder">
                "ADHD overshares, autism undershares ‚Äî finding YOUR balance"
            </div>
            <div class="data-source cached" id="dataSource">
                <span>üíæ</span> <span id="dataSourceText">Cached</span>
            </div>
        </div>

        <!-- Navigation Tabs -->
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showSection('values')">üíé My Values</button>
            <button class="nav-tab" onclick="showSection('boundaries')">üõ°Ô∏è My Boundaries</button>
            <button class="nav-tab" onclick="showSection('scripts')">üí¨ Scripts & Templates</button>
            <button class="nav-tab" onclick="showSection('masking')">üé≠ Masking Awareness</button>
            <button class="nav-tab" onclick="showSection('relationships')">üë• Relationship Types</button>
        </div>

        <!-- Section 1: My Values -->
        <div id="values" class="section-card active">
            <h3 class="section-title">üíé My Values</h3>
            <p class="section-intro">Your values are the foundation of effective communication. When you're clear on what matters most to you, setting boundaries becomes easier and your relationships become more authentic.</p>

            <div class="audhd-insight">
                <h4>üß† Spark Insight</h4>
                <p><strong>Autism</strong> often gives you strong, unwavering values (justice, honesty, logic). <strong>ADHD</strong> can make those values feel inconsistent because you forget to act on them or get distracted. Writing them down creates accountability to yourself.</p>
            </div>

            <!-- Core Values Identification -->
            <h4 style="color: #2d1b4e; margin-bottom: 15px;">üéØ Identify Your Core Values</h4>
            <p style="color: #666; margin-bottom: 20px; font-size: 0.95em;">Select the 5-7 values that resonate most deeply with you. These are non-negotiables ‚Äî things that, when violated, feel genuinely wrong.</p>

            <div class="values-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 10px; margin-bottom: 25px;">
                <label class="value-chip"><input type="checkbox" name="value" value="authenticity"> Authenticity</label>
                <label class="value-chip"><input type="checkbox" name="value" value="honesty"> Honesty</label>
                <label class="value-chip"><input type="checkbox" name="value" value="loyalty"> Loyalty</label>
                <label class="value-chip"><input type="checkbox" name="value" value="fairness"> Fairness</label>
                <label class="value-chip"><input type="checkbox" name="value" value="independence"> Independence</label>
                <label class="value-chip"><input type="checkbox" name="value" value="connection"> Connection</label>
                <label class="value-chip"><input type="checkbox" name="value" value="creativity"> Creativity</label>
                <label class="value-chip"><input type="checkbox" name="value" value="knowledge"> Knowledge</label>
                <label class="value-chip"><input type="checkbox" name="value" value="growth"> Growth</label>
                <label class="value-chip"><input type="checkbox" name="value" value="stability"> Stability</label>
                <label class="value-chip"><input type="checkbox" name="value" value="adventure"> Adventure</label>
                <label class="value-chip"><input type="checkbox" name="value" value="security"> Security</label>
                <label class="value-chip"><input type="checkbox" name="value" value="freedom"> Freedom</label>
                <label class="value-chip"><input type="checkbox" name="value" value="kindness"> Kindness</label>
                <label class="value-chip"><input type="checkbox" name="value" value="respect"> Respect</label>
                <label class="value-chip"><input type="checkbox" name="value" value="responsibility"> Responsibility</label>
                <label class="value-chip"><input type="checkbox" name="value" value="excellence"> Excellence</label>
                <label class="value-chip"><input type="checkbox" name="value" value="compassion"> Compassion</label>
                <label class="value-chip"><input type="checkbox" name="value" value="justice"> Justice</label>
                <label class="value-chip"><input type="checkbox" name="value" value="privacy"> Privacy</label>
                <label class="value-chip"><input type="checkbox" name="value" value="simplicity"> Simplicity</label>
                <label class="value-chip"><input type="checkbox" name="value" value="humour"> Humour</label>
                <label class="value-chip"><input type="checkbox" name="value" value="peace"> Peace</label>
                <label class="value-chip"><input type="checkbox" name="value" value="purpose"> Purpose</label>
            </div>

            <style>
                .value-chip {
                    display: flex;
                    align-items: center;
                    gap: 8px;
                    padding: 12px 15px;
                    background: #f8f9fa;
                    border: 2px solid #e0e0e0;
                    border-radius: 10px;
                    cursor: pointer;
                    transition: all 0.2s;
                    font-size: 0.9em;
                    color: #555;
                }
                .value-chip:hover {
                    border-color: #E91E78;
                    background: #fdf4ff;
                }
                .value-chip input {
                    accent-color: #E91E78;
                    width: 18px;
                    height: 18px;
                }
                .value-chip:has(input:checked) {
                    background: linear-gradient(135deg, #fdf4ff 0%, #fce7f3 100%);
                    border-color: #E91E78;
                    color: #2d1b4e;
                    font-weight: 600;
                }
            </style>

            <!-- Other Values -->
            <div class="boundary-card" style="margin-bottom: 25px;">
                <h4>‚ú® Other Values Not Listed</h4>
                <p class="prompt">Add any values that are important to you that weren't in the list above</p>
                <textarea id="values-other" placeholder="e.g., Curiosity, Nature, Art, Animals, Solitude, Order, Spontaneity..."></textarea>
            </div>

            <!-- Top 3 Priority -->
            <div class="balance-section" style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); margin-bottom: 25px;">
                <h4 style="color: #92400e;">‚≠ê Your Top 3 Non-Negotiable Values</h4>
                <p style="color: #78350f; font-size: 0.9em; margin-bottom: 15px;">If you could only keep 3 values, which would they be? These are your absolute core.</p>
                <div style="display: grid; gap: 15px;">
                    <div>
                        <label style="display: block; color: #78350f; font-weight: 600; margin-bottom: 5px;">1Ô∏è‚É£ Most Important</label>
                        <input type="text" id="value-top1" placeholder="e.g., Honesty" style="width: 100%; padding: 12px 15px; border: 2px solid #fbbf24; border-radius: 10px; font-size: 1em; background: white;">
                    </div>
                    <div>
                        <label style="display: block; color: #78350f; font-weight: 600; margin-bottom: 5px;">2Ô∏è‚É£ Second Most Important</label>
                        <input type="text" id="value-top2" placeholder="e.g., Freedom" style="width: 100%; padding: 12px 15px; border: 2px solid #fbbf24; border-radius: 10px; font-size: 1em; background: white;">
                    </div>
                    <div>
                        <label style="display: block; color: #78350f; font-weight: 600; margin-bottom: 5px;">3Ô∏è‚É£ Third Most Important</label>
                        <input type="text" id="value-top3" placeholder="e.g., Authenticity" style="width: 100%; padding: 12px 15px; border: 2px solid #fbbf24; border-radius: 10px; font-size: 1em; background: white;">
                    </div>
                </div>
            </div>

            <!-- Values in Relationships -->
            <h4 style="color: #2d1b4e; margin-bottom: 15px;">üîó How Your Values Show Up in Relationships</h4>
            <div class="boundary-grid">
                <div class="boundary-card">
                    <h4>‚úÖ When My Values Are Honoured</h4>
                    <p class="prompt">How do you feel when people respect your values? What does that look like?</p>
                    <textarea id="values-honoured" placeholder="e.g., I feel safe and can be myself. I don't have to explain or justify. I feel energised after spending time with them..."></textarea>
                </div>
                <div class="boundary-card">
                    <h4>‚ùå When My Values Are Violated</h4>
                    <p class="prompt">What happens when people cross your values? How do you react?</p>
                    <textarea id="values-violated" placeholder="e.g., I shut down and can't explain why. I feel physically uncomfortable. I withdraw and need recovery time. I might mask resentment..."></textarea>
                </div>
            </div>

            <!-- Values-Based Communication -->
            <div class="masking-scale" style="background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%); margin-top: 25px;">
                <h4 style="color: #065f46;">üí¨ Communicating Your Values</h4>
                <p style="color: #047857; font-size: 0.9em; margin-bottom: 15px;">When people understand your values, they understand your boundaries. Practice saying these out loud.</p>

                <div class="quick-ref-grid">
                    <div class="quick-ref-card">
                        <h5>üó£Ô∏è "I" Statement Template</h5>
                        <p>"<strong>[Value]</strong> is really important to me. When <strong>[behaviour]</strong> happens, I feel <strong>[emotion]</strong> because it goes against what I believe."</p>
                    </div>
                    <div class="quick-ref-card">
                        <h5>ü§ù Setting Expectations</h5>
                        <p>"Something you should know about me: I really value <strong>[value]</strong>, so I might <strong>[behaviour that reflects it]</strong>."</p>
                    </div>
                    <div class="quick-ref-card">
                        <h5>üö´ Declining Based on Values</h5>
                        <p>"That doesn't align with what's important to me, so I'm going to pass."</p>
                    </div>
                </div>
            </div>

            <!-- Personal Values Statement -->
            <div class="boundary-card" style="margin-top: 25px;">
                <h4>üìú My Personal Values Statement</h4>
                <p class="prompt">Write a short statement (2-3 sentences) that captures who you are and what you stand for. This is your anchor when relationships get confusing.</p>
                <textarea id="values-statement" placeholder="e.g., I am someone who values honesty above all ‚Äî I would rather hear a hard truth than a comfortable lie. I need freedom to be myself, and I give that same respect to others. Connection matters to me, but only when it's genuine."></textarea>
            </div>

            <!-- What I Bring to Relationships -->
            <div style="background: linear-gradient(135deg, #fdf4ff 0%, #f5d0fe 100%); border-radius: 16px; padding: 25px; margin-top: 25px; border: 2px solid #E91E78;">
                <h4 style="color: #86198f; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">üåü What I Bring to Relationships</h4>
                <p style="color: #a21caf; font-size: 0.9em; margin-bottom: 20px;">Spark brains often focus on what's "wrong" with them. But you bring unique gifts that neurotypical people simply can't offer. Own these.</p>

                <div class="audhd-insight" style="background: rgba(255,255,255,0.7); margin-bottom: 20px;">
                    <h4>üß† Spark Superpowers in Relationships</h4>
                    <p>Your <strong>autism</strong> brings loyalty, honesty, deep focus on people you care about, and pattern recognition. Your <strong>ADHD</strong> brings enthusiasm, creativity, spontaneity, and the ability to make things FUN. Together? You're unforgettable.</p>
                </div>

                <div class="boundary-grid">
                    <div class="boundary-card" style="background: white;">
                        <h4>üí™ My Strengths in Relationships</h4>
                        <p class="prompt">What do you do well? What do people appreciate about you?</p>
                        <textarea id="strengths-relationships" placeholder="e.g., I'm fiercely loyal. I remember details about people. I'm genuinely enthusiastic. I give honest feedback. I'm creative at problem-solving. I make people feel special when they're my focus..."></textarea>
                    </div>
                    <div class="boundary-card" style="background: white;">
                        <h4>üéÅ Unique Gifts I Offer</h4>
                        <p class="prompt">What can you offer that others can't? What makes you YOU?</p>
                        <textarea id="gifts-relationships" placeholder="e.g., My hyperfocus means when I care, I REALLY care. My pattern recognition helps me understand people. My intensity makes experiences memorable. My honesty means people can trust me..."></textarea>
                    </div>
                </div>

                <div class="boundary-card" style="background: white; margin-top: 15px;">
                    <h4>‚ú® Compliments I've Received</h4>
                    <p class="prompt">What positive things have people said about you? (Write them down ‚Äî we forget these!)</p>
                    <textarea id="compliments-received" placeholder="e.g., 'You always remember the little things.' 'Talking to you is never boring.' 'You're the most loyal friend I have.' 'You see things no one else notices.'..."></textarea>
                </div>

                <div style="background: white; border-radius: 12px; padding: 20px; margin-top: 15px;">
                    <h4 style="color: #86198f; margin-bottom: 12px;">üîÆ The Kind of Friend/Partner/Colleague I Am</h4>
                    <p style="color: #666; font-size: 0.9em; margin-bottom: 12px;">Complete this sentence as a reminder of your worth:</p>
                    <div style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap;">
                        <span style="color: #86198f; font-weight: 600;">"People are lucky to have me because..."</span>
                    </div>
                    <textarea id="lucky-to-have" style="width: 100%; min-height: 80px; border: 2px solid #E91E78; border-radius: 10px; padding: 12px; font-family: inherit; font-size: 0.95em; margin-top: 10px;" placeholder="e.g., I show up with my whole heart. I bring energy and ideas. I'm honest when others aren't. I notice when something's wrong. I make ordinary moments fun..."></textarea>
                </div>
            </div>

            <div class="save-section">
                <button class="save-btn" onclick="saveAll()">üíæ Save My Values</button>
                <div class="save-status" id="saveStatus0"></div>
            </div>
        </div>

        <!-- Section 2: My Boundaries -->
        <div id="boundaries" class="section-card">
            <h3 class="section-title">üõ°Ô∏è My Boundaries</h3>
            <p class="section-intro">Boundaries aren't walls ‚Äî they're the rules of engagement for how people get to interact with you. Spark brains often struggle with boundaries because we might not notice when they're crossed until we're already overwhelmed.</p>

            <div class="audhd-insight">
                <h4>üß† Spark Insight</h4>
                <p><strong>Autism</strong> may make you rigid about rules (including ones you didn't consciously create), while <strong>ADHD</strong> might make you forget your boundaries exist in the moment. Writing them down makes them REAL.</p>
            </div>

            <div class="boundary-grid">
                <!-- Time Boundaries -->
                <div class="boundary-card">
                    <h4>‚è∞ Time Boundaries</h4>
                    <p class="prompt">When do you need to be left alone? What times are sacred?</p>
                    <textarea id="boundary-time" placeholder="e.g., I don't take calls after 8pm. I need 30 mins alone after work before talking. Weekends are recovery time..."></textarea>
                </div>

                <!-- Energy Boundaries -->
                <div class="boundary-card">
                    <h4>‚ö° Energy Boundaries</h4>
                    <p class="prompt">What drains you? What do you refuse to do when depleted?</p>
                    <textarea id="boundary-energy" placeholder="e.g., I won't make important decisions when tired. I limit social events to 2 per week. No emotional labour when I'm already overwhelmed..."></textarea>
                </div>

                <!-- Communication Boundaries -->
                <div class="boundary-card">
                    <h4>üì± Communication Boundaries</h4>
                    <p class="prompt">How do you prefer people contact you? Response expectations?</p>
                    <textarea id="boundary-communication" placeholder="e.g., Text before calling. I respond to messages within 24-48 hours. No voice notes over 1 minute..."></textarea>
                </div>

                <!-- Emotional Boundaries -->
                <div class="boundary-card">
                    <h4>üíô Emotional Boundaries</h4>
                    <p class="prompt">What topics are off-limits? When do you step back?</p>
                    <textarea id="boundary-emotional" placeholder="e.g., I don't discuss politics at work. I'm not responsible for fixing everyone's problems. I can leave conversations that escalate..."></textarea>
                </div>

                <!-- Physical Boundaries -->
                <div class="boundary-card">
                    <h4>ü§ó Physical Boundaries</h4>
                    <p class="prompt">Touch preferences? Personal space needs? Sensory limits?</p>
                    <textarea id="boundary-physical" placeholder="e.g., I prefer no hugging without asking. I need quiet spaces to decompress. Certain smells/sounds overwhelm me..."></textarea>
                </div>

                <!-- Work Boundaries -->
                <div class="boundary-card">
                    <h4>üíº Work Boundaries</h4>
                    <p class="prompt">What work limits do you maintain? After-hours rules?</p>
                    <textarea id="boundary-work" placeholder="e.g., No emails after 6pm. I don't do 'quick favours' that derail my day. Meetings need agendas. I take my lunch break..."></textarea>
                </div>
            </div>

            <div class="save-section">
                <button class="save-btn" onclick="saveAll()">üíæ Save My Boundaries</button>
                <div class="save-status" id="saveStatus1"></div>
            </div>
        </div>

        <!-- Section 2: Scripts & Templates -->
        <div id="scripts" class="section-card">
            <h3 class="section-title">üí¨ Scripts & Templates</h3>
            <p class="section-intro">Having pre-prepared scripts removes the cognitive load of figuring out what to say in difficult moments. Adapt these to your voice, then practise saying them out loud.</p>

            <div class="audhd-insight">
                <h4>üß† Spark Insight</h4>
                <p><strong>ADHD impulsivity</strong> might make you agree to things before thinking. <strong>Autistic literal thinking</strong> might make "no" feel rude when it's actually just clear. Scripts give you time to respond, not react.</p>
            </div>

            <div class="scripts-container">
                <!-- Saying No -->
                <div class="script-card">
                    <h4>üö´ Saying No (Without Over-Explaining)</h4>
                    <p class="situation">When asked to do something you can't or don't want to do</p>
                    <div class="script-example">
                        <strong>The Soft No</strong>
                        <p>"Thanks for thinking of me, but I'm not able to take that on right now."</p>
                    </div>
                    <div class="script-example">
                        <strong>The Boundary No</strong>
                        <p>"That doesn't work for me, but I hope you find someone who can help."</p>
                    </div>
                    <div class="script-example">
                        <strong>The Delay</strong>
                        <p>"Let me check my schedule and get back to you." (Gives you time to decide)</p>
                    </div>
                    <div class="script-your-version">
                        <label>Your version:</label>
                        <textarea id="script-no" placeholder="Write it in your own words..."></textarea>
                    </div>
                </div>

                <!-- Setting Limits -->
                <div class="script-card">
                    <h4>‚è±Ô∏è Setting Time/Energy Limits</h4>
                    <p class="situation">When you need to leave, end a conversation, or cap your involvement</p>
                    <div class="script-example">
                        <strong>Pre-announcing</strong>
                        <p>"I have about 20 minutes before I need to go ‚Äî what's most important to cover?"</p>
                    </div>
                    <div class="script-example">
                        <strong>Mid-conversation exit</strong>
                        <p>"I'm hitting my limit and need to wrap up. Can we continue this another time?"</p>
                    </div>
                    <div class="script-example">
                        <strong>Energy honesty</strong>
                        <p>"I'm running low on bandwidth today. I want to be present for this, so can we reschedule?"</p>
                    </div>
                    <div class="script-your-version">
                        <label>Your version:</label>
                        <textarea id="script-limits" placeholder="Write it in your own words..."></textarea>
                    </div>
                </div>

                <!-- Asking for Needs -->
                <div class="script-card">
                    <h4>üôã Asking for What You Need</h4>
                    <p class="situation">When you need accommodations, clarification, or support</p>
                    <div class="script-example">
                        <strong>Clarification request</strong>
                        <p>"I want to make sure I understand correctly. Can you break that down for me?"</p>
                    </div>
                    <div class="script-example">
                        <strong>Accommodation ask</strong>
                        <p>"I work best when [X]. Would it be possible to [specific request]?"</p>
                    </div>
                    <div class="script-example">
                        <strong>Processing time</strong>
                        <p>"I need some time to think about this. I'll get back to you by [specific time]."</p>
                    </div>
                    <div class="script-your-version">
                        <label>Your version:</label>
                        <textarea id="script-needs" placeholder="Write it in your own words..."></textarea>
                    </div>
                </div>

                <!-- Handling Interruptions -->
                <div class="script-card">
                    <h4>‚úã Handling Interruptions</h4>
                    <p class="situation">When someone interrupts your focus or derails you</p>
                    <div class="script-example">
                        <strong>In the moment</strong>
                        <p>"I'm in the middle of something. Can I come find you in 30 minutes?"</p>
                    </div>
                    <div class="script-example">
                        <strong>For repeat offenders</strong>
                        <p>"When I'm wearing headphones, it means I'm in deep focus. Please message me instead."</p>
                    </div>
                    <div class="script-example">
                        <strong>After being derailed</strong>
                        <p>"Let me write that down so I don't forget, then I need to get back to what I was doing."</p>
                    </div>
                    <div class="script-your-version">
                        <label>Your version:</label>
                        <textarea id="script-interruptions" placeholder="Write it in your own words..."></textarea>
                    </div>
                </div>

                <!-- Repairing After Overwhelm -->
                <div class="script-card">
                    <h4>üíî Repairing After Overwhelm</h4>
                    <p class="situation">When you've snapped, shut down, or disappeared unexpectedly</p>
                    <div class="script-example">
                        <strong>After snapping</strong>
                        <p>"I reacted strongly earlier. I was overwhelmed, not angry at you. I'm sorry for how that landed."</p>
                    </div>
                    <div class="script-example">
                        <strong>After shutting down</strong>
                        <p>"I went quiet because I hit my limit, not because of anything you did. I'm back now."</p>
                    </div>
                    <div class="script-example">
                        <strong>After disappearing</strong>
                        <p>"I needed to step away to regulate. I should have communicated that ‚Äî I'm working on it."</p>
                    </div>
                    <div class="script-your-version">
                        <label>Your version:</label>
                        <textarea id="script-repair" placeholder="Write it in your own words..."></textarea>
                    </div>
                </div>
            </div>

            <div class="save-section">
                <button class="save-btn" onclick="saveAll()">üíæ Save My Scripts</button>
                <div class="save-status" id="saveStatus2"></div>
            </div>
        </div>

        <!-- Section 3: Masking Awareness -->
        <div id="masking" class="section-card">
            <h3 class="section-title">üé≠ Masking Awareness</h3>
            <p class="section-intro">Masking is exhausting. Understanding when and why you mask helps you make conscious choices about your energy investment in different relationships.</p>

            <div class="audhd-insight">
                <h4>üß† Spark Insight</h4>
                <p>Spark masking is complex: <strong>ADHD masking</strong> hides impulsivity, distraction, and intensity. <strong>Autistic masking</strong> hides stimming, special interests, and communication differences. You might be doing BOTH without realising it.</p>
            </div>

            <!-- Overshare/Undershare Balance -->
            <div class="balance-section">
                <h4>‚öñÔ∏è The Overshare/Undershare Paradox</h4>
                <div class="balance-grid">
                    <div class="balance-column">
                        <h5>üó£Ô∏è Signs You're Oversharing (ADHD)</h5>
                        <ul class="overshare-list">
                            <li>Telling your life story to acquaintances</li>
                            <li>Sharing before checking if they want to know</li>
                            <li>Regretting what you said afterwards</li>
                            <li>Using trauma as small talk</li>
                            <li>Feeling exposed after conversations</li>
                        </ul>
                    </div>
                    <div class="balance-column">
                        <h5>ü§ê Signs You're Undersharing (Autism)</h5>
                        <ul class="undershare-list">
                            <li>People are surprised to learn basic facts about you</li>
                            <li>You feel unknown even by close friends</li>
                            <li>You assume people know what you haven't told them</li>
                            <li>Relationships feel one-sided (they share, you don't)</li>
                            <li>You're seen as "mysterious" or "closed off"</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Masking Level Tracker -->
            <div class="masking-scale">
                <h4>üé≠ How Much Do You Mask With Different People?</h4>

                <div class="masking-slider-container">
                    <label>üë®‚Äçüë©‚Äçüëß Family</label>
                    <input type="range" min="1" max="10" value="5" class="masking-slider" id="mask-family">
                    <div class="masking-labels">
                        <span>Fully myself</span>
                        <span>Somewhat masked</span>
                        <span>Heavily masked</span>
                    </div>
                </div>

                <div class="masking-slider-container">
                    <label>üíë Partner/Close Friends</label>
                    <input type="range" min="1" max="10" value="3" class="masking-slider" id="mask-partner">
                    <div class="masking-labels">
                        <span>Fully myself</span>
                        <span>Somewhat masked</span>
                        <span>Heavily masked</span>
                    </div>
                </div>

                <div class="masking-slider-container">
                    <label>üë• Social Acquaintances</label>
                    <input type="range" min="1" max="10" value="7" class="masking-slider" id="mask-social">
                    <div class="masking-labels">
                        <span>Fully myself</span>
                        <span>Somewhat masked</span>
                        <span>Heavily masked</span>
                    </div>
                </div>

                <div class="masking-slider-container">
                    <label>üíº Work Colleagues</label>
                    <input type="range" min="1" max="10" value="8" class="masking-slider" id="mask-work">
                    <div class="masking-labels">
                        <span>Fully myself</span>
                        <span>Somewhat masked</span>
                        <span>Heavily masked</span>
                    </div>
                </div>

                <div class="masking-slider-container">
                    <label>üëî Boss/Authority Figures</label>
                    <input type="range" min="1" max="10" value="9" class="masking-slider" id="mask-authority">
                    <div class="masking-labels">
                        <span>Fully myself</span>
                        <span>Somewhat masked</span>
                        <span>Heavily masked</span>
                    </div>
                </div>

                <div class="masking-slider-container">
                    <label>üõí Strangers/Service Staff</label>
                    <input type="range" min="1" max="10" value="6" class="masking-slider" id="mask-strangers">
                    <div class="masking-labels">
                        <span>Fully myself</span>
                        <span>Somewhat masked</span>
                        <span>Heavily masked</span>
                    </div>
                </div>
            </div>

            <!-- Unmasking Reflection -->
            <div class="boundary-card" style="margin-bottom: 25px;">
                <h4>üí≠ Reflection: Where Could You Unmask More?</h4>
                <p class="prompt">Looking at your sliders, where might you be over-masking? What would unmasking look like in that relationship?</p>
                <textarea id="unmask-reflection" placeholder="e.g., I mask heavily at work but my manager seems understanding. Maybe I could try... Or with my partner, I could be more honest about..."></textarea>
            </div>

            <div class="save-section">
                <button class="save-btn" onclick="saveAll()">üíæ Save Masking Insights</button>
                <div class="save-status" id="saveStatus3"></div>
            </div>
        </div>

        <!-- Section 4: Relationship Types -->
        <div id="relationships" class="section-card">
            <h3 class="section-title">üë• Relationship Types</h3>
            <p class="section-intro">Different relationships have different rules. Understanding what you need from each type helps you set appropriate expectations and boundaries.</p>

            <div class="audhd-insight">
                <h4>üß† Spark Insight</h4>
                <p>Spark brains often have intense but inconsistent social needs. <strong>ADHD</strong> craves connection and novelty, while <strong>autism</strong> needs predictability and alone time. Honouring both means being intentional about WHO gets your energy.</p>
            </div>

            <!-- Quick Reference: Relationship Tiers -->
            <h4 style="color: #2d1b4e; margin-bottom: 15px;">üéØ Your Relationship Tiers</h4>
            <div class="quick-ref-grid">
                <div class="quick-ref-card">
                    <h5>üî• Inner Circle (2-5 people)</h5>
                    <p>"These people get unmasked me, access to my energy when I'm depleted, and the real answers when they ask how I am."</p>
                </div>
                <div class="quick-ref-card">
                    <h5>üå§Ô∏è Close Friends (5-10 people)</h5>
                    <p>"I enjoy these people and share meaningfully with them, but I also have boundaries and don't owe them constant availability."</p>
                </div>
                <div class="quick-ref-card">
                    <h5>‚òÅÔ∏è Acquaintances (unlimited)</h5>
                    <p>"Pleasant, surface-level connection. I keep things light and don't invest emotional energy I can't afford."</p>
                </div>
            </div>

            <!-- Relationship Reflections -->
            <h4 style="color: #2d1b4e; margin: 25px 0 15px;">üìù Relationship Reflections</h4>
            <div class="reflection-accordion">
                <!-- Partner/Closest Person -->
                <div class="reflection-item">
                    <div class="reflection-header" onclick="toggleReflection(this)">
                        <h4>üíë Partner / Closest Person</h4>
                        <span class="arrow">‚ñº</span>
                    </div>
                    <div class="reflection-content">
                        <div class="reflection-question">
                            <label>What do I need them to understand about my Spark?</label>
                            <textarea id="rel-partner-understand" placeholder="e.g., When I go quiet it's not about them. I need alone time to function. My memory issues aren't lack of caring..."></textarea>
                        </div>
                        <div class="reflection-question">
                            <label>What boundaries do I need with them?</label>
                            <textarea id="rel-partner-boundaries" placeholder="e.g., Don't take my phone away during hyperfocus. Let me have my routines. Give me processing time before big decisions..."></textarea>
                        </div>
                        <div class="reflection-question">
                            <label>How can I communicate my needs more clearly?</label>
                            <textarea id="rel-partner-communicate" placeholder="e.g., Use 'I need' statements instead of hoping they'll notice. Tell them my social battery level at the start of events..."></textarea>
                        </div>
                    </div>
                </div>

                <!-- Family -->
                <div class="reflection-item">
                    <div class="reflection-header" onclick="toggleReflection(this)">
                        <h4>üë®‚Äçüë©‚Äçüëß Family</h4>
                        <span class="arrow">‚ñº</span>
                    </div>
                    <div class="reflection-content">
                        <div class="reflection-question">
                            <label>What family dynamics are challenging for my Spark?</label>
                            <textarea id="rel-family-challenges" placeholder="e.g., Loud gatherings, last-minute plans, being expected to 'just cope', people dismissing my needs..."></textarea>
                        </div>
                        <div class="reflection-question">
                            <label>What boundaries do I need with family?</label>
                            <textarea id="rel-family-boundaries" placeholder="e.g., Limited visit durations, quiet room to escape to, advance notice of events, not discussing my diagnosis..."></textarea>
                        </div>
                    </div>
                </div>

                <!-- Work -->
                <div class="reflection-item">
                    <div class="reflection-header" onclick="toggleReflection(this)">
                        <h4>üíº Work Relationships</h4>
                        <span class="arrow">‚ñº</span>
                    </div>
                    <div class="reflection-content">
                        <div class="reflection-question">
                            <label>What work situations are hardest for my Spark?</label>
                            <textarea id="rel-work-challenges" placeholder="e.g., Open plan offices, unclear expectations, changing priorities, after-work socialising, meetings without agendas..."></textarea>
                        </div>
                        <div class="reflection-question">
                            <label>What accommodations would help?</label>
                            <textarea id="rel-work-accommodations" placeholder="e.g., Written instructions, flexible hours, quiet workspace, camera-off option, meeting agendas in advance..."></textarea>
                        </div>
                        <div class="reflection-question">
                            <label>What do colleagues need to know (without oversharing)?</label>
                            <textarea id="rel-work-share" placeholder="e.g., I work best with clear deadlines. I'm not being rude, I'm being direct. I need written summaries of verbal conversations..."></textarea>
                        </div>
                    </div>
                </div>

                <!-- Friends -->
                <div class="reflection-item">
                    <div class="reflection-header" onclick="toggleReflection(this)">
                        <h4>üëã Friendships</h4>
                        <span class="arrow">‚ñº</span>
                    </div>
                    <div class="reflection-content">
                        <div class="reflection-question">
                            <label>What kind of friends do I actually want?</label>
                            <textarea id="rel-friends-want" placeholder="e.g., People who don't need constant contact, who share interests, who understand when I cancel, who like deep conversations..."></textarea>
                        </div>
                        <div class="reflection-question">
                            <label>What friendship patterns don't work for me?</label>
                            <textarea id="rel-friends-patterns" placeholder="e.g., People who get offended by slow replies, spontaneous plan-makers, small-talk-only friendships, people who drain my energy..."></textarea>
                        </div>
                        <div class="reflection-question">
                            <label>How can I maintain friendships that matter to me?</label>
                            <textarea id="rel-friends-maintain" placeholder="e.g., Schedule regular catch-ups so I don't forget, use voice notes, have low-effort rituals like weekly gaming sessions..."></textarea>
                        </div>
                    </div>
                </div>
            </div>

            <div class="save-section">
                <button class="save-btn" onclick="saveAll()">üíæ Save Relationship Reflections</button>
                <div class="save-status" id="saveStatus4"></div>
            </div>
        </div>
    </div>

    <script>
        // Get current user
        const currentUser = JSON.parse(localStorage.getItem('syp_user') || '{}');
        const STORAGE_KEY = 'audhd_relationships_' + (currentUser.id || 'anonymous');

        // PostgreSQL sync
        const API_BASE = 'https://sparkhub-be-qtmmb.ondigitalocean.app';
        const EXERCISE_TYPE = 'relationships';

        function getAuthToken() {
            return localStorage.getItem('syp_token');
        }

        // Smart back navigation based on programme type
        function goBackToPortal() {
            const savedUser = localStorage.getItem('syp_user');
            if (savedUser) {
                try {
                    const user = JSON.parse(savedUser);
                    const access = user.programme_access || user.programme_type || 'career';
                    if (access === 'blended' || access === 'career') {
                        window.location.href = 'client-portal.html';
                    } else {
                        window.location.href = 'audhd-dashboard.html';
                    }
                    return;
                } catch(e) {}
            }
            window.location.href = 'client-portal.html';
        }

        // Data source indicator
        function updateDataSource(isLive) {
            const indicator = document.getElementById('dataSource');
            if (isLive) {
                indicator.className = 'data-source live';
                indicator.innerHTML = '<span>‚òÅÔ∏è</span> <span id="dataSourceText">Synced</span>';
            } else {
                indicator.className = 'data-source cached';
                indicator.innerHTML = '<span>üíæ</span> <span id="dataSourceText">Cached</span>';
            }
        }

        // Section navigation
        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.section-card').forEach(card => {
                card.classList.remove('active');
            });
            // Show target section
            document.getElementById(sectionId).classList.add('active');

            // Update nav tabs
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');

            // Scroll to top of section
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Accordion toggle
        function toggleReflection(header) {
            const item = header.parentElement;
            item.classList.toggle('open');
        }

        // Collect all data
        function collectData() {
            // Get checked values
            const checkedValues = [];
            document.querySelectorAll('input[name="value"]:checked').forEach(cb => {
                checkedValues.push(cb.value);
            });

            return {
                // Values
                values: {
                    selected: checkedValues,
                    other: document.getElementById('values-other')?.value || '',
                    top1: document.getElementById('value-top1')?.value || '',
                    top2: document.getElementById('value-top2')?.value || '',
                    top3: document.getElementById('value-top3')?.value || '',
                    honoured: document.getElementById('values-honoured')?.value || '',
                    violated: document.getElementById('values-violated')?.value || '',
                    statement: document.getElementById('values-statement')?.value || '',
                    // What I Bring
                    strengths: document.getElementById('strengths-relationships')?.value || '',
                    gifts: document.getElementById('gifts-relationships')?.value || '',
                    compliments: document.getElementById('compliments-received')?.value || '',
                    luckyToHave: document.getElementById('lucky-to-have')?.value || ''
                },
                // Boundaries
                boundaries: {
                    time: document.getElementById('boundary-time')?.value || '',
                    energy: document.getElementById('boundary-energy')?.value || '',
                    communication: document.getElementById('boundary-communication')?.value || '',
                    emotional: document.getElementById('boundary-emotional')?.value || '',
                    physical: document.getElementById('boundary-physical')?.value || '',
                    work: document.getElementById('boundary-work')?.value || ''
                },
                // Scripts
                scripts: {
                    no: document.getElementById('script-no')?.value || '',
                    limits: document.getElementById('script-limits')?.value || '',
                    needs: document.getElementById('script-needs')?.value || '',
                    interruptions: document.getElementById('script-interruptions')?.value || '',
                    repair: document.getElementById('script-repair')?.value || ''
                },
                // Masking
                masking: {
                    family: document.getElementById('mask-family')?.value || 5,
                    partner: document.getElementById('mask-partner')?.value || 3,
                    social: document.getElementById('mask-social')?.value || 7,
                    work: document.getElementById('mask-work')?.value || 8,
                    authority: document.getElementById('mask-authority')?.value || 9,
                    strangers: document.getElementById('mask-strangers')?.value || 6,
                    unmaskReflection: document.getElementById('unmask-reflection')?.value || ''
                },
                // Relationships
                relationships: {
                    partner: {
                        understand: document.getElementById('rel-partner-understand')?.value || '',
                        boundaries: document.getElementById('rel-partner-boundaries')?.value || '',
                        communicate: document.getElementById('rel-partner-communicate')?.value || ''
                    },
                    family: {
                        challenges: document.getElementById('rel-family-challenges')?.value || '',
                        boundaries: document.getElementById('rel-family-boundaries')?.value || ''
                    },
                    work: {
                        challenges: document.getElementById('rel-work-challenges')?.value || '',
                        accommodations: document.getElementById('rel-work-accommodations')?.value || '',
                        share: document.getElementById('rel-work-share')?.value || ''
                    },
                    friends: {
                        want: document.getElementById('rel-friends-want')?.value || '',
                        patterns: document.getElementById('rel-friends-patterns')?.value || '',
                        maintain: document.getElementById('rel-friends-maintain')?.value || ''
                    }
                },
                lastSaved: new Date().toISOString()
            };
        }

        // Populate form from saved data
        function populateForm(data) {
            if (!data) return;

            // Values
            if (data.values) {
                // Check the selected values
                if (data.values.selected && Array.isArray(data.values.selected)) {
                    data.values.selected.forEach(value => {
                        const checkbox = document.querySelector(`input[name="value"][value="${value}"]`);
                        if (checkbox) checkbox.checked = true;
                    });
                }
                // Other text fields
                if (data.values.other) document.getElementById('values-other').value = data.values.other;
                if (data.values.top1) document.getElementById('value-top1').value = data.values.top1;
                if (data.values.top2) document.getElementById('value-top2').value = data.values.top2;
                if (data.values.top3) document.getElementById('value-top3').value = data.values.top3;
                if (data.values.honoured) document.getElementById('values-honoured').value = data.values.honoured;
                if (data.values.violated) document.getElementById('values-violated').value = data.values.violated;
                if (data.values.statement) document.getElementById('values-statement').value = data.values.statement;
                // What I Bring
                if (data.values.strengths) document.getElementById('strengths-relationships').value = data.values.strengths;
                if (data.values.gifts) document.getElementById('gifts-relationships').value = data.values.gifts;
                if (data.values.compliments) document.getElementById('compliments-received').value = data.values.compliments;
                if (data.values.luckyToHave) document.getElementById('lucky-to-have').value = data.values.luckyToHave;
            }

            // Boundaries
            if (data.boundaries) {
                Object.keys(data.boundaries).forEach(key => {
                    const el = document.getElementById('boundary-' + key);
                    if (el) el.value = data.boundaries[key];
                });
            }

            // Scripts
            if (data.scripts) {
                Object.keys(data.scripts).forEach(key => {
                    const el = document.getElementById('script-' + key);
                    if (el) el.value = data.scripts[key];
                });
            }

            // Masking
            if (data.masking) {
                ['family', 'partner', 'social', 'work', 'authority', 'strangers'].forEach(key => {
                    const el = document.getElementById('mask-' + key);
                    if (el && data.masking[key]) el.value = data.masking[key];
                });
                if (data.masking.unmaskReflection) {
                    document.getElementById('unmask-reflection').value = data.masking.unmaskReflection;
                }
            }

            // Relationships
            if (data.relationships) {
                // Partner
                if (data.relationships.partner) {
                    Object.keys(data.relationships.partner).forEach(key => {
                        const el = document.getElementById('rel-partner-' + key);
                        if (el) el.value = data.relationships.partner[key];
                    });
                }
                // Family
                if (data.relationships.family) {
                    Object.keys(data.relationships.family).forEach(key => {
                        const el = document.getElementById('rel-family-' + key);
                        if (el) el.value = data.relationships.family[key];
                    });
                }
                // Work
                if (data.relationships.work) {
                    Object.keys(data.relationships.work).forEach(key => {
                        const el = document.getElementById('rel-work-' + key);
                        if (el) el.value = data.relationships.work[key];
                    });
                }
                // Friends
                if (data.relationships.friends) {
                    Object.keys(data.relationships.friends).forEach(key => {
                        const el = document.getElementById('rel-friends-' + key);
                        if (el) el.value = data.relationships.friends[key];
                    });
                }
            }
        }

        // Save all data to PostgreSQL (with localStorage backup)
        async function saveAll() {
            const data = collectData();

            // Always save to localStorage first
            localStorage.setItem(STORAGE_KEY, JSON.stringify(data));

            const token = getAuthToken();
            let saveMessage = '‚úì Saved locally';

            if (token) {
                try {
                    const response = await fetch(`${API_BASE}/api/crm/syp/exercises/${EXERCISE_TYPE}/`, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ data })
                    });

                    if (response.ok) {
                        console.log('‚úÖ Relationships data saved to PostgreSQL');
                        saveMessage = '‚úì Saved to cloud!';
                        updateDataSource(true);
                    } else {
                        updateDataSource(false);
                    }
                } catch (error) {
                    console.log('‚ö†Ô∏è PostgreSQL save failed:', error.message);
                    updateDataSource(false);
                }
            }

            // Update all status messages
            document.querySelectorAll('.save-status').forEach(el => {
                el.textContent = saveMessage;
                el.classList.add('success');
            });

            // Clear status after 3 seconds
            setTimeout(() => {
                document.querySelectorAll('.save-status').forEach(el => {
                    el.textContent = '';
                    el.classList.remove('success');
                });
            }, 3000);
        }

        // Load saved data from PostgreSQL on page load
        window.onload = async function() {
            const token = getAuthToken();

            // Try PostgreSQL first
            if (token) {
                try {
                    const response = await fetch(`${API_BASE}/api/crm/syp/exercises/${EXERCISE_TYPE}/`, {
                        method: 'GET',
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json'
                        }
                    });

                    if (response.ok) {
                        const result = await response.json();
                        if (result.data && Object.keys(result.data).length > 0) {
                            populateForm(result.data);
                            localStorage.setItem(STORAGE_KEY, JSON.stringify(result.data));
                            console.log('‚úÖ Relationships data loaded from PostgreSQL');
                            updateDataSource(true);
                        }
                        setupAutoSave();
                        return;
                    }
                } catch (error) {
                    console.log('‚ö†Ô∏è PostgreSQL unavailable:', error.message);
                }
            }

            // Fallback to localStorage
            const saved = localStorage.getItem(STORAGE_KEY);
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    populateForm(data);
                    console.log('üì¶ Relationships data loaded from localStorage');
                    updateDataSource(false);
                } catch (e) {
                    console.error('Error loading saved data:', e);
                }
            }

            setupAutoSave();
        };

        // Setup auto-save listeners
        function setupAutoSave() {
            let saveTimeout;
            document.querySelectorAll('textarea, input[type="range"], input[type="text"], input[type="checkbox"]').forEach(el => {
                el.addEventListener('input', () => {
                    clearTimeout(saveTimeout);
                    saveTimeout = setTimeout(saveAll, 2000);
                });
                el.addEventListener('change', () => {
                    clearTimeout(saveTimeout);
                    saveTimeout = setTimeout(saveAll, 2000);
                });
            });
        }
    </script>
</body>
</html>
