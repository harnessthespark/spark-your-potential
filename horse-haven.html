<!DOCTYPE html>
<html lang="en-GB">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Horse Haven - Your Safe Space</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üê¥</text></svg>">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            min-height: 100vh;
            min-height: 100dvh;
            background: linear-gradient(180deg, #87CEEB 0%, #98D8AA 50%, #7B9E6B 100%);
            overflow-x: hidden;
        }

        /* Clouds animation */
        .sky {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 200px;
            pointer-events: none;
            overflow: hidden;
            z-index: 0;
        }

        .cloud {
            position: absolute;
            font-size: 40px;
            opacity: 0.8;
            animation: drift 30s linear infinite;
        }

        .cloud:nth-child(1) { top: 20px; animation-delay: 0s; }
        .cloud:nth-child(2) { top: 60px; animation-delay: -10s; font-size: 30px; }
        .cloud:nth-child(3) { top: 100px; animation-delay: -20s; font-size: 50px; }

        @keyframes drift {
            from { transform: translateX(-100px); }
            to { transform: translateX(calc(100vw + 100px)); }
        }

        /* Main container */
        .container {
            position: relative;
            z-index: 1;
            max-width: 500px;
            margin: 0 auto;
            padding: 20px;
            padding-bottom: 100px;
        }

        /* Header with horse */
        .header {
            text-align: center;
            padding: 20px 0;
        }

        .horse-container {
            position: relative;
            display: inline-block;
        }

        .horse {
            width: 120px;
            height: 120px;
            animation: horseIdle 2s ease-in-out infinite;
            cursor: pointer;
            transition: transform 0.2s;
            display: inline-block;
            object-fit: contain;
        }

        .horse:active {
            transform: scale(1.2);
        }

        .horse.happy {
            animation: horseHappy 0.5s ease-in-out;
        }

        .horse.nuzzle {
            animation: horseNuzzle 0.6s ease-in-out;
        }

        @keyframes horseIdle {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        @keyframes horseHappy {
            0%, 100% { transform: rotate(0deg) scale(1); }
            25% { transform: rotate(-10deg) scale(1.1); }
            75% { transform: rotate(10deg) scale(1.1); }
        }

        @keyframes horseNuzzle {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px) rotate(-5deg); }
            75% { transform: translateX(10px) rotate(5deg); }
        }

        .horse-name {
            font-size: 1.5em;
            color: #5D4E37;
            font-weight: bold;
            margin-top: 10px;
            text-shadow: 2px 2px 0 white;
        }

        .horse-speech {
            background: white;
            border-radius: 20px;
            padding: 12px 20px;
            margin: 15px auto;
            max-width: 280px;
            position: relative;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            font-size: 1.1em;
            color: #5D4E37;
            animation: popIn 0.3s ease-out;
        }

        .horse-speech::after {
            content: '';
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            border: 10px solid transparent;
            border-bottom-color: white;
            border-top: 0;
        }

        @keyframes popIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        /* Horseshoe counter */
        .horseshoe-counter {
            position: fixed;
            top: 15px;
            right: 15px;
            background: linear-gradient(135deg, #FFD700, #FFA500);
            border-radius: 25px;
            padding: 8px 16px;
            font-size: 1.2em;
            font-weight: bold;
            color: #5D4E37;
            box-shadow: 0 4px 15px rgba(255,165,0,0.4);
            z-index: 100;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .horseshoe-counter .icon {
            font-size: 1.3em;
        }

        .horseshoe-pop {
            animation: horseshoePop 0.5s ease-out;
        }

        @keyframes horseshoePop {
            0% { transform: scale(1); }
            50% { transform: scale(1.3); }
            100% { transform: scale(1); }
        }

        /* Activity cards */
        .activities {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .activity-card {
            background: white;
            border-radius: 20px;
            padding: 20px 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border: 3px solid transparent;
        }

        .activity-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .activity-card:active {
            transform: scale(0.95);
        }

        .activity-card.active {
            border-color: #98D8AA;
        }

        .activity-card .icon {
            font-size: 40px;
            margin-bottom: 10px;
            display: block;
        }

        .activity-card .label {
            font-size: 1em;
            color: #5D4E37;
            font-weight: 600;
        }

        /* Mood meadow */
        .mood-section {
            background: white;
            border-radius: 25px;
            padding: 25px;
            margin-top: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            display: none;
        }

        .mood-section.visible {
            display: block;
            animation: slideUp 0.3s ease-out;
        }

        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .section-title {
            font-size: 1.3em;
            color: #5D4E37;
            text-align: center;
            margin-bottom: 20px;
        }

        .mood-options {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 10px;
        }

        .mood-btn {
            background: #f8f8f8;
            border: 3px solid #eee;
            border-radius: 15px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
            min-width: 80px;
        }

        .mood-btn:hover, .mood-btn:active {
            transform: scale(1.1);
            border-color: #98D8AA;
            background: #f0fff4;
        }

        .mood-btn .emoji {
            font-size: 35px;
            display: block;
        }

        .mood-btn .text {
            font-size: 0.8em;
            color: #666;
            margin-top: 5px;
        }

        /* Worry stable */
        .worry-section {
            background: linear-gradient(135deg, #FFF8E7, #FFE4C4);
            border-radius: 25px;
            padding: 25px;
            margin-top: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            display: none;
        }

        .worry-section.visible {
            display: block;
            animation: slideUp 0.3s ease-out;
        }

        .worry-input {
            width: 100%;
            padding: 15px;
            border: 2px dashed #DEB887;
            border-radius: 15px;
            font-size: 1.1em;
            background: white;
            resize: none;
            min-height: 100px;
            font-family: inherit;
        }

        .worry-input:focus {
            outline: none;
            border-color: #CD853F;
        }

        .worry-input::placeholder {
            color: #BDB76B;
        }

        .send-worry-btn {
            width: 100%;
            margin-top: 15px;
            padding: 15px 25px;
            background: linear-gradient(135deg, #98D8AA, #7BC88C);
            border: none;
            border-radius: 15px;
            color: white;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .send-worry-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(123,200,140,0.4);
        }

        .send-worry-btn:active {
            transform: scale(0.98);
        }

        .worry-sent {
            text-align: center;
            padding: 30px;
            display: none;
        }

        .worry-sent.visible {
            display: block;
            animation: popIn 0.4s ease-out;
        }

        .worry-sent .emoji {
            font-size: 60px;
            animation: trotAway 1.5s ease-out forwards;
            display: inline-block;
        }

        @keyframes trotAway {
            0% { transform: translateX(0) scale(1); opacity: 1; }
            100% { transform: translateX(100px) scale(0.5); opacity: 0; }
        }

        .worry-sent .message {
            font-size: 1.2em;
            color: #5D4E37;
            margin-top: 15px;
        }

        /* Golden horseshoes (gratitude) */
        .horseshoe-section {
            background: linear-gradient(135deg, #FFF9E6, #FFF3CD);
            border-radius: 25px;
            padding: 25px;
            margin-top: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            display: none;
        }

        .horseshoe-section.visible {
            display: block;
            animation: slideUp 0.3s ease-out;
        }

        .horseshoe-input-row {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .horseshoe-input {
            flex: 1;
            padding: 12px 15px;
            border: 2px solid #FFD700;
            border-radius: 12px;
            font-size: 1em;
            background: white;
        }

        .horseshoe-input:focus {
            outline: none;
            border-color: #FFA500;
        }

        .horseshoe-add-btn {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #FFD700, #FFA500);
            border: none;
            border-radius: 12px;
            font-size: 1.5em;
            cursor: pointer;
            transition: all 0.2s;
        }

        .horseshoe-add-btn:hover {
            transform: scale(1.1);
        }

        .horseshoe-list {
            list-style: none;
            max-height: 250px;
            overflow-y: auto;
        }

        .horseshoe-item {
            background: white;
            border-radius: 12px;
            padding: 12px 15px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            animation: popIn 0.3s ease-out;
            border: 2px solid #FFE4B5;
        }

        .horseshoe-item .shoe {
            font-size: 1.5em;
        }

        .horseshoe-item .text {
            flex: 1;
            color: #5D4E37;
        }

        .quick-adds {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px dashed #FFE4B5;
        }

        .quick-add {
            background: white;
            border: 2px solid #FFD700;
            border-radius: 20px;
            padding: 8px 14px;
            font-size: 0.9em;
            cursor: pointer;
            transition: all 0.2s;
        }

        .quick-add:hover, .quick-add:active {
            background: #FFF9E6;
            transform: scale(1.05);
        }

        /* Breathing exercise */
        .breathing-section {
            background: linear-gradient(135deg, #E8F4FD, #D4E9F7);
            border-radius: 25px;
            padding: 25px;
            margin-top: 20px;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            display: none;
        }

        .breathing-section.visible {
            display: block;
            animation: slideUp 0.3s ease-out;
        }

        .breathing-horse {
            width: 100px;
            height: 100px;
            margin: 20px 0;
            display: inline-block;
            object-fit: contain;
        }

        .breathing-horse.breathe-in {
            animation: breatheIn 4s ease-in-out;
        }

        .breathing-horse.breathe-out {
            animation: breatheOut 4s ease-in-out;
        }

        @keyframes breatheIn {
            0% { transform: scale(1); }
            100% { transform: scale(1.3); }
        }

        @keyframes breatheOut {
            0% { transform: scale(1.3); }
            100% { transform: scale(1); }
        }

        .breathing-text {
            font-size: 1.5em;
            color: #4A90A4;
            font-weight: bold;
            min-height: 40px;
        }

        .breathing-start-btn {
            margin-top: 20px;
            padding: 15px 40px;
            background: linear-gradient(135deg, #87CEEB, #4A90A4);
            border: none;
            border-radius: 25px;
            color: white;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
        }

        .breathing-start-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(74,144,164,0.4);
        }

        .breathing-progress {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }

        .breath-dot {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            background: #ccc;
            transition: all 0.3s;
        }

        .breath-dot.complete {
            background: #4A90A4;
            transform: scale(1.2);
        }

        /* Kind words */
        .kindwords-section {
            background: linear-gradient(135deg, #FCE4EC, #F8BBD9);
            border-radius: 25px;
            padding: 25px;
            margin-top: 20px;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            display: none;
        }

        .kindwords-section.visible {
            display: block;
            animation: slideUp 0.3s ease-out;
        }

        .kindword-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .kindword-text {
            font-size: 1.3em;
            color: #8B4A6B;
            line-height: 1.5;
            font-style: italic;
        }

        .kindword-btn {
            margin-top: 15px;
            padding: 12px 30px;
            background: linear-gradient(135deg, #E91E63, #AD1457);
            border: none;
            border-radius: 20px;
            color: white;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.2s;
        }

        .kindword-btn:hover {
            transform: scale(1.05);
        }

        /* Game sections shared styles */
        .game-section {
            border-radius: 25px;
            padding: 25px;
            margin-top: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            display: none;
            position: relative;
        }

        .game-section.visible {
            display: block;
            animation: slideUp 0.3s ease-out;
        }

        .game-btn {
            display: block;
            width: 100%;
            margin-top: 15px;
            padding: 15px 25px;
            background: linear-gradient(135deg, #98D8AA, #7BC88C);
            border: none;
            border-radius: 15px;
            color: white;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
        }

        .game-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(123,200,140,0.4);
        }

        .game-btn.secondary {
            background: linear-gradient(135deg, #ccc, #aaa);
            margin-top: 10px;
        }

        .game-card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .game-question {
            font-size: 1.2em;
            color: #5D4E37;
            text-align: center;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .game-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .game-option {
            padding: 15px;
            background: #f8f8f8;
            border: 3px solid #eee;
            border-radius: 12px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }

        .game-option:hover, .game-option:active {
            border-color: #98D8AA;
            background: #f0fff4;
            transform: scale(1.02);
        }

        .game-option.correct {
            background: #d4edda;
            border-color: #28a745;
        }

        .game-option.wrong {
            background: #fff3cd;
            border-color: #ffc107;
        }

        .game-result {
            text-align: center;
            padding: 15px;
            font-size: 1.1em;
            font-weight: bold;
            min-height: 50px;
        }

        /* Stable Helper (orange/brown theme) */
        .stablehelper-section {
            background: linear-gradient(135deg, #FFF3E0, #FFE0B2);
        }

        /* Horse Secrets (golden theme) */
        .secrets-section {
            background: linear-gradient(135deg, #FFF8E1, #FFECB3);
        }

        .secret-card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            text-align: center;
        }

        .secret-badge {
            display: inline-block;
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: #5D4E37;
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 0.9em;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .secret-text {
            font-size: 1.15em;
            color: #5D4E37;
            line-height: 1.6;
        }

        .secret-collection {
            text-align: center;
            color: #B8860B;
            margin-bottom: 10px;
        }

        /* Adventure Tales (purple/blue theme) */
        .adventure-section {
            background: linear-gradient(135deg, #EDE7F6, #D1C4E9);
        }

        .story-card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .story-starter {
            font-size: 1.15em;
            color: #5D4E37;
            line-height: 1.6;
            font-style: italic;
        }

        .story-input {
            width: 100%;
            min-height: 120px;
            padding: 15px;
            border: 2px solid #D1C4E9;
            border-radius: 15px;
            font-size: 1em;
            font-family: inherit;
            resize: none;
            margin-bottom: 10px;
        }

        .story-input:focus {
            outline: none;
            border-color: #9575CD;
        }

        /* Puzzle Paddock (green theme) */
        .puzzle-section {
            background: linear-gradient(135deg, #E8F5E9, #C8E6C9);
        }

        .puzzle-card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            text-align: center;
        }

        .scrambled-word {
            font-size: 1.8em;
            font-weight: bold;
            color: #2E7D32;
            letter-spacing: 5px;
            margin-bottom: 10px;
        }

        .puzzle-hint {
            color: #666;
            font-style: italic;
        }

        .letter-tiles {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 8px;
            margin-bottom: 15px;
        }

        .letter-tile {
            width: 45px;
            height: 45px;
            background: white;
            border: 2px solid #4CAF50;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
        }

        .letter-tile:hover {
            background: #E8F5E9;
            transform: scale(1.1);
        }

        .letter-tile.used {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .answer-tiles {
            display: flex;
            justify-content: center;
            gap: 5px;
            margin-bottom: 15px;
            min-height: 50px;
        }

        .answer-slot {
            width: 40px;
            height: 45px;
            background: #f0f0f0;
            border: 2px dashed #ccc;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
            font-weight: bold;
        }

        .answer-slot.filled {
            background: #C8E6C9;
            border: 2px solid #4CAF50;
            cursor: pointer;
        }

        .puzzle-result {
            text-align: center;
            padding: 10px;
            font-size: 1.1em;
            font-weight: bold;
            min-height: 40px;
        }

        /* Daily Quest (gold/star theme) */
        .quest-section {
            background: linear-gradient(135deg, #FFF9C4, #FFF176);
        }

        .quest-card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            text-align: center;
        }

        .quest-type {
            display: inline-block;
            background: linear-gradient(135deg, #FFD700, #FFA000);
            color: #5D4E37;
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 0.9em;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .quest-text {
            font-size: 1.15em;
            color: #5D4E37;
            line-height: 1.6;
        }

        .quest-status {
            text-align: center;
            padding: 10px;
            font-size: 1em;
            color: #666;
        }

        .quest-status.completed {
            color: #2E7D32;
            font-weight: bold;
        }

        /* Setup screen */
        .setup-screen {
            position: fixed;
            inset: 0;
            background: linear-gradient(180deg, #87CEEB 0%, #98D8AA 50%, #7BC88C 100%);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 30px;
            text-align: center;
        }

        .setup-screen.hidden {
            display: none;
        }

        .setup-horse {
            width: 150px;
            height: 150px;
            animation: horseIdle 2s ease-in-out infinite;
            object-fit: contain;
        }

        .setup-title {
            font-size: 1.8em;
            color: #5D4E37;
            margin: 20px 0 10px;
            text-shadow: 2px 2px 0 white;
        }

        .setup-subtitle {
            font-size: 1.1em;
            color: #5D4E37;
            margin-bottom: 30px;
        }

        .setup-input {
            width: 100%;
            max-width: 280px;
            padding: 15px 20px;
            border: 3px solid white;
            border-radius: 15px;
            font-size: 1.2em;
            text-align: center;
            background: white;
            color: #5D4E37;
        }

        .setup-input:focus {
            outline: none;
            border-color: #FFD700;
        }

        .setup-btn {
            margin-top: 20px;
            padding: 15px 50px;
            background: linear-gradient(135deg, #FFD700, #FFA500);
            border: none;
            border-radius: 25px;
            font-size: 1.2em;
            font-weight: bold;
            color: #5D4E37;
            cursor: pointer;
            transition: all 0.2s;
        }

        .setup-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(255,165,0,0.4);
        }

        .setup-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Close button for sections */
        .close-section {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 35px;
            height: 35px;
            background: #f0f0f0;
            border: none;
            border-radius: 50%;
            font-size: 1.2em;
            cursor: pointer;
            color: #888;
            transition: all 0.2s;
        }

        .close-section:hover {
            background: #e0e0e0;
            color: #555;
        }

        /* Make sections relative for close button */
        .mood-section, .worry-section, .horseshoe-section, .breathing-section, .kindwords-section {
            position: relative;
        }

        /* Floating horseshoe animation */
        .floating-horseshoe {
            position: fixed;
            font-size: 30px;
            pointer-events: none;
            z-index: 1000;
            animation: floatUp 1s ease-out forwards;
        }

        @keyframes floatUp {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-100px) scale(1.5); opacity: 0; }
        }

        /* Streak display */
        .streak-badge {
            position: fixed;
            top: 15px;
            left: 15px;
            background: linear-gradient(135deg, #FF6B6B, #EE5A5A);
            border-radius: 20px;
            padding: 8px 14px;
            font-size: 1em;
            font-weight: bold;
            color: white;
            box-shadow: 0 4px 15px rgba(255,107,107,0.4);
            z-index: 100;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* Tap hint */
        .tap-hint {
            font-size: 0.85em;
            color: #888;
            text-align: center;
            margin-top: 10px;
        }

        /* Empty state */
        .empty-state {
            text-align: center;
            color: #999;
            padding: 20px;
            font-style: italic;
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 30px 20px;
            color: #5D4E37;
            opacity: 0.7;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <!-- Clouds in sky -->
    <div class="sky">
        <div class="cloud">‚òÅÔ∏è</div>
        <div class="cloud">‚òÅÔ∏è</div>
        <div class="cloud">‚òÅÔ∏è</div>
    </div>

    <!-- Setup screen (name your horse) -->
    <div class="setup-screen" id="setupScreen">
        <img src="horse-mascot.png" alt="Your horse friend" class="setup-horse">
        <h1 class="setup-title">Welcome to Horse Haven!</h1>
        <p class="setup-subtitle">Your horse is waiting to meet you.<br>What would you like to call them?</p>
        <input type="text" class="setup-input" id="horseNameInput" placeholder="Enter a name..." maxlength="15" autofocus>
        <button class="setup-btn" id="setupBtn" onclick="completeSetup()" disabled>Let's Go! üê¥</button>
    </div>

    <!-- Main content -->
    <div class="container">
        <!-- Horseshoe counter -->
        <div class="horseshoe-counter" id="horseshoeCounter">
            <span class="icon">üß≤</span>
            <span id="horseshoeCount">0</span>
        </div>

        <!-- Streak badge -->
        <div class="streak-badge" id="streakBadge" style="display: none;">
            <span>üî•</span>
            <span id="streakCount">0</span> day streak!
        </div>

        <!-- Header with horse -->
        <div class="header">
            <div class="horse-container">
                <img src="horse-mascot.png" alt="Your horse friend" class="horse" id="horse" onclick="petHorse()">
            </div>
            <div class="horse-name" id="horseName">Your Horse</div>
            <div class="horse-speech" id="horseSpeech">Tap me to say hello! üíï</div>
            <p class="tap-hint">Tap your horse anytime for comfort</p>
        </div>

        <!-- Activity cards -->
        <div class="activities">
            <div class="activity-card" onclick="showSection('mood')">
                <span class="icon">üå§Ô∏è</span>
                <span class="label">How are you?</span>
            </div>
            <div class="activity-card" onclick="showSection('worry')">
                <span class="icon">üè†</span>
                <span class="label">Worry Stable</span>
            </div>
            <div class="activity-card" onclick="showSection('horseshoe')">
                <span class="icon">üß≤</span>
                <span class="label">Good Things</span>
            </div>
            <div class="activity-card" onclick="showSection('breathing')">
                <span class="icon">üå¨Ô∏è</span>
                <span class="label">Calm Breathing</span>
            </div>
            <div class="activity-card" onclick="showSection('kindwords')">
                <span class="icon">üíú</span>
                <span class="label">Kind Words</span>
            </div>
            <div class="activity-card" onclick="showSection('stablehelper')">
                <span class="icon">ü•ï</span>
                <span class="label">Stable Helper</span>
            </div>
            <div class="activity-card" onclick="showSection('secrets')">
                <span class="icon">üåü</span>
                <span class="label">Horse Secrets</span>
            </div>
            <div class="activity-card" onclick="showSection('adventure')">
                <span class="icon">üìñ</span>
                <span class="label">Adventure Tales</span>
            </div>
            <div class="activity-card" onclick="showSection('puzzle')">
                <span class="icon">üß©</span>
                <span class="label">Puzzle Paddock</span>
            </div>
            <div class="activity-card" onclick="showSection('quest')" style="grid-column: span 2;">
                <span class="icon">‚≠ê</span>
                <span class="label">Daily Quest</span>
            </div>
        </div>

        <!-- Mood section -->
        <div class="mood-section" id="moodSection">
            <button class="close-section" onclick="hideSection('mood')">√ó</button>
            <h3 class="section-title">How are you feeling right now?</h3>
            <div class="mood-options">
                <button class="mood-btn" onclick="selectMood('happy', 'That\\'s wonderful! Let\\'s celebrate! üéâ')">
                    <span class="emoji">üòä</span>
                    <span class="text">Happy</span>
                </button>
                <button class="mood-btn" onclick="selectMood('calm', 'Peaceful moments are precious üå∏')">
                    <span class="emoji">üòå</span>
                    <span class="text">Calm</span>
                </button>
                <button class="mood-btn" onclick="selectMood('worried', 'I\\'m here with you. Want to tell me about it?')">
                    <span class="emoji">üòü</span>
                    <span class="text">Worried</span>
                </button>
                <button class="mood-btn" onclick="selectMood('sad', 'It\\'s okay to feel sad. I\\'ll stay right here with you üíï')">
                    <span class="emoji">üò¢</span>
                    <span class="text">Sad</span>
                </button>
                <button class="mood-btn" onclick="selectMood('angry', 'Those feelings are valid. Take a deep breath with me? üå¨Ô∏è')">
                    <span class="emoji">üò†</span>
                    <span class="text">Angry</span>
                </button>
                <button class="mood-btn" onclick="selectMood('tired', 'Rest is important. Be gentle with yourself today üåô')">
                    <span class="emoji">üò¥</span>
                    <span class="text">Tired</span>
                </button>
                <button class="mood-btn" onclick="selectMood('confused', 'That\\'s okay - we don\\'t always have to understand everything üåà')">
                    <span class="emoji">üòï</span>
                    <span class="text">Confused</span>
                </button>
                <button class="mood-btn" onclick="selectMood('excited', 'Your energy is amazing! What\\'s got you buzzing? ‚ö°')">
                    <span class="emoji">ü§©</span>
                    <span class="text">Excited</span>
                </button>
            </div>
        </div>

        <!-- Worry section -->
        <div class="worry-section" id="worrySection">
            <button class="close-section" onclick="hideSection('worry')">√ó</button>
            <h3 class="section-title">üè† Worry Stable</h3>
            <p style="text-align: center; color: #8B7355; margin-bottom: 15px;">
                Write down what's bothering you.<br>
                <span id="horseNameWorry">Your horse</span> will carry it away safely.
            </p>
            <div id="worryForm">
                <textarea class="worry-input" id="worryInput" placeholder="What's on your mind? You can write anything here..."></textarea>
                <button class="send-worry-btn" onclick="sendWorry()">
                    <span>üê¥</span>
                    Give worry to <span id="horseNameBtn">horse</span>
                </button>
            </div>
            <div class="worry-sent" id="worrySent">
                <img src="horse-mascot.png" alt="Horse carrying worry away" class="emoji" style="width: 80px; height: 80px;">
                <p class="message"><span id="horseNameSent">Your horse</span> has carried your worry far away.<br>It's safe now. üíï</p>
                <button class="send-worry-btn" onclick="resetWorry()" style="margin-top: 20px;">
                    Write another worry
                </button>
            </div>
        </div>

        <!-- Horseshoe (gratitude) section -->
        <div class="horseshoe-section" id="horseshoeSection">
            <button class="close-section" onclick="hideSection('horseshoe')">√ó</button>
            <h3 class="section-title">üß≤ Golden Horseshoes</h3>
            <p style="text-align: center; color: #B8860B; margin-bottom: 15px;">
                Collect good moments - even tiny ones count!
            </p>
            <div class="horseshoe-input-row">
                <input type="text" class="horseshoe-input" id="horseshoeInput" placeholder="Something good..." onkeypress="if(event.key==='Enter')addHorseshoe()">
                <button class="horseshoe-add-btn" onclick="addHorseshoe()">+</button>
            </div>
            <ul class="horseshoe-list" id="horseshoeList">
                <li class="empty-state">Add your first golden horseshoe! ‚ú®</li>
            </ul>
            <div class="quick-adds">
                <span style="font-size: 0.85em; color: #B8860B;">Quick add:</span>
                <button class="quick-add" onclick="quickAddHorseshoe('Saw something pretty üå∏')">üå∏ Pretty thing</button>
                <button class="quick-add" onclick="quickAddHorseshoe('Had a yummy snack üç™')">üç™ Nice snack</button>
                <button class="quick-add" onclick="quickAddHorseshoe('Made someone smile üòä')">üòä Made smile</button>
                <button class="quick-add" onclick="quickAddHorseshoe('Felt cosy and warm üß£')">üß£ Felt cosy</button>
                <button class="quick-add" onclick="quickAddHorseshoe('Did something brave üí™')">üí™ Was brave</button>
                <button class="quick-add" onclick="quickAddHorseshoe('Spent time with animals üêæ')">üêæ Animal time</button>
            </div>
        </div>

        <!-- Breathing section -->
        <div class="breathing-section" id="breathingSection">
            <button class="close-section" onclick="hideSection('breathing')">√ó</button>
            <h3 class="section-title">üå¨Ô∏è Breathe with <span id="horseNameBreathing">Your Horse</span></h3>
            <p style="color: #4A90A4; margin-bottom: 10px;">
                Follow along - breathe when your horse breathes
            </p>
            <img src="horse-mascot.png" alt="Breathing horse" class="breathing-horse" id="breathingHorse">
            <div class="breathing-text" id="breathingText">Ready when you are!</div>
            <div class="breathing-progress" id="breathingProgress">
                <div class="breath-dot"></div>
                <div class="breath-dot"></div>
                <div class="breath-dot"></div>
                <div class="breath-dot"></div>
                <div class="breath-dot"></div>
            </div>
            <button class="breathing-start-btn" id="breathingBtn" onclick="startBreathing()">
                Start Breathing üå¨Ô∏è
            </button>
        </div>

        <!-- Kind words section -->
        <div class="kindwords-section" id="kindwordsSection">
            <button class="close-section" onclick="hideSection('kindwords')">√ó</button>
            <h3 class="section-title">üíú A Message from <span id="horseNameKind">Your Horse</span></h3>
            <div class="kindword-card">
                <p class="kindword-text" id="kindwordText">"You are braver than you believe, and stronger than you seem."</p>
            </div>
            <button class="kindword-btn" onclick="newKindWord()">Another message üíï</button>
        </div>

        <!-- Stable Helper (maths disguised as horse care) -->
        <div class="game-section stablehelper-section" id="stablehelperSection">
            <button class="close-section" onclick="hideSection('stablehelper')">√ó</button>
            <h3 class="section-title">ü•ï Stable Helper</h3>
            <p style="text-align: center; color: #8B4513; margin-bottom: 15px;">
                Help <span class="horse-name-inline">your horse</span> with stable jobs!
            </p>
            <div class="game-card" id="stableHelperCard">
                <div class="game-question" id="stableQuestion">Loading...</div>
                <div class="game-options" id="stableOptions"></div>
            </div>
            <div class="game-result" id="stableResult"></div>
            <button class="game-btn" onclick="nextStableHelper()">Next job! ü•ï</button>
        </div>

        <!-- Horse Secrets (fun facts) -->
        <div class="game-section secrets-section" id="secretsSection">
            <button class="close-section" onclick="hideSection('secrets')">√ó</button>
            <h3 class="section-title">üåü Horse Secrets</h3>
            <p style="text-align: center; color: #6B4423; margin-bottom: 15px;">
                Discover amazing things about horses!
            </p>
            <div class="secret-card" id="secretCard">
                <div class="secret-badge">Did you know?</div>
                <p class="secret-text" id="secretText">Loading...</p>
            </div>
            <div class="secret-collection">
                <span>üåü Secrets collected: <strong id="secretsCollected">0</strong></span>
            </div>
            <button class="game-btn" onclick="nextSecret()">Discover another! üåü</button>
        </div>

        <!-- Adventure Tales (creative writing) -->
        <div class="game-section adventure-section" id="adventureSection">
            <button class="close-section" onclick="hideSection('adventure')">√ó</button>
            <h3 class="section-title">üìñ Adventure Tales</h3>
            <p style="text-align: center; color: #4A4A8A; margin-bottom: 15px;">
                What happens next in <span class="horse-name-inline">your horse</span>'s adventure?
            </p>
            <div class="story-card">
                <p class="story-starter" id="storyStarter">Loading...</p>
            </div>
            <textarea class="story-input" id="storyInput" placeholder="Continue the story... what happens next?"></textarea>
            <button class="game-btn" onclick="saveStory()">Save my story! üìñ</button>
            <button class="game-btn secondary" onclick="newStoryStarter()">Different adventure</button>
        </div>

        <!-- Puzzle Paddock (word games) -->
        <div class="game-section puzzle-section" id="puzzleSection">
            <button class="close-section" onclick="hideSection('puzzle')">√ó</button>
            <h3 class="section-title">üß© Puzzle Paddock</h3>
            <p style="text-align: center; color: #2E7D32; margin-bottom: 15px;">
                Unscramble the horse words!
            </p>
            <div class="puzzle-card">
                <div class="scrambled-word" id="scrambledWord">????</div>
                <div class="puzzle-hint" id="puzzleHint">Hint loading...</div>
            </div>
            <div class="letter-tiles" id="letterTiles"></div>
            <div class="answer-tiles" id="answerTiles"></div>
            <div class="puzzle-result" id="puzzleResult"></div>
            <button class="game-btn" onclick="checkPuzzle()">Check answer! ‚úì</button>
            <button class="game-btn secondary" onclick="nextPuzzle()">Skip this one</button>
        </div>

        <!-- Daily Quest -->
        <div class="game-section quest-section" id="questSection">
            <button class="close-section" onclick="hideSection('quest')">√ó</button>
            <h3 class="section-title">‚≠ê Daily Quest</h3>
            <p style="text-align: center; color: #B8860B; margin-bottom: 15px;">
                Today's special mission!
            </p>
            <div class="quest-card" id="questCard">
                <div class="quest-type" id="questType">üéØ Today's Quest</div>
                <p class="quest-text" id="questText">Loading your quest...</p>
            </div>
            <div class="quest-status" id="questStatus"></div>
            <button class="game-btn" id="questBtn" onclick="completeQuest()">I did it! ‚≠ê</button>
        </div>

        <div class="footer">
            <p>Made with üíú for you</p>
            <p style="font-size: 0.8em; margin-top: 5px;">Your data stays on your device</p>
        </div>
    </div>

    <script>
        // ============================================
        // DATA & STATE
        // ============================================
        let userData = {
            horseName: '',
            horseshoes: 0,
            horseshoeItems: [],
            streak: 0,
            lastVisit: null,
            moodHistory: [],
            setupComplete: false
        };

        const kindWords = [
            "You are braver than you believe, and stronger than you seem.",
            "It's okay to take things one moment at a time.",
            "You matter so much, even on the hard days.",
            "Your feelings are valid, all of them.",
            "Tomorrow is a fresh start, with new possibilities.",
            "You don't have to be perfect to be wonderful.",
            "Small steps still move you forward.",
            "It's okay to rest when you need to.",
            "You're doing better than you think you are.",
            "Being different is your superpower.",
            "You are loved, exactly as you are.",
            "It's okay to ask for help - that takes courage.",
            "Your best is always enough.",
            "Tough times don't last, but tough people do.",
            "You bring something special to this world.",
            "It's okay if today was hard. Tomorrow is new.",
            "You deserve kindness, especially from yourself.",
            "Every storm runs out of rain eventually.",
            "You are not alone, even when it feels that way.",
            "Your story isn't over - there's so much more to come."
        ];

        const horseSayings = [
            "I'm so glad you're here! üíï",
            "You're wonderful, you know that?",
            "*happy nuzzle* üê¥üíï",
            "I'm always here for you!",
            "You make me so happy!",
            "Want to go on an adventure?",
            "You're my favourite human!",
            "*gentle whinny* üíï",
            "I believe in you!",
            "We make a great team!",
            "Today is going to be okay.",
            "*soft nose boop* üê¥",
            "You're doing great!",
            "I'm proud of you!",
            "Let's face today together!"
        ];

        // ============================================
        // INITIALIZATION
        // ============================================
        function init() {
            loadData();

            if (!userData.setupComplete) {
                document.getElementById('setupScreen').classList.remove('hidden');
            } else {
                document.getElementById('setupScreen').classList.add('hidden');
                updateUI();
                checkStreak();
                initGames();
            }

            // Setup input handler for setup screen
            const input = document.getElementById('horseNameInput');
            input.addEventListener('input', function() {
                document.getElementById('setupBtn').disabled = this.value.trim().length < 1;
            });
        }

        function loadData() {
            const saved = localStorage.getItem('horse_haven_data');
            if (saved) {
                try {
                    userData = { ...userData, ...JSON.parse(saved) };
                } catch(e) {
                    console.log('Could not load saved data');
                }
            }
        }

        function saveData() {
            localStorage.setItem('horse_haven_data', JSON.stringify(userData));
        }

        function completeSetup() {
            const name = document.getElementById('horseNameInput').value.trim();
            if (!name) return;

            userData.horseName = name;
            userData.setupComplete = true;
            userData.lastVisit = new Date().toDateString();
            saveData();

            document.getElementById('setupScreen').classList.add('hidden');
            updateUI();
            initGames();

            // Welcome message
            setTimeout(() => {
                showHorseSpeech(`Hi! I'm ${name}! I'm so happy to meet you! üéâ`);
                triggerHorseAnimation('happy');
                addHorseshoes(5); // Starting bonus!
            }, 500);
        }

        function updateUI() {
            // Update all horse name references
            const name = userData.horseName || 'Your Horse';
            document.getElementById('horseName').textContent = name;
            document.querySelectorAll('.horse-name-inline').forEach(el => el.textContent = name);
            document.getElementById('horseNameWorry').textContent = name;
            document.getElementById('horseNameBtn').textContent = name;
            document.getElementById('horseNameSent').textContent = name;
            document.getElementById('horseNameBreathing').textContent = name;
            document.getElementById('horseNameKind').textContent = name;

            // Update horseshoe count
            document.getElementById('horseshoeCount').textContent = userData.horseshoes;

            // Update streak
            if (userData.streak > 1) {
                document.getElementById('streakBadge').style.display = 'flex';
                document.getElementById('streakCount').textContent = userData.streak;
            }

            // Render horseshoe items
            renderHorseshoes();
        }

        function checkStreak() {
            const today = new Date().toDateString();
            const lastVisit = userData.lastVisit;

            if (!lastVisit) {
                userData.streak = 1;
            } else if (lastVisit === today) {
                // Same day, do nothing
            } else {
                const last = new Date(lastVisit);
                const now = new Date(today);
                const diffDays = Math.floor((now - last) / (1000 * 60 * 60 * 24));

                if (diffDays === 1) {
                    userData.streak++;
                    if (userData.streak > 1) {
                        setTimeout(() => {
                            showHorseSpeech(`Wow! ${userData.streak} days in a row! You're amazing! üî•`);
                            addHorseshoes(userData.streak);
                        }, 2000);
                    }
                } else if (diffDays > 1) {
                    userData.streak = 1;
                }
            }

            userData.lastVisit = today;
            saveData();
            updateUI();
        }

        // ============================================
        // HORSE INTERACTIONS
        // ============================================
        function petHorse() {
            const saying = horseSayings[Math.floor(Math.random() * horseSayings.length)];
            showHorseSpeech(saying);
            triggerHorseAnimation('nuzzle');

            // 20% chance of bonus horseshoe
            if (Math.random() < 0.2) {
                setTimeout(() => {
                    addHorseshoes(1);
                    showHorseSpeech("Here's a lucky horseshoe for you! üß≤");
                }, 1000);
            }
        }

        function showHorseSpeech(text) {
            const speech = document.getElementById('horseSpeech');
            speech.style.animation = 'none';
            speech.offsetHeight; // Trigger reflow
            speech.style.animation = 'popIn 0.3s ease-out';
            speech.textContent = text;
        }

        function triggerHorseAnimation(type) {
            const horse = document.getElementById('horse');
            horse.classList.remove('happy', 'nuzzle');
            horse.offsetHeight; // Trigger reflow
            horse.classList.add(type);
            setTimeout(() => horse.classList.remove(type), 600);
        }

        // ============================================
        // SECTIONS
        // ============================================
        function showSection(name) {
            // Hide all sections first
            document.querySelectorAll('.mood-section, .worry-section, .horseshoe-section, .breathing-section, .kindwords-section, .game-section')
                .forEach(el => el.classList.remove('visible'));

            // Show selected section
            const section = document.getElementById(name + 'Section');
            if (section) {
                section.classList.add('visible');
                section.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }

        function hideSection(name) {
            const section = document.getElementById(name + 'Section');
            if (section) {
                section.classList.remove('visible');
            }
        }

        // ============================================
        // MOOD
        // ============================================
        function selectMood(mood, response) {
            // Save mood
            userData.moodHistory.push({
                mood: mood,
                timestamp: new Date().toISOString()
            });
            // Keep only last 30
            userData.moodHistory = userData.moodHistory.slice(-30);
            saveData();

            // Horse responds
            showHorseSpeech(response);
            triggerHorseAnimation('nuzzle');

            // Award horseshoe for checking in
            addHorseshoes(1);

            // Close mood section after a moment
            setTimeout(() => hideSection('mood'), 2000);

            // If worried/sad/angry, suggest activities
            if (['worried', 'sad', 'angry'].includes(mood)) {
                setTimeout(() => {
                    showHorseSpeech("Would you like to try breathing together, or tell me what's on your mind? üíï");
                }, 3000);
            }
        }

        // ============================================
        // WORRY STABLE
        // ============================================
        function sendWorry() {
            const input = document.getElementById('worryInput');
            const worry = input.value.trim();

            if (!worry) {
                showHorseSpeech("Write down what's bothering you - I'll carry it away safely üíï");
                return;
            }

            // Hide form, show sent message
            document.getElementById('worryForm').style.display = 'none';
            document.getElementById('worrySent').classList.add('visible');

            // Horse animation
            triggerHorseAnimation('happy');

            // Clear input
            input.value = '';

            // Award horseshoe for being brave
            addHorseshoes(2);

            // Horse message
            setTimeout(() => {
                showHorseSpeech("You're so brave for sharing that. I've got it now. üíï");
            }, 1500);
        }

        function resetWorry() {
            document.getElementById('worryForm').style.display = 'block';
            document.getElementById('worrySent').classList.remove('visible');
        }

        // ============================================
        // GOLDEN HORSESHOES (GRATITUDE)
        // ============================================
        function addHorseshoe() {
            const input = document.getElementById('horseshoeInput');
            const text = input.value.trim();

            if (!text) return;

            userData.horseshoeItems.unshift({
                id: Date.now(),
                text: text,
                timestamp: new Date().toISOString()
            });

            // Keep only last 50
            userData.horseshoeItems = userData.horseshoeItems.slice(0, 50);

            input.value = '';
            addHorseshoes(1);
            saveData();
            renderHorseshoes();

            showHorseSpeech("That's a lovely golden moment! ‚ú®");
            triggerHorseAnimation('happy');
        }

        function quickAddHorseshoe(text) {
            userData.horseshoeItems.unshift({
                id: Date.now(),
                text: text,
                timestamp: new Date().toISOString()
            });

            userData.horseshoeItems = userData.horseshoeItems.slice(0, 50);

            addHorseshoes(1);
            saveData();
            renderHorseshoes();

            showHorseSpeech("Another golden horseshoe! üß≤‚ú®");
            triggerHorseAnimation('happy');
        }

        function renderHorseshoes() {
            const list = document.getElementById('horseshoeList');

            if (userData.horseshoeItems.length === 0) {
                list.innerHTML = '<li class="empty-state">Add your first golden horseshoe! ‚ú®</li>';
                return;
            }

            // Show today's items first, then recent
            const today = new Date().toDateString();
            const items = userData.horseshoeItems.slice(0, 10);

            list.innerHTML = items.map(item => `
                <li class="horseshoe-item">
                    <span class="shoe">üß≤</span>
                    <span class="text">${escapeHtml(item.text)}</span>
                </li>
            `).join('');
        }

        function addHorseshoes(count) {
            userData.horseshoes += count;
            saveData();

            const counter = document.getElementById('horseshoeCounter');
            counter.classList.add('horseshoe-pop');
            setTimeout(() => counter.classList.remove('horseshoe-pop'), 500);

            document.getElementById('horseshoeCount').textContent = userData.horseshoes;

            // Floating horseshoe animation
            createFloatingHorseshoe();
        }

        function createFloatingHorseshoe() {
            const horseshoe = document.createElement('div');
            horseshoe.className = 'floating-horseshoe';
            horseshoe.textContent = 'üß≤';
            horseshoe.style.left = (Math.random() * window.innerWidth * 0.8 + window.innerWidth * 0.1) + 'px';
            horseshoe.style.top = (window.innerHeight * 0.5) + 'px';
            document.body.appendChild(horseshoe);
            setTimeout(() => horseshoe.remove(), 1000);
        }

        // ============================================
        // BREATHING
        // ============================================
        let breathingActive = false;

        function startBreathing() {
            if (breathingActive) return;
            breathingActive = true;

            const btn = document.getElementById('breathingBtn');
            btn.textContent = 'Breathing...';
            btn.disabled = true;

            const horse = document.getElementById('breathingHorse');
            const text = document.getElementById('breathingText');
            const dots = document.querySelectorAll('.breath-dot');

            let breathCount = 0;
            const totalBreaths = 5;

            function doBreath() {
                if (breathCount >= totalBreaths) {
                    // Done!
                    text.textContent = 'Well done! You did it! üåü';
                    btn.textContent = 'Start Again üå¨Ô∏è';
                    btn.disabled = false;
                    breathingActive = false;

                    addHorseshoes(3);
                    showHorseSpeech("That was lovely! I feel so calm now. üíï");
                    triggerHorseAnimation('happy');
                    return;
                }

                // Breathe in
                text.textContent = 'Breathe in... üå¨Ô∏è';
                horse.classList.remove('breathe-out');
                horse.classList.add('breathe-in');

                setTimeout(() => {
                    // Hold
                    text.textContent = 'Hold... ‚ú®';
                }, 4000);

                setTimeout(() => {
                    // Breathe out
                    text.textContent = 'Breathe out... üí®';
                    horse.classList.remove('breathe-in');
                    horse.classList.add('breathe-out');
                }, 6000);

                setTimeout(() => {
                    // Mark dot complete
                    dots[breathCount].classList.add('complete');
                    breathCount++;

                    if (breathCount < totalBreaths) {
                        text.textContent = 'Ready...';
                        setTimeout(doBreath, 1000);
                    } else {
                        doBreath(); // Will trigger completion
                    }
                }, 10000);
            }

            // Reset dots
            dots.forEach(d => d.classList.remove('complete'));

            text.textContent = 'Get comfortable...';
            setTimeout(doBreath, 2000);
        }

        // ============================================
        // KIND WORDS
        // ============================================
        function newKindWord() {
            const text = document.getElementById('kindwordText');
            const randomWord = kindWords[Math.floor(Math.random() * kindWords.length)];

            text.style.opacity = 0;
            setTimeout(() => {
                text.textContent = `"${randomWord}"`;
                text.style.opacity = 1;
            }, 200);

            showHorseSpeech("This one's for you üíï");
            triggerHorseAnimation('nuzzle');
        }

        // ============================================
        // STABLE HELPER (Maths disguised as horse care)
        // ============================================
        const stableHelperQuestions = [
            { q: "Your horse needs 3 carrots in the morning and 4 in the evening. How many carrots for the whole day?", a: 7, options: [6, 7, 8, 5] },
            { q: "The stable has 12 hay bales. You use 5 today. How many are left?", a: 7, options: [7, 6, 8, 5] },
            { q: "Each horse needs 2 buckets of water. You have 4 horses. How many buckets in total?", a: 8, options: [6, 8, 10, 4] },
            { q: "You brush your horse for 15 minutes in the morning and 10 minutes at night. How long in total?", a: 25, options: [20, 25, 30, 15] },
            { q: "A bag of horse treats has 20 treats. You give 3 treats each day. How many left after 5 days?", a: 5, options: [5, 10, 15, 3] },
            { q: "The paddock fence needs 8 posts on each side. It has 4 sides. How many posts in total?", a: 32, options: [24, 32, 28, 36] },
            { q: "Your horse walks 3 laps around the field. Each lap is 100 metres. How far did they walk?", a: 300, options: [200, 300, 400, 150] },
            { q: "You have 24 apples to share equally between 6 horses. How many does each horse get?", a: 4, options: [3, 4, 5, 6] },
            { q: "The riding lesson is 45 minutes. You've been riding for 20 minutes. How many minutes left?", a: 25, options: [20, 25, 30, 15] },
            { q: "A horse eats 10kg of hay per day. How much hay for 1 week (7 days)?", a: 70, options: [60, 70, 80, 50] },
            { q: "You saved ¬£5 each week for 8 weeks to buy horse supplies. How much did you save?", a: 40, options: [35, 40, 45, 50] },
            { q: "The stable opens at 7am and closes at 5pm. How many hours is it open?", a: 10, options: [8, 10, 12, 9] },
            { q: "You need 3 brushes for each horse. You have 5 horses. How many brushes do you need?", a: 15, options: [12, 15, 18, 10] },
            { q: "A horse's hoof needs trimming every 6 weeks. How many times per year?", a: 8, options: [6, 8, 10, 12] },
            { q: "You ride for half an hour. How many minutes is that?", a: 30, options: [20, 30, 40, 45] },
        ];

        let currentStableQuestion = null;

        function loadStableHelper() {
            const randomQ = stableHelperQuestions[Math.floor(Math.random() * stableHelperQuestions.length)];
            currentStableQuestion = randomQ;

            document.getElementById('stableQuestion').textContent = randomQ.q;
            document.getElementById('stableResult').textContent = '';

            // Shuffle options
            const shuffled = [...randomQ.options].sort(() => Math.random() - 0.5);

            document.getElementById('stableOptions').innerHTML = shuffled.map(opt => `
                <div class="game-option" onclick="checkStableAnswer(${opt})">${opt}</div>
            `).join('');
        }

        function checkStableAnswer(answer) {
            const options = document.querySelectorAll('#stableOptions .game-option');
            options.forEach(opt => {
                opt.style.pointerEvents = 'none';
                if (parseInt(opt.textContent) === currentStableQuestion.a) {
                    opt.classList.add('correct');
                } else if (parseInt(opt.textContent) === answer && answer !== currentStableQuestion.a) {
                    opt.classList.add('wrong');
                }
            });

            if (answer === currentStableQuestion.a) {
                document.getElementById('stableResult').innerHTML = 'üéâ Amazing! You helped your horse!';
                addHorseshoes(2);
                showHorseSpeech("You're such a great helper! ü•ï");
                triggerHorseAnimation('happy');
            } else {
                document.getElementById('stableResult').innerHTML = `Good try! The answer was ${currentStableQuestion.a}. You'll get the next one! üí™`;
                showHorseSpeech("Nice try! Let's do another one! üíï");
            }
        }

        function nextStableHelper() {
            loadStableHelper();
        }

        // ============================================
        // HORSE SECRETS (Fun facts - reading)
        // ============================================
        const horseSecrets = [
            "Horses can sleep standing up! They have special legs that lock in place so they don't fall over. üê¥üí§",
            "A horse's heart weighs about 4.5kg - that's as heavy as a big watermelon! üçâ‚ù§Ô∏è",
            "Horses can see almost 360 degrees around them. They have eyes on the sides of their head! üëÄ",
            "The oldest horse ever lived to be 62 years old. His name was Old Billy! üéÇ",
            "Horses can't breathe through their mouths - only through their noses! üëÉ",
            "A baby horse can stand up and walk within an hour of being born! üêé",
            "Horses have the largest eyes of any land mammal! üëÅÔ∏è",
            "A horse's teeth never stop growing throughout their life! ü¶∑",
            "Horses can run within hours of being born. They need to keep up with the herd! üèÉ",
            "There are about 400 different breeds of horses in the world! üåç",
            "Horses can drink up to 38 litres of water per day! üíß",
            "A horse's ear can rotate 180 degrees to listen in different directions! üëÇ",
            "Horses have excellent memories and can remember people and places for years! üß†",
            "The fastest recorded speed of a horse was 70.76 km/h - that's really fast! ‚ö°",
            "Horses are social animals and can feel lonely if kept alone! üíï",
            "A group of horses is called a 'herd' or sometimes a 'string'! üê¥üê¥üê¥",
            "Horses communicate through sounds, body language, and facial expressions! üí¨",
            "The hoof of a horse is like a giant fingernail! It grows about 6mm per month! üíÖ",
            "Horses have been domesticated for over 5,000 years! üìú",
            "Arabian horses have one fewer vertebra than other horse breeds! ü¶¥",
        ];

        function loadSecret() {
            const secret = horseSecrets[Math.floor(Math.random() * horseSecrets.length)];
            document.getElementById('secretText').textContent = secret;

            // Update secrets collected
            userData.secretsCollected = (userData.secretsCollected || 0) + 1;
            document.getElementById('secretsCollected').textContent = userData.secretsCollected;
            saveData();
        }

        function nextSecret() {
            loadSecret();
            addHorseshoes(1);
            showHorseSpeech("Ooh, another secret discovered! üåü");
            triggerHorseAnimation('happy');
        }

        // ============================================
        // ADVENTURE TALES (Creative writing)
        // ============================================
        const storyStarters = [
            "One sunny morning, HORSE_NAME discovered a sparkling golden key hidden in the hay. It seemed to glow with magic...",
            "HORSE_NAME heard a tiny voice calling from behind the old oak tree. When they looked closer, they saw...",
            "The storm had passed, and HORSE_NAME noticed something amazing in the field - footprints that glowed in the moonlight...",
            "HORSE_NAME woke up to find that overnight, beautiful flowers had grown all around the stable in every colour imaginable...",
            "A mysterious letter arrived at the stable, addressed to HORSE_NAME. It said: 'You are invited to...'",
            "While exploring the forest, HORSE_NAME found a hidden path that no one had ever seen before. It led to...",
            "HORSE_NAME made a new friend today - a little robin who could do something very unusual...",
            "The old well in the paddock started to glow blue at midnight. HORSE_NAME decided to investigate...",
            "A hot air balloon landed in the field, and out stepped the most interesting character HORSE_NAME had ever seen...",
            "HORSE_NAME discovered they could understand what the other animals were saying! The first thing they heard was...",
            "There was a door in the oldest tree in the forest. HORSE_NAME had never noticed it before, but today it was wide open...",
            "HORSE_NAME found a map tucked under their favourite apple tree. It showed the way to something called 'The Meadow of Dreams'...",
            "A friendly owl delivered a special package to HORSE_NAME in the middle of the night. Inside was...",
            "The stream started flowing backwards! HORSE_NAME followed it upstream to find out why...",
            "HORSE_NAME woke up to discover they had grown beautiful, shimmering wings overnight...",
        ];

        function loadStoryStarter() {
            const starter = storyStarters[Math.floor(Math.random() * storyStarters.length)];
            const personalised = starter.replace(/HORSE_NAME/g, userData.horseName || 'your horse');
            document.getElementById('storyStarter').textContent = personalised;
            document.getElementById('storyInput').value = '';
        }

        function newStoryStarter() {
            loadStoryStarter();
            showHorseSpeech("Ooh, a new adventure awaits! üìñ");
        }

        function saveStory() {
            const story = document.getElementById('storyInput').value.trim();
            if (!story) {
                showHorseSpeech("Write something in the box first! I want to hear your story! üìñ");
                return;
            }

            // Save to stories array
            userData.stories = userData.stories || [];
            userData.stories.unshift({
                starter: document.getElementById('storyStarter').textContent,
                continuation: story,
                timestamp: new Date().toISOString()
            });
            userData.stories = userData.stories.slice(0, 20); // Keep last 20
            saveData();

            addHorseshoes(3);
            showHorseSpeech("What an amazing story! You're so creative! ‚ú®");
            triggerHorseAnimation('happy');

            // Clear and get new starter
            setTimeout(() => {
                loadStoryStarter();
            }, 2000);
        }

        // ============================================
        // PUZZLE PADDOCK (Word unscramble - spelling)
        // ============================================
        const puzzleWords = [
            { word: "SADDLE", hint: "You sit on this when riding" },
            { word: "BRIDLE", hint: "Goes on the horse's head with reins" },
            { word: "STABLE", hint: "Where horses live" },
            { word: "GALLOP", hint: "The fastest way a horse runs" },
            { word: "MANE", hint: "The hair on a horse's neck" },
            { word: "HOOF", hint: "A horse's foot" },
            { word: "TROT", hint: "A bouncy way of moving, faster than walking" },
            { word: "CANTER", hint: "Faster than trot, slower than gallop" },
            { word: "FOAL", hint: "A baby horse" },
            { word: "MARE", hint: "A female horse" },
            { word: "PONY", hint: "A small type of horse" },
            { word: "REINS", hint: "You hold these to steer the horse" },
            { word: "PADDOCK", hint: "A fenced field for horses" },
            { word: "CARROT", hint: "Orange treat that horses love" },
            { word: "BRUSH", hint: "Used to groom the horse's coat" },
            { word: "STIRRUP", hint: "Where you put your feet when riding" },
            { word: "HAY", hint: "Dried grass that horses eat" },
            { word: "NEIGH", hint: "The sound a horse makes" },
            { word: "WILD", hint: "Horses that live free in nature" },
            { word: "TAIL", hint: "At the back end of a horse" },
        ];

        let currentPuzzle = null;
        let puzzleAnswer = [];

        function loadPuzzle() {
            currentPuzzle = puzzleWords[Math.floor(Math.random() * puzzleWords.length)];
            puzzleAnswer = [];

            // Scramble the word
            const letters = currentPuzzle.word.split('');
            const scrambled = [...letters].sort(() => Math.random() - 0.5);

            document.getElementById('scrambledWord').textContent = scrambled.join(' ');
            document.getElementById('puzzleHint').textContent = `Hint: ${currentPuzzle.hint}`;
            document.getElementById('puzzleResult').textContent = '';

            // Create letter tiles
            document.getElementById('letterTiles').innerHTML = scrambled.map((letter, i) => `
                <div class="letter-tile" data-index="${i}" onclick="selectLetter(this, '${letter}')">${letter}</div>
            `).join('');

            // Create answer slots
            document.getElementById('answerTiles').innerHTML = currentPuzzle.word.split('').map(() => `
                <div class="answer-slot"></div>
            `).join('');
        }

        function selectLetter(tile, letter) {
            if (tile.classList.contains('used')) return;

            const slots = document.querySelectorAll('.answer-slot');
            const nextEmpty = Array.from(slots).find(slot => !slot.classList.contains('filled'));

            if (nextEmpty) {
                tile.classList.add('used');
                nextEmpty.classList.add('filled');
                nextEmpty.textContent = letter;
                nextEmpty.dataset.tileIndex = tile.dataset.index;
                nextEmpty.onclick = () => removeLetter(nextEmpty, tile);
                puzzleAnswer.push(letter);
            }
        }

        function removeLetter(slot, tile) {
            if (!slot.classList.contains('filled')) return;

            const tileIndex = slot.dataset.tileIndex;
            const originalTile = document.querySelector(`.letter-tile[data-index="${tileIndex}"]`);

            if (originalTile) {
                originalTile.classList.remove('used');
            }

            slot.classList.remove('filled');
            slot.textContent = '';
            slot.onclick = null;

            // Remove from answer
            const letter = slot.textContent;
            const idx = puzzleAnswer.lastIndexOf(letter);
            if (idx > -1) puzzleAnswer.splice(idx, 1);
        }

        function checkPuzzle() {
            const slots = document.querySelectorAll('.answer-slot');
            const answer = Array.from(slots).map(s => s.textContent).join('');

            if (answer.length < currentPuzzle.word.length) {
                showHorseSpeech("Tap all the letters first! üß©");
                return;
            }

            if (answer === currentPuzzle.word) {
                document.getElementById('puzzleResult').innerHTML = 'üéâ Brilliant! You got it!';
                addHorseshoes(2);
                showHorseSpeech("You're so clever! üß©‚ú®");
                triggerHorseAnimation('happy');
            } else {
                document.getElementById('puzzleResult').innerHTML = `The word was ${currentPuzzle.word}. Great try! üí™`;
                showHorseSpeech("Good effort! Try another one! üíï");
            }
        }

        function nextPuzzle() {
            loadPuzzle();
        }

        // ============================================
        // DAILY QUEST
        // ============================================
        const dailyQuests = [
            { type: "ü•ï Stable Helper", text: "Complete 3 stable helper puzzles today!", action: "stablehelper" },
            { type: "üåü Explorer", text: "Discover 5 horse secrets!", action: "secrets" },
            { type: "üìñ Storyteller", text: "Write a short adventure story!", action: "adventure" },
            { type: "üß© Word Wizard", text: "Solve 3 word puzzles!", action: "puzzle" },
            { type: "üíú Kindness", text: "Read 3 kind messages from your horse!", action: "kindwords" },
            { type: "üå¨Ô∏è Calm", text: "Do the breathing exercise!", action: "breathing" },
            { type: "üß≤ Collector", text: "Add 3 things to your Golden Horseshoes!", action: "horseshoe" },
            { type: "üòä Check-in", text: "Tell your horse how you're feeling today!", action: "mood" },
            { type: "üè† Brave", text: "Give a worry to the Worry Stable!", action: "worry" },
            { type: "üê¥ Best Friend", text: "Tap your horse 5 times for comfort!", action: null },
        ];

        function loadDailyQuest() {
            const today = new Date().toDateString();

            // Check if quest already completed today
            if (userData.lastQuestDate === today && userData.questCompleted) {
                document.getElementById('questText').textContent = userData.currentQuest?.text || "Quest completed!";
                document.getElementById('questType').textContent = userData.currentQuest?.type || "‚≠ê Daily Quest";
                document.getElementById('questStatus').textContent = "‚úÖ Quest completed today! Come back tomorrow!";
                document.getElementById('questStatus').classList.add('completed');
                document.getElementById('questBtn').style.display = 'none';
                return;
            }

            // New day = new quest
            if (userData.lastQuestDate !== today) {
                userData.questCompleted = false;
                // Use date as seed for consistent daily quest
                const dayIndex = new Date().getDate() % dailyQuests.length;
                userData.currentQuest = dailyQuests[dayIndex];
                userData.lastQuestDate = today;
                saveData();
            }

            const quest = userData.currentQuest;
            document.getElementById('questText').textContent = quest.text;
            document.getElementById('questType').textContent = quest.type;
            document.getElementById('questStatus').textContent = '';
            document.getElementById('questStatus').classList.remove('completed');
            document.getElementById('questBtn').style.display = 'block';
        }

        function completeQuest() {
            userData.questCompleted = true;
            saveData();

            addHorseshoes(5);
            showHorseSpeech("Amazing! You completed today's quest! ‚≠êüéâ");
            triggerHorseAnimation('happy');

            document.getElementById('questStatus').textContent = "‚úÖ Quest completed! You're a star!";
            document.getElementById('questStatus').classList.add('completed');
            document.getElementById('questBtn').style.display = 'none';
        }

        // ============================================
        // INITIALIZE GAMES
        // ============================================
        function initGames() {
            loadStableHelper();
            loadSecret();
            loadStoryStarter();
            loadPuzzle();
            loadDailyQuest();

            // Update secrets collected display
            document.getElementById('secretsCollected').textContent = userData.secretsCollected || 0;
        }

        // ============================================
        // UTILITIES
        // ============================================
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // ============================================
        // START
        // ============================================
        init();
    </script>
</body>
</html>
