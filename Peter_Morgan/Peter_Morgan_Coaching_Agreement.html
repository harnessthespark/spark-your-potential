<!DOCTYPE html>
<html lang="en-GB">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coaching Agreement - Peter Morgan - Harness the Spark</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Inter', sans-serif;
            background: #f8f9fa;
            color: #333;
            line-height: 1.6;
        }
        .document-container {
            max-width: 800px;
            margin: 40px auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #8B5CF6 0%, #EC4899 100%);
            padding: 40px;
            text-align: center;
            color: white;
        }
        .logo {
            font-size: 1.5em;
            font-weight: 700;
            margin-bottom: 20px;
        }
        .logo span { color: #FFE66D; }
        .header h1 {
            font-size: 2em;
            font-weight: 700;
            margin-bottom: 10px;
        }
        .header .subtitle {
            font-size: 1.1em;
            opacity: 0.9;
        }
        .content {
            padding: 40px;
        }
        .client-info {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 25px;
            margin-bottom: 30px;
        }
        .client-info-row {
            display: flex;
            margin-bottom: 12px;
        }
        .client-info-row:last-child { margin-bottom: 0; }
        .client-info-label {
            font-weight: 600;
            color: #666;
            width: 120px;
            flex-shrink: 0;
        }
        .client-info-value {
            color: #333;
            font-weight: 500;
        }
        h2 {
            color: #8B5CF6;
            font-size: 1.3em;
            margin: 30px 0 15px 0;
            padding-bottom: 8px;
            border-bottom: 2px solid #8B5CF6;
        }
        h2:first-of-type { margin-top: 0; }
        p { margin-bottom: 15px; }
        .highlight {
            background: #E9D5FF;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 600;
        }
        .important {
            font-weight: 600;
            color: #333;
        }
        ul {
            margin: 15px 0 15px 25px;
        }
        li {
            margin-bottom: 10px;
        }
        .programme-box {
            background: linear-gradient(135deg, #8B5CF6 0%, #EC4899 100%);
            color: white;
            padding: 25px;
            border-radius: 10px;
            margin: 20px 0;
        }
        .programme-box h3 {
            font-size: 1.2em;
            margin-bottom: 15px;
        }
        .programme-box ul {
            margin-left: 20px;
        }
        .programme-box li {
            margin-bottom: 8px;
        }
        .beta-box {
            background: linear-gradient(135deg, #10B981 0%, #059669 100%);
            color: white;
            padding: 25px;
            border-radius: 10px;
            margin: 20px 0;
            border: 3px solid #047857;
        }
        .beta-box h3 {
            font-size: 1.2em;
            margin-bottom: 15px;
        }
        .beta-box ul {
            margin-left: 20px;
        }
        .beta-box li {
            margin-bottom: 8px;
        }
        .signature-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 30px;
            margin-top: 40px;
        }
        .signature-section h2 {
            color: #8B5CF6;
            border-color: #8B5CF6;
            margin-top: 0;
        }
        .signature-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            margin-top: 25px;
        }
        .signature-box {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 25px;
        }
        .signature-box h4 {
            color: #666;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 20px;
        }
        .signature-field {
            margin-bottom: 20px;
        }
        .signature-field label {
            display: block;
            font-size: 0.85em;
            color: #888;
            margin-bottom: 8px;
        }
        .signature-field input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            font-family: inherit;
        }
        .signature-field input:focus {
            outline: none;
            border-color: #8B5CF6;
        }
        .signature-field input[type="text"].signature-input {
            font-family: 'Brush Script MT', cursive;
            font-size: 1.5em;
            text-align: center;
        }
        .signature-canvas {
            width: 100%;
            height: 100px;
            border: 2px dashed #ccc;
            border-radius: 8px;
            background: #fafafa;
            cursor: crosshair;
        }
        .signature-pad-container {
            position: relative;
        }
        .clear-signature {
            position: absolute;
            top: 5px;
            right: 5px;
            background: #8B5CF6;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.75em;
            cursor: pointer;
        }
        .coach-signature {
            font-family: 'Brush Script MT', cursive;
            font-size: 2em;
            color: #333;
            padding: 10px 0;
        }
        .submit-section {
            text-align: center;
            margin-top: 30px;
            padding-top: 30px;
            border-top: 2px solid #e0e0e0;
        }
        .submit-btn {
            background: linear-gradient(135deg, #8B5CF6 0%, #EC4899 100%);
            color: white;
            border: none;
            padding: 15px 50px;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(139, 92, 246, 0.4);
        }
        .submit-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        .checkbox-field {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            margin: 20px 0;
            padding: 15px;
            background: #fff;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
        }
        .checkbox-field input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-top: 2px;
            cursor: pointer;
        }
        .checkbox-field label {
            font-size: 0.95em;
            cursor: pointer;
        }
        .footer {
            background: #333;
            color: white;
            padding: 30px 40px;
            text-align: center;
        }
        .footer p {
            margin-bottom: 5px;
            opacity: 0.9;
        }
        .footer a {
            color: #8B5CF6;
            text-decoration: none;
        }
        @media (max-width: 600px) {
            .signature-grid {
                grid-template-columns: 1fr;
            }
            .content { padding: 25px; }
        }
    </style>
</head>
<body>
    <div class="document-container">
        <div class="header">
            <div class="logo">Harness the <span>Spark</span> ‚ú®</div>
            <h1>Coaching Agreement</h1>
            <p class="subtitle">Blended Programme - Career + Mind Management</p>
        </div>

        <div class="content">
            <div class="client-info">
                <div class="client-info-row">
                    <span class="client-info-label">Client:</span>
                    <span class="client-info-value" id="clientName">Peter Morgan</span>
                </div>
                <div class="client-info-row">
                    <span class="client-info-label">Coach:</span>
                    <span class="client-info-value">Lisa Gills</span>
                </div>
                <div class="client-info-row">
                    <span class="client-info-label">Date:</span>
                    <span class="client-info-value" id="agreementDate"></span>
                </div>
                <div class="client-info-row">
                    <span class="client-info-label">Programme:</span>
                    <span class="client-info-value">Blended Programme (Career Discovery + Mind Management)</span>
                </div>
            </div>

            <p>This agreement sets out how we'll work together during your coaching programme. It's designed to protect both of us and make expectations clear.</p>

            <h2>1. What Coaching Is (And Isn't)</h2>
            <p>Coaching is a collaborative process. It's designed to help you develop insight, build strategies, and make meaningful change. I'll ask questions, share tools, and offer structure ‚Äî but ultimately, you're responsible for what you take from it and how you use it.</p>
            <p><span class="important">This is not therapy or medical advice.</span> I don't diagnose or treat mental health conditions. If you feel you need therapeutic or clinical support, I'll help signpost you to it ‚Äî but it's outside the scope of this coaching.</p>

            <h2>2. Programme & Services</h2>
            <p>This agreement covers the following programme:</p>

            <div class="programme-box">
                <h3>‚ú® Blended Programme - Career Discovery + Mind Management</h3>
                <ul>
                    <li><strong>Career Discovery:</strong> Clarity on direction, positioning, and practical career tools</li>
                    <li><strong>Mind Management:</strong> Energy tracking, brain dump tools, getting-started strategies</li>
                    <li>Sessions tailored to your specific needs and challenges</li>
                    <li>Access to full Career Toolkit (CV Builder, Blueprint, Decision Framework)</li>
                    <li>Access to Mind Management Toolkit (Brain Dump, Energy Tracker, Spark Collector, Foundations)</li>
                    <li>Email support between sessions (response within 48 hours on working days)</li>
                </ul>
            </div>

            <div class="beta-box">
                <h3>üéÅ Beta Tester Terms - Gratis Programme</h3>
                <p style="margin-bottom: 15px;">As a valued beta tester, you are receiving this programme <strong>free of charge (gratis)</strong> in exchange for your feedback and input.</p>
                <ul>
                    <li><strong>No fee payable</strong> - This programme is provided at no cost to you</li>
                    <li><strong>Feedback required</strong> - You agree to provide honest feedback on the tools, sessions, and overall experience</li>
                    <li><strong>Confidentiality</strong> - As a beta tester, please keep programme materials and methodology confidential</li>
                    <li><strong>Testimonial option</strong> - You may be invited to provide a testimonial (entirely optional)</li>
                </ul>
                <p style="margin-top: 15px; font-style: italic;">Your feedback will help shape the Blended Programme for future clients. Thank you for being part of this journey!</p>
            </div>

            <p>Sessions will take place online (Zoom) at mutually agreed times.</p>

            <p><strong>Cancellation & Rescheduling:</strong></p>
            <ul>
                <li>If you're more than 15 minutes late or miss a session without 24 hours' notice, the session may be forfeited unless it's an emergency</li>
                <li>I'll always do my best to be flexible where possible</li>
                <li>If I need to reschedule, I'll give as much notice as I can (ideally 24 hours)</li>
            </ul>

            <h2>3. Payment Terms</h2>
            <p><span class="highlight">This programme is provided GRATIS (free of charge)</span> in exchange for your participation as a beta tester and your feedback on the programme.</p>
            <p>No payment is required at any stage of this programme.</p>

            <h2>4. Confidentiality</h2>
            <p>Everything shared in sessions is confidential. I operate within the spirit of the ICF Code of Ethics.</p>
            <p><strong>The only exceptions are:</strong></p>
            <ul>
                <li>If I'm concerned about your safety or someone else's</li>
                <li>If you give permission for me to discuss something (e.g. with an employer)</li>
            </ul>
            <p>Sessions may be recorded for internal training or accreditation purposes ‚Äî but only with your consent. You can withdraw that consent at any time.</p>

            <h2>5. Intellectual Property & Tool Usage</h2>
            <p>The questionnaire tools, methodology, frameworks, and any materials I provide remain my intellectual property. You're welcome to use insights and outputs from the coaching for your own development, but please don't copy, reproduce, or share the tool structure or methodology itself.</p>
            <p>The content you create (your career narrative, insights, etc.) is yours to use as you wish.</p>

            <h2>6. Liability & Boundaries</h2>
            <p>You're responsible for your own actions, choices, and results from coaching. I'm not liable for any outcomes, decisions, or impacts of the coaching process.</p>
            <p><strong>Professional Boundaries:</strong></p>
            <ul>
                <li>Our relationship is professional coaching, not friendship or therapy</li>
                <li>Contact outside sessions should be related to the coaching work</li>
                <li>I reserve the right to terminate the coaching relationship if boundaries are not respected</li>
            </ul>

            <h2>7. The Legal Bit</h2>
            <p>This agreement is governed by the laws of England and Wales. If a disagreement arises, we agree to try to resolve it through conversation and mediation first.</p>

            <div class="signature-section">
                <h2>Agreement</h2>
                <p>By signing below, you confirm that you've read and agreed to these terms.</p>

                <div class="checkbox-field">
                    <input type="checkbox" id="agreeTerms" required>
                    <label for="agreeTerms">I have read and agree to the terms of this Coaching Agreement</label>
                </div>

                <div class="checkbox-field">
                    <input type="checkbox" id="agreeFeedback" required>
                    <label for="agreeFeedback">I agree to provide feedback on the programme in exchange for receiving it free of charge</label>
                </div>

                <div class="checkbox-field">
                    <input type="checkbox" id="agreeRecording">
                    <label for="agreeRecording">I consent to sessions being recorded for training/accreditation purposes (optional)</label>
                </div>

                <div class="signature-grid">
                    <div class="signature-box">
                        <h4>Client</h4>
                        <div class="signature-field">
                            <label>Signature (type your name or draw below)</label>
                            <input type="text" class="signature-input" id="clientSignature" placeholder="Type your signature">
                        </div>
                        <div class="signature-field signature-pad-container">
                            <label>Or draw your signature:</label>
                            <canvas id="signatureCanvas" class="signature-canvas"></canvas>
                            <button type="button" class="clear-signature" onclick="clearSignature()">Clear</button>
                        </div>
                        <div class="signature-field">
                            <label>Full Name</label>
                            <input type="text" id="clientFullName" placeholder="Peter Morgan" value="Peter Morgan">
                        </div>
                        <div class="signature-field">
                            <label>Date</label>
                            <input type="date" id="clientSignDate">
                        </div>
                    </div>

                    <div class="signature-box">
                        <h4>Coach</h4>
                        <div class="signature-field">
                            <label>Signature</label>
                            <div class="coach-signature">Lisa Gills</div>
                        </div>
                        <div class="signature-field">
                            <label>Full Name</label>
                            <p style="padding: 12px 0; font-weight: 500;">Lisa Gills</p>
                        </div>
                        <div class="signature-field">
                            <label>Date</label>
                            <p style="padding: 12px 0;" id="coachSignDate"></p>
                        </div>
                    </div>
                </div>

                <div class="submit-section">
                    <button type="button" class="submit-btn" id="submitBtn" onclick="submitAgreement()" disabled>
                        Sign & Submit Agreement
                    </button>
                    <p style="margin-top: 15px; font-size: 0.9em; color: #666;">
                        By clicking "Sign & Submit", you agree to the terms above.
                    </p>
                </div>
            </div>
        </div>

        <div class="footer">
            <p><strong>Harness the Spark</strong></p>
            <p>Lisa Gills</p>
            <p>Email: <a href="mailto:lisa@harnessthespark.com">lisa@harnessthespark.com</a></p>
            <p>Website: <a href="https://www.harnessthespark.com">www.harnessthespark.com</a></p>
        </div>
    </div>

    <script>
        // CLIENT CONFIG
        const CLIENT_NAME = 'Peter Morgan';
        const CLIENT_EMAIL = 'pete_morgan69@hotmail.com';
        const SYP_API = 'https://stingray-app-7kg9p.ondigitalocean.app';

        // Check if agreement is already signed
        async function checkIfSigned() {
            // First check localStorage
            const localData = localStorage.getItem('agreement_Peter_Morgan');
            if (localData) {
                try {
                    const parsed = JSON.parse(localData);
                    if (parsed.signature) {
                        displaySignedAgreement(parsed);
                        return;
                    }
                } catch (e) {}
            }

            // Then check PostgreSQL API
            try {
                const response = await fetch(`${SYP_API}/api/agreement/${encodeURIComponent(CLIENT_EMAIL)}`);
                if (response.ok) {
                    const data = await response.json();
                    if (data.success && data.agreement && data.agreement.signature) {
                        displaySignedAgreement(data.agreement);
                        return;
                    }
                }
            } catch (e) {
                console.log('API check failed, showing form');
            }

            // Not signed - show form
            initSigningForm();
        }

        // Display signed agreement (read-only)
        function displaySignedAgreement(data) {
            document.getElementById('agreementDate').textContent = data.signed_date ? new Date(data.signed_date).toLocaleDateString('en-GB') : new Date().toLocaleDateString('en-GB');
            document.getElementById('coachSignDate').textContent = data.signed_date ? new Date(data.signed_date).toLocaleDateString('en-GB') : new Date().toLocaleDateString('en-GB');

            // Replace the signature section with signed version
            const signatureSection = document.querySelector('.signature-section');

            // Determine signature display
            let signatureDisplay = '';
            if (data.signature_type === 'drawn' && data.signature && data.signature.startsWith('data:image')) {
                signatureDisplay = `<img src="${data.signature}" alt="Client Signature" style="max-width: 100%; max-height: 120px; border: 1px solid #e0e0e0; border-radius: 8px; background: #fafafa;">`;
            } else if (data.signature) {
                signatureDisplay = `<div style="font-family: 'Brush Script MT', cursive; font-size: 2em; color: #333; padding: 15px 0;">${data.signature}</div>`;
            }

            signatureSection.innerHTML = `
                <h2>Agreement - Signed ‚úì</h2>
                <div style="background: #d4edda; border: 2px solid #28a745; border-radius: 10px; padding: 20px; margin-bottom: 25px; text-align: center;">
                    <span style="font-size: 2em;">‚úÖ</span>
                    <p style="color: #155724; font-weight: 600; margin: 10px 0 5px 0;">Agreement Successfully Signed</p>
                    <p style="color: #155724; font-size: 0.9em;">Signed on ${data.signed_date ? new Date(data.signed_date).toLocaleDateString('en-GB') : 'N/A'}</p>
                </div>

                <div style="display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 20px;">
                    <span style="background: ${data.agreed_to_terms ? '#d4edda' : '#f8d7da'}; color: ${data.agreed_to_terms ? '#155724' : '#721c24'}; padding: 6px 12px; border-radius: 6px; font-size: 0.85em;">
                        ${data.agreed_to_terms ? '‚úì' : '‚úó'} Agreed to Terms
                    </span>
                    <span style="background: ${data.agreed_to_feedback ? '#d4edda' : '#f8d7da'}; color: ${data.agreed_to_feedback ? '#155724' : '#721c24'}; padding: 6px 12px; border-radius: 6px; font-size: 0.85em;">
                        ${data.agreed_to_feedback ? '‚úì' : '‚úó'} Agreed to Provide Feedback
                    </span>
                    <span style="background: ${data.consent_to_recording ? '#d4edda' : '#fff3cd'}; color: ${data.consent_to_recording ? '#155724' : '#856404'}; padding: 6px 12px; border-radius: 6px; font-size: 0.85em;">
                        ${data.consent_to_recording ? '‚úì Recording Consent Given' : '‚óã Recording Consent Not Given'}
                    </span>
                </div>

                <div class="signature-grid">
                    <div class="signature-box">
                        <h4>Client</h4>
                        <div class="signature-field">
                            <label>Signature</label>
                            ${signatureDisplay}
                        </div>
                        <div class="signature-field">
                            <label>Full Name</label>
                            <p style="padding: 12px 0; font-weight: 500;">${data.client_name || CLIENT_NAME}</p>
                        </div>
                        <div class="signature-field">
                            <label>Date Signed</label>
                            <p style="padding: 12px 0;">${data.signed_date ? new Date(data.signed_date).toLocaleDateString('en-GB') : 'N/A'}</p>
                        </div>
                    </div>

                    <div class="signature-box">
                        <h4>Coach</h4>
                        <div class="signature-field">
                            <label>Signature</label>
                            <div class="coach-signature">Lisa Gills</div>
                        </div>
                        <div class="signature-field">
                            <label>Full Name</label>
                            <p style="padding: 12px 0; font-weight: 500;">Lisa Gills</p>
                        </div>
                        <div class="signature-field">
                            <label>Date</label>
                            <p style="padding: 12px 0;">${data.signed_date ? new Date(data.signed_date).toLocaleDateString('en-GB') : 'N/A'}</p>
                        </div>
                    </div>
                </div>

                <div style="text-align: center; margin-top: 25px; padding-top: 25px; border-top: 2px solid #e0e0e0;">
                    <a href="../client-portal.html" style="display: inline-block; background: linear-gradient(135deg, #8B5CF6 0%, #EC4899 100%); color: white; padding: 12px 30px; border-radius: 8px; text-decoration: none; font-weight: 600;">
                        Go to Your Toolkit ‚Üí
                    </a>
                </div>
            `;
        }

        // Initialize signing form
        function initSigningForm() {
            // Set dates
            document.getElementById('agreementDate').textContent = new Date().toLocaleDateString('en-GB');
            document.getElementById('coachSignDate').textContent = new Date().toLocaleDateString('en-GB');
            document.getElementById('clientSignDate').value = new Date().toISOString().split('T')[0];

            // Setup canvas and form validation
            setupSignatureCanvas();
            setupFormValidation();
        }

        // Check on page load
        checkIfSigned();

        // Signature canvas setup
        let canvas, ctx, isDrawing = false, hasDrawnSignature = false;

        function setupSignatureCanvas() {
            canvas = document.getElementById('signatureCanvas');
            if (!canvas) return;
            ctx = canvas.getContext('2d');

            function resizeCanvas() {
                const rect = canvas.getBoundingClientRect();
                canvas.width = rect.width;
                canvas.height = rect.height;
                ctx.strokeStyle = '#333';
                ctx.lineWidth = 2;
                ctx.lineCap = 'round';
            }
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);

            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);

            canvas.addEventListener('touchstart', (e) => { e.preventDefault(); startDrawing(e.touches[0]); });
            canvas.addEventListener('touchmove', (e) => { e.preventDefault(); draw(e.touches[0]); });
            canvas.addEventListener('touchend', stopDrawing);
        }

        function startDrawing(e) {
            isDrawing = true;
            draw(e);
        }

        function draw(e) {
            if (!isDrawing) return;
            const rect = canvas.getBoundingClientRect();
            const x = (e.clientX || e.pageX) - rect.left;
            const y = (e.clientY || e.pageY) - rect.top;
            ctx.lineTo(x, y);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(x, y);
            hasDrawnSignature = true;
            checkFormValidity();
        }

        function stopDrawing() {
            isDrawing = false;
            ctx.beginPath();
        }

        function clearSignature() {
            if (!ctx || !canvas) return;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            hasDrawnSignature = false;
            checkFormValidity();
        }

        function setupFormValidation() {
            const agreeTerms = document.getElementById('agreeTerms');
            const agreeFeedback = document.getElementById('agreeFeedback');
            const clientSignatureInput = document.getElementById('clientSignature');
            const clientFullName = document.getElementById('clientFullName');

            if (agreeTerms) agreeTerms.addEventListener('change', checkFormValidity);
            if (agreeFeedback) agreeFeedback.addEventListener('change', checkFormValidity);
            if (clientSignatureInput) clientSignatureInput.addEventListener('input', checkFormValidity);
            if (clientFullName) clientFullName.addEventListener('input', checkFormValidity);
        }

        function checkFormValidity() {
            const agreeTerms = document.getElementById('agreeTerms');
            const agreeFeedback = document.getElementById('agreeFeedback');
            const clientSignatureInput = document.getElementById('clientSignature');
            const clientFullName = document.getElementById('clientFullName');
            const submitBtn = document.getElementById('submitBtn');

            if (!agreeTerms || !agreeFeedback || !clientSignatureInput || !clientFullName || !submitBtn) return;

            const hasSignature = clientSignatureInput.value.trim() || hasDrawnSignature;
            const hasName = clientFullName.value.trim();
            const hasAgreedTerms = agreeTerms.checked;
            const hasAgreedFeedback = agreeFeedback.checked;
            submitBtn.disabled = !(hasSignature && hasName && hasAgreedTerms && hasAgreedFeedback);
        }

        async function submitAgreement() {
            const clientSignatureInput = document.getElementById('clientSignature');
            const agreeTerms = document.getElementById('agreeTerms');
            const agreeFeedback = document.getElementById('agreeFeedback');
            const submitBtn = document.getElementById('submitBtn');

            const signatureData = hasDrawnSignature ? canvas.toDataURL() : clientSignatureInput.value;

            const agreementData = {
                client_name: CLIENT_NAME,
                client_email: CLIENT_EMAIL,
                programme_type: 'blended',
                signature: signatureData,
                signature_type: hasDrawnSignature ? 'drawn' : 'typed',
                signed_date: document.getElementById('clientSignDate').value,
                agreed_to_terms: agreeTerms.checked,
                agreed_to_feedback: agreeFeedback.checked,
                consent_to_recording: document.getElementById('agreeRecording').checked,
                is_beta_tester: true,
                fee_status: 'gratis'
            };

            // Disable button while submitting
            submitBtn.disabled = true;
            submitBtn.textContent = 'Submitting...';

            try {
                // Submit to PostgreSQL API
                const response = await fetch(`${SYP_API}/api/agreement`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(agreementData)
                });

                const result = await response.json();

                if (response.ok && result.success) {
                    // Save to localStorage for display
                    localStorage.setItem('agreement_Peter_Morgan', JSON.stringify({
                        ...agreementData,
                        timestamp: new Date().toISOString(),
                        saved_to_database: true
                    }));

                    submitBtn.textContent = '‚úì Agreement Signed';
                    submitBtn.style.background = '#28a745';

                    alert(`Agreement signed successfully! Thank you, Peter.\n\nLisa has been notified and will be in touch shortly to schedule your first session.`);

                    // Reload to show signed agreement
                    setTimeout(() => {
                        window.location.reload();
                    }, 1500);
                } else {
                    throw new Error(result.error || 'Failed to submit agreement');
                }
            } catch (error) {
                console.error('Error submitting agreement:', error);

                // Fallback: save to localStorage
                localStorage.setItem('agreement_Peter_Morgan', JSON.stringify({
                    ...agreementData,
                    timestamp: new Date().toISOString(),
                    saved_to_database: false,
                    error: error.message
                }));

                submitBtn.textContent = '‚úì Agreement Signed';
                submitBtn.style.background = '#28a745';

                alert(`Agreement signed successfully! Thank you, Peter.\n\nLisa will be in touch shortly to schedule your first session.`);

                // Reload to show signed agreement
                setTimeout(() => {
                    window.location.reload();
                }, 1500);
            }
        }
    </script>
</body>
</html>
