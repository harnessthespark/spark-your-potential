<!DOCTYPE html>
<html lang="en-GB">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[CLIENT_NAME] - CV Builder</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); min-height: 100vh; padding: 20px; color: #333; }
        .container { max-width: 1400px; margin: 0 auto; }
        .header { text-align: center; color: white; margin-bottom: 30px; }
        .header h1 { font-size: 2em; margin-bottom: 5px; }
        .header p { opacity: 0.8; }
        .builder-layout { display: grid; grid-template-columns: 300px 1fr; gap: 20px; }
        @media (max-width: 900px) { .builder-layout { grid-template-columns: 1fr; } }

        /* Sidebar */
        .sidebar { background: white; border-radius: 15px; padding: 20px; height: fit-content; }
        .sidebar h2 { font-size: 1.1em; color: #667eea; margin-bottom: 15px; display: flex; align-items: center; gap: 8px; }
        .option-group { margin-bottom: 20px; }
        .option-group label { display: flex; align-items: center; gap: 10px; padding: 10px; border-radius: 8px; cursor: pointer; transition: background 0.2s; }
        .option-group label:hover { background: #f0f0f0; }
        .option-group input[type="radio"], .option-group input[type="checkbox"] { accent-color: #667eea; }
        .option-group span { font-size: 0.9em; }
        .section-toggle { display: flex; justify-content: space-between; align-items: center; padding: 10px; border-radius: 8px; background: #f8f9fa; margin-bottom: 8px; }
        .section-toggle span { font-size: 0.85em; }
        .toggle-switch { position: relative; width: 40px; height: 20px; }
        .toggle-switch input { opacity: 0; width: 0; height: 0; }
        .toggle-slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background: #ccc; border-radius: 20px; transition: 0.3s; }
        .toggle-slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 2px; bottom: 2px; background: white; border-radius: 50%; transition: 0.3s; }
        .toggle-switch input:checked + .toggle-slider { background: #667eea; }
        .toggle-switch input:checked + .toggle-slider:before { transform: translateX(20px); }

        /* CV Preview */
        .cv-preview { background: white; border-radius: 15px; padding: 40px; min-height: 800px; box-shadow: 0 10px 40px rgba(0,0,0,0.2); }
        .cv-header { border-bottom: 3px solid #667eea; padding-bottom: 20px; margin-bottom: 30px; }
        .cv-name { font-size: 2.2em; font-weight: 700; color: #2c3e50; margin-bottom: 5px; }
        .cv-headline { font-size: 1.1em; color: #667eea; font-weight: 500; margin-bottom: 15px; }
        .cv-contact { display: flex; gap: 20px; flex-wrap: wrap; font-size: 0.9em; color: #666; }
        .cv-contact a { color: #667eea; text-decoration: none; }

        .cv-section { margin-bottom: 30px; }
        .cv-section-title { font-size: 1.2em; font-weight: 700; color: #667eea; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 15px; padding-bottom: 5px; border-bottom: 2px solid #e0e0e0; }
        .cv-proposition { background: linear-gradient(135deg, #667eea10 0%, #764ba210 100%); padding: 20px; border-radius: 10px; border-left: 4px solid #667eea; font-size: 1em; line-height: 1.7; margin-bottom: 20px; }

        .cv-experience { margin-bottom: 25px; }
        .cv-experience-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 8px; }
        .cv-role { font-weight: 600; font-size: 1.05em; color: #2c3e50; }
        .cv-company { color: #667eea; font-weight: 500; }
        .cv-dates { color: #999; font-size: 0.9em; }
        .cv-bullets { margin-top: 10px; padding-left: 20px; }
        .cv-bullets li { margin-bottom: 8px; line-height: 1.6; color: #555; }

        .cv-skills { display: flex; flex-wrap: wrap; gap: 10px; }
        .cv-skill { background: #f0f0f0; padding: 5px 15px; border-radius: 20px; font-size: 0.85em; color: #555; }

        .editable { cursor: text; padding: 5px; border-radius: 4px; transition: background 0.2s; }
        .editable:hover { background: #f8f9fa; }
        .editable:focus { outline: 2px solid #667eea; background: white; }

        /* Case Study Card with Hero Banner */
        .case-study { background: white; border-radius: 12px; overflow: hidden; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.08); }
        .case-study-hero { height: 120px; display: flex; align-items: flex-end; padding: 15px; background-size: cover; background-position: center; position: relative; }
        .case-study-hero::before { content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(to top, rgba(0,0,0,0.6) 0%, rgba(0,0,0,0.1) 100%); }
        .case-study-logo { color: white; font-size: 1.3em; font-weight: 700; text-shadow: 0 1px 3px rgba(0,0,0,0.5); position: relative; z-index: 1; }
        .case-study-content { padding: 20px; }
        .case-study-title { font-weight: 600; color: #667eea; margin-bottom: 10px; }
        .case-study-text { color: #555; line-height: 1.6; }
        .case-study-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px; }
        .case-study-actions { display: flex; gap: 5px; }

        /* Case Study Management Buttons */
        .add-casestudy-btn { width: 100%; padding: 12px; margin-top: 10px; background: rgba(102,126,234,0.1); border: 2px dashed #667eea; color: #667eea; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.2s; }
        .add-casestudy-btn:hover { background: rgba(102,126,234,0.2); }
        .delete-btn { background: rgba(255,100,100,0.2); border: none; color: #ff6b6b; padding: 4px 10px; border-radius: 4px; cursor: pointer; font-size: 0.8em; transition: all 0.2s; }
        .delete-btn:hover { background: rgba(255,100,100,0.4); }
        .change-image-btn { background: rgba(102,126,234,0.2); border: none; color: #667eea; padding: 4px 10px; border-radius: 4px; cursor: pointer; font-size: 0.8em; transition: all 0.2s; }
        .change-image-btn:hover { background: rgba(102,126,234,0.4); }

        /* Modal Styles */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); z-index: 1000; }
        .modal-overlay.visible { display: flex; align-items: center; justify-content: center; }
        .modal { background: white; padding: 30px; border-radius: 15px; max-width: 500px; width: 90%; max-height: 80vh; overflow-y: auto; }
        .modal h2 { margin-bottom: 20px; color: #667eea; }
        .modal-field { margin-bottom: 15px; }
        .modal-field label { display: block; margin-bottom: 5px; font-weight: 500; color: #333; }
        .modal-field input, .modal-field textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 0.9em; }
        .modal-field textarea { min-height: 80px; resize: vertical; }
        .modal-actions { display: flex; gap: 10px; margin-top: 20px; }
        .modal-actions button { flex: 1; padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; }
        .btn-save { background: #667eea; color: white; }
        .btn-cancel { background: #f0f0f0; color: #333; }

        /* Image Upload */
        .image-upload-area { border: 2px dashed #667eea; border-radius: 8px; padding: 20px; text-align: center; cursor: pointer; transition: all 0.2s; background: #f8f9ff; }
        .image-upload-area:hover { background: #eef1ff; border-color: #5a6fd6; }
        .image-upload-area.has-image { border-style: solid; }
        .image-upload-area input[type="file"] { display: none; }
        .image-preview { max-width: 100%; max-height: 150px; border-radius: 8px; margin-top: 10px; }
        .upload-icon { font-size: 2em; margin-bottom: 10px; }
        .upload-text { color: #667eea; font-weight: 500; }
        .upload-hint { color: #999; font-size: 0.85em; margin-top: 5px; }

        /* Template Styles */
        .template-modern .cv-header { border-bottom: 3px solid #667eea; }
        .template-classic .cv-header { border-bottom: 2px solid #333; }
        .template-classic .cv-section-title { color: #333; }
        .template-creative .cv-header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; margin: -40px -40px 30px -40px; border-radius: 15px 15px 0 0; border-bottom: none; }
        .template-creative .cv-name { color: white; }
        .template-creative .cv-headline { color: rgba(255,255,255,0.9); }
        .template-creative .cv-contact { color: rgba(255,255,255,0.8); }
        .template-creative .cv-contact a { color: white; }

        /* Print Styles */
        @media print {
            body { background: white; padding: 0; }
            .sidebar { display: none; }
            .builder-layout { display: block; }
            .cv-preview { box-shadow: none; padding: 20px; }
            .header { display: none; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìù CV Builder</h1>
            <p>Build your CV using your Career Blueprint | Click any text to edit</p>
        </div>

        <div class="builder-layout">
            <!-- Sidebar Controls -->
            <div class="sidebar">
                <h2>üé® CV Template</h2>
                <div class="option-group">
                    <label><input type="radio" name="template" value="modern" checked onchange="changeTemplate(this.value)"><span>Modern (Clean)</span></label>
                    <label><input type="radio" name="template" value="classic" onchange="changeTemplate(this.value)"><span>Classic (Traditional)</span></label>
                    <label><input type="radio" name="template" value="creative" onchange="changeTemplate(this.value)"><span>Creative (Bold)</span></label>
                </div>

                <h2>üë§ Profile Style</h2>
                <div class="option-group">
                    <label><input type="radio" name="profile" value="proposition" checked onchange="changeProfile(this.value)"><span>Full Proposition</span></label>
                    <label><input type="radio" name="profile" value="summary" onchange="changeProfile(this.value)"><span>Brief Summary</span></label>
                    <label><input type="radio" name="profile" value="none" onchange="changeProfile(this.value)"><span>No Profile</span></label>
                </div>

                <h2>üìã Sections</h2>
                <div class="section-toggle">
                    <span>Experience</span>
                    <label class="toggle-switch">
                        <input type="checkbox" checked onchange="toggleSection('experience', this.checked)">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="section-toggle">
                    <span>Case Studies</span>
                    <label class="toggle-switch">
                        <input type="checkbox" checked onchange="toggleSection('case-studies', this.checked)">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="section-toggle">
                    <span>Skills</span>
                    <label class="toggle-switch">
                        <input type="checkbox" checked onchange="toggleSection('skills', this.checked)">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="section-toggle">
                    <span>Education</span>
                    <label class="toggle-switch">
                        <input type="checkbox" checked onchange="toggleSection('education', this.checked)">
                        <span class="toggle-slider"></span>
                    </label>
                </div>

                <h2 style="margin-top: 20px;">üíæ Actions</h2>
                <button onclick="saveCV()" style="width: 100%; padding: 12px; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer; margin-bottom: 10px; font-weight: 600;">Save Progress</button>
                <button onclick="window.print()" style="width: 100%; padding: 12px; background: #4CAF50; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">Export PDF</button>
            </div>

            <!-- CV Preview -->
            <div class="cv-preview template-modern" id="cv-preview">
                <div class="cv-header">
                    <div class="cv-name editable" contenteditable="true" id="cv-name">[CLIENT_NAME]</div>
                    <div class="cv-headline editable" contenteditable="true" id="cv-headline">Your LinkedIn Headline Here</div>
                    <div class="cv-contact">
                        <span class="editable" contenteditable="true" id="cv-email">email@example.com</span>
                        <span class="editable" contenteditable="true" id="cv-phone">+44 7XXX XXXXXX</span>
                        <span class="editable" contenteditable="true" id="cv-location">Location, UK</span>
                        <a href="#" class="editable" contenteditable="true" id="cv-linkedin">linkedin.com/in/yourprofile</a>
                    </div>
                </div>

                <!-- Profile/Proposition -->
                <div class="cv-section" id="profile-section">
                    <div class="cv-section-title">Profile</div>
                    <div class="cv-proposition editable" contenteditable="true" id="cv-proposition">
                        Your full proposition from the Blueprint goes here. This should capture your core pattern, your thread, and the transformation you enable.

                        Replace this with content from your Career Blueprint - specifically your one-sentence introduction and transformation statement.
                    </div>
                </div>

                <!-- Experience -->
                <div class="cv-section" id="experience-section">
                    <div class="cv-section-title">Experience</div>

                    <div class="cv-experience">
                        <div class="cv-experience-header">
                            <div>
                                <div class="cv-role editable" contenteditable="true">Job Title</div>
                                <div class="cv-company editable" contenteditable="true">Company Name</div>
                            </div>
                            <div class="cv-dates editable" contenteditable="true">2020 - Present</div>
                        </div>
                        <ul class="cv-bullets">
                            <li class="editable" contenteditable="true">Key achievement from your Blueprint outcomes - use the STAR format from your evidence collection</li>
                            <li class="editable" contenteditable="true">Another measurable achievement</li>
                            <li class="editable" contenteditable="true">Impact and results</li>
                        </ul>
                    </div>

                    <div class="cv-experience">
                        <div class="cv-experience-header">
                            <div>
                                <div class="cv-role editable" contenteditable="true">Previous Role</div>
                                <div class="cv-company editable" contenteditable="true">Previous Company</div>
                            </div>
                            <div class="cv-dates editable" contenteditable="true">2017 - 2020</div>
                        </div>
                        <ul class="cv-bullets">
                            <li class="editable" contenteditable="true">Key achievement</li>
                            <li class="editable" contenteditable="true">Another achievement</li>
                        </ul>
                    </div>
                </div>

                <!-- Case Studies -->
                <div class="cv-section" id="case-studies-section">
                    <div class="cv-section-title">Key Transformations</div>
                    <p style="color: #666; margin-bottom: 15px; font-size: 0.9em;">From your Blueprint evidence collection:</p>

                    <div class="case-study" id="casestudy-1" data-image="">
                        <div class="case-study-hero" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                            <div class="case-study-logo editable" contenteditable="true">Company/Brand Name</div>
                        </div>
                        <div class="case-study-content">
                            <div class="case-study-header">
                                <div class="case-study-title editable" contenteditable="true">Outcome #1: Title</div>
                                <div class="case-study-actions">
                                    <button class="change-image-btn" onclick="triggerImageUpload('1')">üì∑ Image</button>
                                    <button class="delete-btn" onclick="deleteCaseStudy('1')">üóëÔ∏è Delete</button>
                                </div>
                            </div>
                            <div class="case-study-text editable" contenteditable="true">
                                Paste your Outcome #1 from the Blueprint here. Challenge ‚Üí Action ‚Üí Result format works well.
                            </div>
                        </div>
                        <input type="file" id="imageUpload-1" accept="image/*" onchange="handleImageUpload('1', this)" style="display: none;">
                    </div>

                    <div class="case-study" id="casestudy-2" data-image="">
                        <div class="case-study-hero" style="background: linear-gradient(135deg, #4CAF50 0%, #2196F3 100%);">
                            <div class="case-study-logo editable" contenteditable="true">Company/Brand Name</div>
                        </div>
                        <div class="case-study-content">
                            <div class="case-study-header">
                                <div class="case-study-title editable" contenteditable="true">Outcome #2: Title</div>
                                <div class="case-study-actions">
                                    <button class="change-image-btn" onclick="triggerImageUpload('2')">üì∑ Image</button>
                                    <button class="delete-btn" onclick="deleteCaseStudy('2')">üóëÔ∏è Delete</button>
                                </div>
                            </div>
                            <div class="case-study-text editable" contenteditable="true">
                                Paste your Outcome #2 here.
                            </div>
                        </div>
                        <input type="file" id="imageUpload-2" accept="image/*" onchange="handleImageUpload('2', this)" style="display: none;">
                    </div>

                    <button class="add-casestudy-btn" onclick="openAddCaseStudyModal()">üìä Add New Case Study</button>
                </div>

                <!-- Add Case Study Modal -->
                <div class="modal-overlay" id="addCaseStudyModal">
                    <div class="modal">
                        <h2>üìä Add New Case Study</h2>
                        <div class="modal-field">
                            <label>Company/Brand Name</label>
                            <input type="text" id="csCompany" placeholder="e.g., Acme Corporation">
                        </div>
                        <div class="modal-field">
                            <label>Project/Outcome Title</label>
                            <input type="text" id="csTitle" placeholder="e.g., Digital Transformation">
                        </div>
                        <div class="modal-field">
                            <label>Hero Image (optional)</label>
                            <div class="image-upload-area" id="csImageUploadArea" onclick="document.getElementById('csImageInput').click()">
                                <div class="upload-icon">üì∑</div>
                                <div class="upload-text">Click to upload image</div>
                                <div class="upload-hint">PNG, JPG up to 2MB</div>
                                <input type="file" id="csImageInput" accept="image/*" onchange="previewImage(this)">
                                <img id="csImagePreview" class="image-preview" style="display: none;">
                            </div>
                        </div>
                        <div class="modal-field">
                            <label>Challenge</label>
                            <textarea id="csChallenge" placeholder="What was the challenge or problem?"></textarea>
                        </div>
                        <div class="modal-field">
                            <label>Action</label>
                            <textarea id="csAction" placeholder="What did you do to solve it?"></textarea>
                        </div>
                        <div class="modal-field">
                            <label>Result</label>
                            <textarea id="csResult" placeholder="What was the measurable outcome?"></textarea>
                        </div>
                        <div class="modal-actions">
                            <button class="btn-cancel" onclick="closeAddCaseStudyModal()">Cancel</button>
                            <button class="btn-save" onclick="addCaseStudy()">Add Case Study</button>
                        </div>
                    </div>
                </div>

                <!-- Skills -->
                <div class="cv-section" id="skills-section">
                    <div class="cv-section-title">Core Capabilities</div>
                    <p style="color: #666; margin-bottom: 15px; font-size: 0.9em;">From your "Engine" in the Blueprint:</p>
                    <div class="cv-skills" id="skills-container">
                        <span class="cv-skill editable" contenteditable="true">Skill 1</span>
                        <span class="cv-skill editable" contenteditable="true">Skill 2</span>
                        <span class="cv-skill editable" contenteditable="true">Skill 3</span>
                        <span class="cv-skill editable" contenteditable="true">Skill 4</span>
                        <span class="cv-skill editable" contenteditable="true">Skill 5</span>
                    </div>
                </div>

                <!-- Education -->
                <div class="cv-section" id="education-section">
                    <div class="cv-section-title">Education</div>
                    <div class="cv-experience">
                        <div class="cv-experience-header">
                            <div>
                                <div class="cv-role editable" contenteditable="true">Degree/Qualification</div>
                                <div class="cv-company editable" contenteditable="true">Institution Name</div>
                            </div>
                            <div class="cv-dates editable" contenteditable="true">Year</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Template switching
        function changeTemplate(template) {
            const preview = document.getElementById('cv-preview');
            preview.className = 'cv-preview template-' + template;
        }

        // Profile style
        function changeProfile(style) {
            const section = document.getElementById('profile-section');
            section.style.display = style === 'none' ? 'none' : 'block';
        }

        // Section toggles
        function toggleSection(sectionId, visible) {
            const section = document.getElementById(sectionId + '-section');
            if (section) {
                section.style.display = visible ? 'block' : 'none';
            }
        }

        // Case Study Management
        let caseStudyCounter = 2;
        let pendingImageData = null;

        // Open modal
        function openAddCaseStudyModal() {
            document.getElementById('addCaseStudyModal').classList.add('visible');
            // Reset form
            document.getElementById('csCompany').value = '';
            document.getElementById('csTitle').value = '';
            document.getElementById('csChallenge').value = '';
            document.getElementById('csAction').value = '';
            document.getElementById('csResult').value = '';
            document.getElementById('csImageInput').value = '';
            document.getElementById('csImagePreview').style.display = 'none';
            document.getElementById('csImageUploadArea').classList.remove('has-image');
            pendingImageData = null;
        }

        // Close modal
        function closeAddCaseStudyModal() {
            document.getElementById('addCaseStudyModal').classList.remove('visible');
        }

        // Preview image in modal
        function previewImage(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    pendingImageData = e.target.result;
                    const preview = document.getElementById('csImagePreview');
                    preview.src = pendingImageData;
                    preview.style.display = 'block';
                    document.getElementById('csImageUploadArea').classList.add('has-image');
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        // Trigger image upload for existing case study
        function triggerImageUpload(id) {
            document.getElementById('imageUpload-' + id).click();
        }

        // Handle image upload for existing case study
        function handleImageUpload(id, input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const imageData = e.target.result;
                    const caseStudy = document.getElementById('casestudy-' + id);
                    const hero = caseStudy.querySelector('.case-study-hero');
                    hero.style.backgroundImage = `url(${imageData})`;
                    hero.style.background = `linear-gradient(to top, rgba(0,0,0,0.6) 0%, rgba(0,0,0,0.2) 100%), url(${imageData})`;
                    hero.style.backgroundSize = 'cover';
                    hero.style.backgroundPosition = 'center';
                    caseStudy.dataset.image = imageData;
                    saveCaseStudies();
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        // Add case study from modal
        function addCaseStudy() {
            const company = document.getElementById('csCompany').value || 'New Company';
            const title = document.getElementById('csTitle').value || 'New Project';
            const challenge = document.getElementById('csChallenge').value || 'Describe the challenge...';
            const action = document.getElementById('csAction').value || 'Describe your action...';
            const result = document.getElementById('csResult').value || 'Describe the result...';

            caseStudyCounter++;
            const id = 'custom-' + caseStudyCounter;

            // Determine background style
            let heroStyle = '';
            if (pendingImageData) {
                heroStyle = `background: linear-gradient(to top, rgba(0,0,0,0.6) 0%, rgba(0,0,0,0.2) 100%), url(${pendingImageData}); background-size: cover; background-position: center;`;
            } else {
                // Random gradient colours as fallback
                const colours = [
                    ['#667eea', '#764ba2'],
                    ['#4CAF50', '#2196F3'],
                    ['#FF6B6B', '#FFA726'],
                    ['#00BCD4', '#3F51B5'],
                    ['#E91E63', '#9C27B0']
                ];
                const randomColours = colours[Math.floor(Math.random() * colours.length)];
                heroStyle = `background: linear-gradient(135deg, ${randomColours[0]} 0%, ${randomColours[1]} 100%);`;
            }

            const caseStudyHTML = `
                <div class="case-study" id="casestudy-${id}" data-image="${pendingImageData || ''}">
                    <div class="case-study-hero" style="${heroStyle}">
                        <div class="case-study-logo editable" contenteditable="true">${company}</div>
                    </div>
                    <div class="case-study-content">
                        <div class="case-study-header">
                            <div class="case-study-title editable" contenteditable="true">${title}</div>
                            <div class="case-study-actions">
                                <button class="change-image-btn" onclick="triggerImageUpload('${id}')">üì∑ Image</button>
                                <button class="delete-btn" onclick="deleteCaseStudy('${id}')">üóëÔ∏è Delete</button>
                            </div>
                        </div>
                        <div class="case-study-text editable" contenteditable="true">
                            <strong>Challenge:</strong> ${challenge}<br><br>
                            <strong>Action:</strong> ${action}<br><br>
                            <strong>Result:</strong> ${result}
                        </div>
                    </div>
                    <input type="file" id="imageUpload-${id}" accept="image/*" onchange="handleImageUpload('${id}', this)" style="display: none;">
                </div>
            `;

            const section = document.getElementById('case-studies-section');
            const addButton = section.querySelector('.add-casestudy-btn');
            addButton.insertAdjacentHTML('beforebegin', caseStudyHTML);

            closeAddCaseStudyModal();
            saveCaseStudies();
        }

        // Delete case study
        function deleteCaseStudy(id) {
            if (!confirm('Are you sure you want to delete this case study?')) return;
            const element = document.getElementById('casestudy-' + id);
            if (element) {
                element.remove();
                saveCaseStudies();
            }
        }

        // Save case studies to localStorage
        function saveCaseStudies() {
            const caseStudies = [];
            document.querySelectorAll('.case-study').forEach(cs => {
                caseStudies.push({
                    id: cs.id,
                    company: cs.querySelector('.case-study-logo')?.innerText || '',
                    title: cs.querySelector('.case-study-title')?.innerText || '',
                    content: cs.querySelector('.case-study-text')?.innerHTML || '',
                    image: cs.dataset.image || ''
                });
            });
            localStorage.setItem('cv_casestudies_[CLIENT_ID]', JSON.stringify(caseStudies));
        }

        // Load case studies from localStorage
        function loadCaseStudies() {
            const saved = localStorage.getItem('cv_casestudies_[CLIENT_ID]');
            if (saved) {
                const section = document.getElementById('case-studies-section');
                const addButton = section.querySelector('.add-casestudy-btn');

                // Remove existing case studies
                section.querySelectorAll('.case-study').forEach(cs => cs.remove());

                // Add saved case studies
                const caseStudies = JSON.parse(saved);
                caseStudies.forEach(cs => {
                    // Determine background style
                    let heroStyle = '';
                    if (cs.image) {
                        heroStyle = `background: linear-gradient(to top, rgba(0,0,0,0.6) 0%, rgba(0,0,0,0.2) 100%), url(${cs.image}); background-size: cover; background-position: center;`;
                    } else {
                        heroStyle = `background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);`;
                    }

                    const csId = cs.id.replace('casestudy-', '');
                    const html = `
                        <div class="case-study" id="${cs.id}" data-image="${cs.image || ''}">
                            <div class="case-study-hero" style="${heroStyle}">
                                <div class="case-study-logo editable" contenteditable="true">${cs.company}</div>
                            </div>
                            <div class="case-study-content">
                                <div class="case-study-header">
                                    <div class="case-study-title editable" contenteditable="true">${cs.title}</div>
                                    <div class="case-study-actions">
                                        <button class="change-image-btn" onclick="triggerImageUpload('${csId}')">üì∑ Image</button>
                                        <button class="delete-btn" onclick="deleteCaseStudy('${csId}')">üóëÔ∏è Delete</button>
                                    </div>
                                </div>
                                <div class="case-study-text editable" contenteditable="true">${cs.content}</div>
                            </div>
                            <input type="file" id="imageUpload-${csId}" accept="image/*" onchange="handleImageUpload('${csId}', this)" style="display: none;">
                        </div>
                    `;
                    addButton.insertAdjacentHTML('beforebegin', html);
                });

                // Update counter
                caseStudyCounter = caseStudies.length;
            }
        }

        // Save CV
        function saveCV() {
            const data = {};
            document.querySelectorAll('.editable').forEach(el => {
                if (el.id) {
                    data[el.id] = el.innerHTML;
                }
            });
            localStorage.setItem('cv_[CLIENT_ID]', JSON.stringify(data));
            alert('‚úÖ CV saved!');
        }

        // Load CV
        function loadCV() {
            const saved = localStorage.getItem('cv_[CLIENT_ID]');
            if (saved) {
                const data = JSON.parse(saved);
                Object.keys(data).forEach(id => {
                    const el = document.getElementById(id);
                    if (el) {
                        el.innerHTML = data[id];
                    }
                });
            }
        }

        // Auto-save on blur
        document.querySelectorAll('.editable').forEach(el => {
            el.addEventListener('blur', () => {
                saveCV();
            });
        });

        // Load on page load
        loadCV();
        loadCaseStudies();

        // Close modal when clicking outside
        document.getElementById('addCaseStudyModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeAddCaseStudyModal();
            }
        });
    </script>
</body>
</html>
