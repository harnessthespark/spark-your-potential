<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Peri's Spark ‚ú®</title>

    <!-- PWA Meta Tags -->
    <meta name="description" content="Peri's personal wellbeing toolkit - gentle support for emotional regulation and executive function challenges">
    <meta name="theme-color" content="#f59e0b">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Peri's Spark">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">

    <!-- Icons -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>‚ú®</text></svg>">

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Patrick+Hand&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --ignited: #22c55e;
            --ignited-bg: #f0fdf4;
            --hyper: #ef4444;
            --hyper-bg: #fef2f2;
            --hypo: #3b82f6;
            --hypo-bg: #eff6ff;
            --dysreg-upper: #f59e0b;
            --dysreg-upper-bg: #fffbeb;
            --dysreg-lower: #8b5cf6;
            --dysreg-lower-bg: #f5f3ff;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 30%, #fcd34d 60%, #fbbf24 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }

        /* Header */
        .header {
            text-align: center;
            padding: 30px 0;
            color: #92400e;
        }
        .header h1 {
            font-size: 2em;
            font-weight: 800;
            margin-bottom: 8px;
            color: #78350f;
        }
        .header .subtitle {
            opacity: 0.8;
            font-size: 1.1em;
        }
        .header .greeting {
            font-size: 1.2em;
            margin-bottom: 5px;
            color: #b45309;
        }

        /* Main Card */
        .main-card {
            background: white;
            border-radius: 24px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        /* State Selector */
        .state-question {
            text-align: center;
            margin-bottom: 30px;
        }
        .state-question h2 {
            font-size: 1.5em;
            color: #2d1b4e;
            margin-bottom: 10px;
        }
        .state-question p {
            color: #666;
            font-size: 0.95em;
        }

        .state-grid {
            display: grid;
            gap: 15px;
        }

        .state-option {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 20px;
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid transparent;
        }
        .state-option:hover {
            transform: translateX(5px);
        }
        .state-option.selected {
            border-color: currentColor;
            transform: scale(1.02);
        }

        .state-option.ignited { background: var(--ignited-bg); color: var(--ignited); }
        .state-option.hyper { background: var(--hyper-bg); color: var(--hyper); }
        .state-option.hypo { background: var(--hypo-bg); color: var(--hypo); }
        .state-option.dysreg-upper { background: var(--dysreg-upper-bg); color: var(--dysreg-upper); }
        .state-option.dysreg-lower { background: var(--dysreg-lower-bg); color: var(--dysreg-lower); }

        .state-icon {
            font-size: 2.5em;
            width: 60px;
            text-align: center;
        }
        .state-info h3 {
            font-size: 1.1em;
            font-weight: 700;
            margin-bottom: 4px;
        }
        .state-info p {
            font-size: 0.9em;
            opacity: 0.8;
            color: #555;
        }

        /* Continue Button */
        .continue-btn {
            display: block;
            width: 100%;
            padding: 18px;
            margin-top: 25px;
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.1em;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
        }
        .continue-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(245, 158, 11, 0.3);
        }
        .continue-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* State Detail View */
        .state-detail {
            display: none;
        }
        .state-detail.active {
            display: block;
        }

        .state-header {
            text-align: center;
            padding: 25px;
            border-radius: 16px;
            margin-bottom: 25px;
        }
        .state-header.ignited { background: var(--ignited-bg); }
        .state-header.hyper { background: var(--hyper-bg); }
        .state-header.hypo { background: var(--hypo-bg); }
        .state-header.dysreg-upper { background: var(--dysreg-upper-bg); }
        .state-header.dysreg-lower { background: var(--dysreg-lower-bg); }

        .state-header .icon {
            font-size: 3em;
            margin-bottom: 10px;
        }
        .state-header h2 {
            font-size: 1.5em;
            margin-bottom: 5px;
        }
        .state-header .zone {
            font-size: 0.9em;
            opacity: 0.7;
        }

        /* Explanation Cards */
        .explanation-section {
            margin-bottom: 25px;
        }
        .explanation-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
        }
        .explanation-card h4 {
            color: #2d1b4e;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .explanation-card p {
            color: #555;
            line-height: 1.6;
            font-size: 0.95em;
        }
        .explanation-card.neurology {
            background: linear-gradient(135deg, #e9d5ff 0%, #c4b5fd 100%);
            border-left: 4px solid #8b5cf6;
        }
        .explanation-card.validation {
            background: linear-gradient(135deg, #ddd6fe 0%, #c4b5fd 100%);
            border-left: 4px solid #8b5cf6;
        }

        /* DMN/TPN Explainer */
        .brain-networks-explainer {
            background: #f0f9ff;
            border: 2px solid #0ea5e9;
            border-radius: 12px;
            margin-top: 15px;
            overflow: hidden;
        }
        .explainer-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            cursor: pointer;
            background: transparent;
            border: none;
            width: 100%;
            font-family: inherit;
            color: #0369a1;
            font-weight: 600;
            font-size: 0.9em;
        }
        .explainer-toggle:hover {
            background: rgba(14, 165, 233, 0.1);
        }
        .explainer-toggle .icon {
            transition: transform 0.3s ease;
        }
        .explainer-toggle.open .icon {
            transform: rotate(180deg);
        }
        .explainer-content {
            display: none;
            padding: 0 16px 16px;
        }
        .explainer-content.open {
            display: block;
        }
        .network-box {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 12px;
            border-left: 4px solid;
        }
        .network-box.dmn {
            border-color: #8b5cf6;
        }
        .network-box.tpn {
            border-color: #22c55e;
        }
        .network-box h5 {
            color: #1e293b;
            font-size: 0.95em;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .network-box p {
            color: #64748b;
            font-size: 0.85em;
            line-height: 1.5;
            margin: 0;
        }
        .network-box ul {
            margin: 8px 0 0 0;
            padding-left: 20px;
            color: #64748b;
            font-size: 0.85em;
        }
        .network-box li {
            margin-bottom: 4px;
        }
        .explainer-summary {
            background: linear-gradient(135deg, #e9d5ff 0%, #c4b5fd 100%);
            border-radius: 8px;
            padding: 12px 15px;
            font-size: 0.85em;
            color: #5b21b6;
            line-height: 1.5;
        }

        /* Intervention Section */
        .intervention-section {
            margin-top: 30px;
        }
        .intervention-section h3 {
            color: #2d1b4e;
            margin-bottom: 20px;
            font-size: 1.2em;
        }

        .intervention-categories {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }
        .category-tab {
            padding: 10px 20px;
            border-radius: 25px;
            border: 2px solid #e0e0e0;
            background: white;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 600;
            transition: all 0.2s;
        }
        .category-tab:hover {
            border-color: #f59e0b;
        }
        .category-tab.active {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
            border-color: transparent;
        }

        .intervention-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .intervention-item {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 18px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .intervention-item:hover {
            border-color: #f59e0b;
            transform: translateY(-2px);
        }
        .intervention-item.expanded {
            border-color: #f59e0b;
            background: #fffbeb;
        }

        .intervention-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .intervention-header h4 {
            color: #2d1b4e;
            font-size: 1em;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .intervention-actions {
            display: flex;
            gap: 8px;
        }
        .fav-btn, .tried-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: 2px solid #e0e0e0;
            background: white;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.2s;
        }
        .fav-btn:hover { border-color: #f59e0b; background: #fffbeb; }
        .fav-btn.active { border-color: #f59e0b; background: #fef3c7; }
        .tried-btn:hover { border-color: #22c55e; background: #f0fdf4; }
        .tried-btn.active { border-color: #22c55e; background: #dcfce7; }

        .intervention-content {
            display: none;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #e0e0e0;
        }
        .intervention-item.expanded .intervention-content {
            display: block;
        }

        .intervention-steps {
            list-style: none;
            counter-reset: step;
        }
        .intervention-steps li {
            counter-increment: step;
            padding: 10px 0 10px 45px;
            position: relative;
            line-height: 1.5;
            color: #444;
        }
        .intervention-steps li::before {
            content: counter(step);
            position: absolute;
            left: 0;
            top: 8px;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
            font-weight: 700;
            font-size: 0.85em;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .intervention-tip {
            background: #f0fdf4;
            border-left: 3px solid #22c55e;
            padding: 12px 15px;
            margin-top: 15px;
            border-radius: 0 8px 8px 0;
            font-size: 0.9em;
            color: #166534;
        }

        /* Brain Chemical Link Section */
        .brain-link-section {
            margin-top: 30px;
            padding: 25px;
            background: linear-gradient(135deg, #faf5ff 0%, #e9d5ff 100%);
            border-radius: 16px;
            text-align: center;
        }
        .brain-link-section h4 {
            color: #6d28d9;
            margin-bottom: 8px;
            font-size: 1.1em;
        }
        .brain-link-section > p {
            color: #7c3aed;
            font-size: 0.9em;
            margin-bottom: 20px;
        }
        .brain-link-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            justify-content: center;
        }
        .brain-link-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            padding: 15px 20px;
            background: white;
            border: 3px solid #ddd;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            min-width: 120px;
        }
        .brain-link-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }
        .brain-link-btn .chem-icon {
            font-size: 1.8em;
        }
        .brain-link-btn .chem-name {
            font-weight: 700;
            font-size: 0.85em;
            color: #333;
        }
        .brain-link-btn .chem-why {
            font-size: 0.75em;
            color: #666;
        }

        /* Back Button */
        .back-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            background: #f0f0f0;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
            color: #555;
            margin-bottom: 20px;
        }
        @media (max-width: 600px) {
            .back-btn {
                position: relative;
                top: auto;
                left: auto;
                display: block;
                margin: 10px auto 20px;
                text-align: center;
                width: fit-content;
            }
        }

        .back-btn:hover {
            background: #e0e0e0;
        }

        /* Quick Access Bar */
        .quick-access {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border-radius: 12px;
            padding: 15px 20px;
            margin-top: 25px;
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        .quick-access span {
            font-weight: 600;
            color: #92400e;
        }
        .quick-fav {
            padding: 8px 15px;
            background: white;
            border-radius: 20px;
            font-size: 0.85em;
            cursor: pointer;
            border: 2px solid #fcd34d;
            transition: all 0.2s;
        }
        .quick-fav:hover {
            background: #fffbeb;
            transform: translateY(-2px);
        }

        /* History Log */
        .history-section {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #f0f0f0;
        }
        .history-section h3 {
            color: #2d1b4e;
            margin-bottom: 15px;
            font-size: 1.1em;
        }
        .history-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 8px;
            font-size: 0.9em;
        }
        .history-item .state-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 600;
        }
        .history-item .state-badge.ignited { background: var(--ignited-bg); color: var(--ignited); }
        .history-item .state-badge.hyper { background: var(--hyper-bg); color: var(--hyper); }
        .history-item .state-badge.hypo { background: var(--hypo-bg); color: var(--hypo); }
        .history-item .state-badge.dysreg-upper { background: var(--dysreg-upper-bg); color: var(--dysreg-upper); }
        .history-item .state-badge.dysreg-lower { background: var(--dysreg-lower-bg); color: var(--dysreg-lower); }

        /* Mobile Responsive */
        @media (max-width: 600px) {
            .container { padding: 15px; }
            .main-card { padding: 20px; border-radius: 20px; }
            .state-option { padding: 15px; }
            .state-icon { font-size: 2em; width: 50px; }
            .header h1 { font-size: 1.6em; }
            .intervention-categories {
                overflow-x: auto;
                flex-wrap: nowrap;
                padding-bottom: 10px;
            }
            .category-tab { white-space: nowrap; }
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in {
            animation: fadeIn 0.4s ease-out;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        .pulse {
            animation: pulse 2s infinite;
        }

        /* Neurotransmitter Section */
        .neuro-section {
            margin-top: 30px;
            padding-top: 25px;
            border-top: 2px solid #f0f0f0;
        }
        .neuro-section h3 {
            color: #2d1b4e;
            margin-bottom: 20px;
            font-size: 1.2em;
            text-align: center;
        }
        .neuro-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        @media (max-width: 600px) {
            .neuro-grid { grid-template-columns: 1fr; }
        }
        .neuro-card {
            border-radius: 12px;
            padding: 18px;
            cursor: pointer;
            transition: all 0.2s;
            border: 3px solid transparent;
        }
        .neuro-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        .neuro-card.selected {
            border-color: #2d1b4e;
        }
        .neuro-card.highlighted {
            animation: pulse-highlight 0.5s ease-in-out 3;
            border-color: #8b5cf6;
        }
        @keyframes pulse-highlight {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); box-shadow: 0 12px 35px rgba(139, 92, 246, 0.4); }
        }
        .neuro-card.dopamine { background: linear-gradient(135deg, #fce4ec 0%, #f8bbd9 100%); }
        .neuro-card.oxytocin { background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%); }
        .neuro-card.serotonin { background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%); }
        .neuro-card.endorphins { background: linear-gradient(135deg, #e0f7fa 0%, #b2ebf2 100%); }
        .neuro-card-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        .neuro-card-header .icon {
            font-size: 1.8em;
        }
        .neuro-card-header h4 {
            font-size: 1.1em;
            font-weight: 700;
            color: #2d1b4e;
        }
        .neuro-card p {
            font-size: 0.85em;
            color: #555;
            margin: 0;
        }
        .neuro-detail {
            display: none;
            margin-top: 20px;
            padding: 20px;
            background: white;
            border-radius: 12px;
            border: 2px solid #e0e0e0;
        }
        .neuro-detail.active {
            display: block;
        }
        .neuro-detail h4 {
            color: #2d1b4e;
            margin-bottom: 15px;
            font-size: 1.1em;
        }

        /* Interactive Symptom Checker */
        .symptom-checker {
            background: #fff;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .symptom-checker h5 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1em;
        }
        .symptom-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 12px 15px;
            background: #fef2f2;
            border-radius: 10px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        .symptom-item:hover {
            border-color: #fca5a5;
        }
        .symptom-item.checked {
            background: #f0fdf4;
            border-color: #86efac;
        }
        .symptom-checkbox {
            width: 22px;
            height: 22px;
            border: 2px solid #ddd;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            transition: all 0.2s;
            background: white;
        }
        .symptom-item.checked .symptom-checkbox {
            background: #22c55e;
            border-color: #22c55e;
            color: white;
        }
        .symptom-content {
            flex: 1;
        }
        .symptom-label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
            color: #444;
        }
        .symptom-tip {
            display: none;
            margin-top: 10px;
            padding: 12px;
            background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
            border-radius: 8px;
            font-size: 0.9em;
            color: #065f46;
            animation: slideDown 0.3s ease;
        }
        .symptom-item.checked .symptom-tip {
            display: block;
        }
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .tip-label {
            font-weight: 600;
            color: #059669;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* Lightweight Brain Dump */
        .brain-dump-section {
            margin-top: 30px;
            padding-top: 25px;
            border-top: 2px solid #fde68a;
        }
        .brain-dump-section h3 {
            color: #92400e;
            margin-bottom: 10px;
            font-size: 1.2em;
            text-align: center;
        }
        .brain-dump-textarea {
            width: 100%;
            min-height: 150px;
            padding: 15px;
            border: 2px solid #fde68a;
            border-radius: 12px;
            font-family: inherit;
            font-size: 1em;
            resize: vertical;
            background: #fffef5;
            color: #333;
            line-height: 1.6;
        }
        .brain-dump-textarea::placeholder {
            color: #b45309;
            opacity: 0.6;
        }
        .brain-dump-textarea:focus {
            outline: none;
            border-color: #f59e0b;
            box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.2);
        }
        .brain-dump-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
            padding: 8px 0;
        }
        .save-status {
            font-size: 0.85em;
            color: #22c55e;
        }
        .save-status.saving {
            color: #f59e0b;
        }
        .clear-dump-btn {
            padding: 8px 16px;
            background: #fff;
            border: 1px solid #fde68a;
            border-radius: 8px;
            font-size: 0.85em;
            color: #92400e;
            cursor: pointer;
            transition: all 0.2s;
        }
        .clear-dump-btn:hover {
            background: #fef3c7;
            border-color: #f59e0b;
        }

        /* Simple Journal */
        .journal-section {
            margin-top: 25px;
            padding-top: 25px;
            border-top: 2px solid #fde68a;
        }
        .journal-section h3 {
            color: #92400e;
            margin-bottom: 10px;
            font-size: 1.2em;
            text-align: center;
        }
        .journal-prompts {
            margin-bottom: 15px;
            text-align: center;
        }
        .prompt-label {
            display: block;
            font-size: 0.85em;
            color: #666;
            margin-bottom: 10px;
        }
        .prompt-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
        }
        .prompt-chip {
            padding: 8px 14px;
            background: #fffef5;
            border: 2px solid #fde68a;
            border-radius: 20px;
            font-size: 0.85em;
            color: #92400e;
            cursor: pointer;
            transition: all 0.2s;
        }
        .prompt-chip:hover {
            background: #fef3c7;
            border-color: #f59e0b;
            transform: translateY(-2px);
        }
        .journal-textarea {
            width: 100%;
            min-height: 150px;
            padding: 15px;
            border: 2px solid #fde68a;
            border-radius: 12px;
            font-family: inherit;
            font-size: 1em;
            resize: vertical;
            background: #fffef5;
            color: #333;
            line-height: 1.6;
        }
        .journal-textarea:focus {
            outline: none;
            border-color: #f59e0b;
            box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.2);
        }
        .journal-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
        }
        .journal-status {
            font-size: 0.85em;
            color: #22c55e;
        }
        .save-entry-btn {
            padding: 8px 16px;
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            border: none;
            border-radius: 8px;
            font-size: 0.85em;
            color: white;
            cursor: pointer;
            transition: all 0.2s;
        }
        .save-entry-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(245, 158, 11, 0.4);
        }
        .past-entries {
            margin-top: 20px;
        }
        .entries-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
            padding: 12px 16px;
            background: #fffef5;
            border: 2px solid #fde68a;
            border-radius: 8px;
            cursor: pointer;
            font-family: inherit;
            font-size: 0.9em;
            color: #92400e;
        }
        .entries-toggle:hover {
            background: #fef3c7;
        }
        .toggle-icon {
            transition: transform 0.3s;
        }
        .entries-toggle.open .toggle-icon {
            transform: rotate(180deg);
        }
        .entries-list {
            display: none;
            margin-top: 15px;
        }
        .entries-list.open {
            display: block;
        }
        .entry-card {
            background: #fffef5;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 12px;
            border-left: 3px solid #f59e0b;
        }
        .entry-date {
            font-size: 0.8em;
            color: #888;
            margin-bottom: 8px;
        }
        .entry-text {
            font-size: 0.95em;
            color: #444;
            line-height: 1.5;
            white-space: pre-wrap;
        }
        .entry-delete {
            float: right;
            background: none;
            border: none;
            color: #ccc;
            cursor: pointer;
            font-size: 1.2em;
            padding: 0;
        }
        .entry-delete:hover {
            color: #ef4444;
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 20px;
            color: rgba(255,255,255,0.8);
            font-size: 0.85em;
        }
        .footer a {
            color: rgba(255,255,255,0.9);
            text-decoration: none;
        }
        .footer a:hover {
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <p class="greeting" id="greeting">Hey Peri üíú</p>
            <h1>‚ú® Your Spark Toolkit</h1>
            <div class="subtitle">gentle support when your brain needs a hand</div>
        </div>

        <div class="main-card">
            <!-- Step 1: State Selection -->
            <div id="stateSelector" class="fade-in">
                <div class="state-question">
                    <h2>Where are you right now, Peri?</h2>
                    <p>No judgement. Just notice. This is your starting point.</p>
                </div>

                <div class="state-grid">
                    <div class="state-option ignited" onclick="selectState('ignited')">
                        <div class="state-icon">‚ú®</div>
                        <div class="state-info">
                            <h3>Feeling Good</h3>
                            <p>I'm in a good headspace right now</p>
                        </div>
                    </div>

                    <div class="state-option dysreg-upper" onclick="selectState('dysreg-upper')">
                        <div class="state-icon">üò§</div>
                        <div class="state-info">
                            <h3>Getting Wound Up</h3>
                            <p>Something's bothering me, stress is building</p>
                        </div>
                    </div>

                    <div class="state-option hyper" onclick="selectState('hyper')">
                        <div class="state-icon">üåÄ</div>
                        <div class="state-info">
                            <h3>Totally Overwhelmed</h3>
                            <p>Too much right now, can't think straight</p>
                        </div>
                    </div>

                    <div class="state-option dysreg-lower" onclick="selectState('dysreg-lower')">
                        <div class="state-icon">üòî</div>
                        <div class="state-info">
                            <h3>Running on Empty</h3>
                            <p>Energy's draining, starting to shut down</p>
                        </div>
                    </div>

                    <div class="state-option hypo" onclick="selectState('hypo')">
                        <div class="state-icon">üßä</div>
                        <div class="state-info">
                            <h3>Completely Flat</h3>
                            <p>Numb, can't feel anything, checked out</p>
                        </div>
                    </div>
                </div>

                <button class="continue-btn" id="continueBtn" onclick="showStateDetail()" disabled>
                    Continue ‚Üí
                </button>

                <!-- Quick Access to Favourites -->
                <div class="quick-access" id="quickAccess" style="display: none;">
                    <span>‚≠ê Your Go-Tos:</span>
                    <div id="favoritesList"></div>
                </div>

                <!-- Executive Function Quick Wins -->
                <div class="neuro-section" style="border-top-color: #a78bfa;">
                    <h3>üß† Executive Function Quick Wins</h3>
                    <p style="text-align: center; color: #666; margin-bottom: 20px; font-size: 0.9em;">When your brain needs extra support - no judgement, just gentle tools</p>

                    <div class="intervention-list">
                        <div class="intervention-item" onclick="this.classList.toggle('expanded')">
                            <div class="intervention-header">
                                <h4>üéØ One Thing Only</h4>
                            </div>
                            <div class="intervention-content">
                                <ol class="intervention-steps">
                                    <li>Look at everything swirling in your head</li>
                                    <li>Pick just ONE thing - doesn't matter which</li>
                                    <li>Do only the very first step of that one thing</li>
                                    <li>Celebrate. That's enough. You did it.</li>
                                </ol>
                                <div class="intervention-tip">
                                    üí° Your brain wants to hold everything at once. It can't. Choosing ONE is not giving up on the others - it's working WITH your brain.
                                </div>
                            </div>
                        </div>

                        <div class="intervention-item" onclick="this.classList.toggle('expanded')">
                            <div class="intervention-header">
                                <h4>‚è∞ Body Doubles</h4>
                            </div>
                            <div class="intervention-content">
                                <ol class="intervention-steps">
                                    <li>Find a "body double" - someone (or something) to be present while you work</li>
                                    <li>Options: Video call a friend, put on a "study with me" video, work in a caf√©</li>
                                    <li>You don't need them to help - just to BE there</li>
                                    <li>The presence of others helps your brain stay on track</li>
                                </ol>
                                <div class="intervention-tip">
                                    üí° This isn't weakness - it's using your social brain to support your executive function. Very clever, actually!
                                </div>
                            </div>
                        </div>

                        <div class="intervention-item" onclick="this.classList.toggle('expanded')">
                            <div class="intervention-header">
                                <h4>üìù Brain Dump</h4>
                            </div>
                            <div class="intervention-content">
                                <ol class="intervention-steps">
                                    <li>Grab paper or your phone notes</li>
                                    <li>Set a timer for 3 minutes</li>
                                    <li>Write EVERYTHING in your head - no order, no judgement</li>
                                    <li>Now your brain doesn't have to hold it all - the paper is doing that</li>
                                </ol>
                                <div class="intervention-tip">
                                    üí° Your working memory is precious. Offloading to paper frees it up for actual thinking.
                                </div>
                            </div>
                        </div>

                        <div class="intervention-item" onclick="this.classList.toggle('expanded')">
                            <div class="intervention-header">
                                <h4>üîÑ Transition Helper</h4>
                            </div>
                            <div class="intervention-content">
                                <ol class="intervention-steps">
                                    <li>Switching tasks is hard - acknowledge that</li>
                                    <li>Give yourself a "bridge" activity (make tea, stretch, 5 deep breaths)</li>
                                    <li>Say out loud: "I'm finishing [X] and starting [Y]"</li>
                                    <li>Set a gentle timer if helpful</li>
                                </ol>
                                <div class="intervention-tip">
                                    üí° Transitions are genuinely harder for some brains. Building in "bridges" respects how your brain works.
                                </div>
                            </div>
                        </div>

                        <div class="intervention-item" onclick="this.classList.toggle('expanded')">
                            <div class="intervention-header">
                                <h4>üí´ Energy-First Planning</h4>
                            </div>
                            <div class="intervention-content">
                                <ol class="intervention-steps">
                                    <li>Check in: What's your energy RIGHT NOW? (High/Medium/Low)</li>
                                    <li>Match your task to your energy - not the other way around</li>
                                    <li>Low energy = simple, familiar tasks only</li>
                                    <li>Save complex stuff for your best energy windows</li>
                                </ol>
                                <div class="intervention-tip">
                                    üí° Fighting your energy level rarely works. Working WITH it does.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Neurotransmitter Section -->
                <div class="neuro-section">
                    <h3>üß™ Your Brain's Feel-Good Squad</h3>
                    <p style="text-align: center; color: #666; margin-bottom: 20px; font-size: 0.9em;">Tap one to see what happens when it's low and how to naturally boost it</p>

                    <div class="neuro-grid">
                        <div class="neuro-card dopamine" onclick="selectNeuro('dopamine')">
                            <div class="neuro-card-header">
                                <span class="icon">üíó</span>
                                <h4>DOPAMINE</h4>
                            </div>
                            <p>The reward chemical - motivation & pleasure</p>
                        </div>

                        <div class="neuro-card oxytocin" onclick="selectNeuro('oxytocin')">
                            <div class="neuro-card-header">
                                <span class="icon">üß°</span>
                                <h4>OXYTOCIN</h4>
                            </div>
                            <p>The love hormone - connection & bonding</p>
                        </div>

                        <div class="neuro-card serotonin" onclick="selectNeuro('serotonin')">
                            <div class="neuro-card-header">
                                <span class="icon">üíô</span>
                                <h4>SEROTONIN</h4>
                            </div>
                            <p>The mood stabiliser - confidence & calm</p>
                        </div>

                        <div class="neuro-card endorphins" onclick="selectNeuro('endorphins')">
                            <div class="neuro-card-header">
                                <span class="icon">üíö</span>
                                <h4>ENDORPHINS</h4>
                            </div>
                            <p>The pain reliever - natural highs & relief</p>
                        </div>
                    </div>

                    <div id="neuroDetail" class="neuro-detail"></div>
                </div>

                <!-- Lightweight Brain Dump -->
                <div class="brain-dump-section">
                    <h3>üß† Brain Dump</h3>
                    <p style="text-align: center; color: #666; margin-bottom: 15px; font-size: 0.9em;">Get it out of your head. No structure needed.</p>

                    <textarea id="brainDump" class="brain-dump-textarea" placeholder="Just dump everything here, Peri... thoughts, worries, to-dos, random stuff. Get it OUT of your head."></textarea>

                    <div class="brain-dump-actions">
                        <span class="save-status" id="saveStatus">‚úì Saved</span>
                        <button class="clear-dump-btn" onclick="clearBrainDump()">üóëÔ∏è Clear All</button>
                    </div>
                </div>

                <!-- Simple Journal -->
                <div class="journal-section">
                    <h3>üìì Peri's Journal</h3>
                    <p style="text-align: center; color: #666; margin-bottom: 15px; font-size: 0.9em;">A place for deeper thoughts. Saved entries stay private on your device.</p>

                    <div class="journal-prompts">
                        <span class="prompt-label">Try starting with:</span>
                        <div class="prompt-chips">
                            <span class="prompt-chip" onclick="insertPrompt('Right now I feel...')">Right now I feel...</span>
                            <span class="prompt-chip" onclick="insertPrompt('Today I noticed...')">Today I noticed...</span>
                            <span class="prompt-chip" onclick="insertPrompt('What I need is...')">What I need...</span>
                        </div>
                    </div>

                    <textarea id="journalEntry" class="journal-textarea" placeholder="Write whatever's on your mind, Peri..."></textarea>

                    <div class="journal-actions">
                        <span class="journal-status" id="journalStatus">‚úì Auto-saved</span>
                        <button class="save-entry-btn" onclick="saveJournalEntry()">üíæ Save Entry</button>
                    </div>

                    <div class="past-entries" id="pastEntries" style="display: none;">
                        <button class="entries-toggle" onclick="togglePastEntries()">
                            <span>üìñ View past entries</span>
                            <span class="toggle-icon" id="entriesIcon">‚ñº</span>
                        </button>
                        <div class="entries-list" id="entriesList"></div>
                    </div>
                </div>

                <!-- Recent History -->
                <div class="history-section" id="historySection" style="display: none;">
                    <h3>üìä Recent Check-Ins</h3>
                    <div id="historyList"></div>
                </div>
            </div>

            <!-- Step 2: State Detail & Interventions -->
            <div id="stateDetail" class="state-detail"></div>
        </div>

        <div class="footer">
            <p>Made with üíú for Peri | Your data stays on your device</p>
        </div>
    </div>

    <script>
        // ============================================
        // DATA: States and Interventions
        // ============================================

        const STATES = {
            'ignited': {
                icon: '‚ú®',
                name: 'Feeling Good',
                zone: 'You\'re in a great place right now',
                color: 'ignited',
                experience: "You can access your full range right now. You can think clearly, feel your emotions without drowning in them, and make genuine choices. This is your baseline optimal state - not 'calm' necessarily, but regulated.",
                neurology: "Your Default Mode Network (DMN - internal processing, reflection) and Task Positive Network (TPN - external focus, action) are both accessible. You can switch between them fluidly. This flexibility IS emotional regulation.",
                validation: "This state is the goal, not the norm. Staying here requires active maintenance. Protect this window - it's precious, Peri.",
                categories: [
                    {
                        id: 'maintain',
                        name: 'üõ°Ô∏è Maintain',
                        tools: [
                            {
                                id: 'protect-sleep',
                                name: 'Protect Your Sleep Runway',
                                icon: 'üò¥',
                                steps: [
                                    "Set a 'screens down' alarm for 1 hour before bed",
                                    "Identify your sleep runway requirements (wind-down time needed)",
                                    "Create a sensory-friendly transition: dim lights, reduce noise",
                                    "Note what disrupts your sleep - these are early warning signs"
                                ],
                                tip: "Sleep debt is a fast track to dysregulation. This isn't about discipline - it's about protecting your nervous system capacity."
                            },
                            {
                                id: 'energy-audit',
                                name: 'Quick Energy Audit',
                                icon: '‚ö°',
                                steps: [
                                    "Check your energy tank: How full do you feel right now? (1-10)",
                                    "Look at tomorrow: Any big energy drains coming?",
                                    "Identify one thing you could move, delegate, or decline",
                                    "Schedule a recharge activity before any major drain"
                                ],
                                tip: "While you're feeling good, you can actually plan effectively."
                            },
                            {
                                id: 'boundaries-check',
                                name: 'Boundaries Health Check',
                                icon: 'üöß',
                                steps: [
                                    "Ask: 'What have I said yes to that I meant no to?'",
                                    "Identify one boundary that needs reinforcing this week",
                                    "Write the exact words you'll use if the boundary is tested",
                                    "Name the internal pressure that makes this boundary hard"
                                ],
                                tip: "Boundaries are easier to set when you're regulated. Do this maintenance now, while you can."
                            }
                        ]
                    },
                    {
                        id: 'reflect',
                        name: 'üí≠ Reflect',
                        tools: [
                            {
                                id: 'pattern-notice',
                                name: 'Pattern Noticing',
                                icon: 'üîç',
                                steps: [
                                    "Think about your last time you felt overwhelmed",
                                    "What happened in the 24 hours before? (sleep, food, social, sensory)",
                                    "What was the actual trigger vs the 'last straw'?",
                                    "What early warning signs did you miss (or ignore)?"
                                ],
                                tip: "This isn't about blame - it's about data. Your patterns have logic. Finding it helps you intervene earlier next time."
                            },
                            {
                                id: 'what-works',
                                name: 'Document What Works',
                                icon: 'üìù',
                                steps: [
                                    "Make a note of what's helped you feel good today",
                                    "Add any new strategies you've discovered",
                                    "Note what time of day you feel best",
                                    "Star the strategies that work consistently"
                                ],
                                tip: "Regulated you is your best coach. Capture wisdom while you have access to it."
                            }
                        ]
                    }
                ]
            },
            'hyper': {
                icon: 'üåÄ',
                name: 'Totally Overwhelmed',
                zone: 'Everything feels like too much right now',
                color: 'hyper',
                experience: "Your mind is racing. Thoughts spiral into worst-case scenarios. You might feel anxious, angry, panicked, or like you need to DO something RIGHT NOW. Everything feels urgent and catastrophic.",
                neurology: "You're stuck in rumination spirals - your Default Mode Network (internal processing) is in overdrive, generating catastrophic thinking loops. You can't access calm external focus because your nervous system is in fight-or-flight.",
                validation: "This is NOT a character flaw, Peri. Your nervous system is doing what it's designed to do under perceived threat. This is biology, not weakness.",
                categories: [
                    {
                        id: 'downregulate',
                        name: 'üåä Down-Regulate',
                        tools: [
                            {
                                id: 'physiological-sigh',
                                name: 'Physiological Sigh',
                                icon: 'ü´Å',
                                steps: [
                                    "Take a deep breath IN through your nose",
                                    "At the top, take a second small sip of air (this fully inflates lungs)",
                                    "Exhale slowly through your mouth - make it longer than the inhale",
                                    "Repeat 2-3 times. This directly activates your calming nervous system."
                                ],
                                tip: "This is the fastest evidence-based way to calm your nervous system. It works in 1-2 minutes because it's hitting biology directly."
                            },
                            {
                                id: 'cold-water',
                                name: 'Cold Water Reset',
                                icon: 'üíß',
                                steps: [
                                    "Run cold water over your wrists for 30 seconds",
                                    "Alternatively: splash cold water on your face",
                                    "Or: hold ice cubes in your hands",
                                    "Focus on the physical sensation - let it anchor you to NOW"
                                ],
                                tip: "Cold triggers your dive reflex, which automatically slows heart rate. It's a nervous system hack."
                            },
                            {
                                id: 'grounding-54321',
                                name: '5-4-3-2-1 Grounding',
                                icon: 'üëÅÔ∏è',
                                steps: [
                                    "Name 5 things you can SEE (say them out loud if possible)",
                                    "Name 4 things you can TOUCH/FEEL",
                                    "Name 3 things you can HEAR",
                                    "Name 2 things you can SMELL",
                                    "Name 1 thing you can TASTE"
                                ],
                                tip: "This forces your brain into external focus mode, breaking the rumination spiral."
                            }
                        ]
                    },
                    {
                        id: 'tornado',
                        name: 'üå™Ô∏è Stop the Tornado',
                        tools: [
                            {
                                id: 'thought-dump',
                                name: 'Catastrophe Dump',
                                icon: 'üìã',
                                steps: [
                                    "Grab paper or open notes. Set timer for 3 minutes.",
                                    "Write EVERYTHING your brain is saying. Don't filter. Let it out.",
                                    "When timer ends, STOP. Read it back.",
                                    "Circle the ONE thing that's actually about right now, today.",
                                    "Cross out anything about the future or 'what if'"
                                ],
                                tip: "Your racing thoughts FEEL urgent but most aren't about NOW. Getting them out lets you see that."
                            },
                            {
                                id: 'tornado-naming',
                                name: 'Name the Tornado',
                                icon: 'üè∑Ô∏è',
                                steps: [
                                    "Ask: 'What emotion is driving this spiral?'",
                                    "Name it specifically (not just 'anxious' - is it fear? Rejection? Shame?)",
                                    "Say out loud: 'I notice I'm feeling [X] right now'",
                                    "Add: 'This feeling is temporary. It will pass.'"
                                ],
                                tip: "Naming emotions activates your thinking brain, which helps regulate the fear centre."
                            }
                        ]
                    },
                    {
                        id: 'safety',
                        name: 'üè† Get to Safety',
                        tools: [
                            {
                                id: 'permission-slip',
                                name: 'Permission Slip',
                                icon: 'üìú',
                                steps: [
                                    "Read this: 'I am allowed to step back right now.'",
                                    "Read this: 'The world will not end if I don't respond/decide/fix this today.'",
                                    "Identify what you can DELAY by 24 hours",
                                    "Send a brief message if needed: 'I need to come back to this tomorrow.'"
                                ],
                                tip: "Your brain is telling you everything is urgent. It's lying. Almost nothing is as urgent as your nervous system thinks."
                            },
                            {
                                id: 'sensory-retreat',
                                name: 'Sensory Retreat',
                                icon: 'üßò',
                                steps: [
                                    "Find the quietest, dimmest space available to you",
                                    "Remove or reduce as many sensory inputs as possible",
                                    "Put on noise-cancelling headphones or earplugs",
                                    "Stay here until your heart rate noticeably drops"
                                ],
                                tip: "You're overstimulated. Your nervous system needs LESS input right now, not coping strategies."
                            }
                        ]
                    }
                ]
            },
            'hypo': {
                icon: 'üßä',
                name: 'Completely Flat',
                zone: 'Feeling numb and disconnected',
                color: 'hypo',
                experience: "You feel numb, empty, disconnected. It's hard to move or care about anything. You might feel frozen, exhausted beyond normal tired, or like you're watching life from behind glass. Everything feels pointless or too hard.",
                neurology: "Both your internal and external focus networks have gone offline as a protective shutdown. Your nervous system has decided the overwhelm is too much and has collapsed into freeze/flop response. This is 'last resort' protection mode.",
                validation: "This is NOT laziness, Peri. Your nervous system has hit its limit and is forcing a shutdown to protect you. Fighting it often makes it worse. Work WITH it.",
                categories: [
                    {
                        id: 'reactivate',
                        name: '‚ú® Gentle Reactivation',
                        tools: [
                            {
                                id: 'micro-movement',
                                name: 'Micro-Movements',
                                icon: 'üñêÔ∏è',
                                steps: [
                                    "Start with just your fingers - wiggle them slowly",
                                    "Move to your toes - curl and uncurl them",
                                    "Gently roll your ankles in circles",
                                    "If possible: slowly stretch your arms above your head",
                                    "Do NOT force big movements - tiny is enough"
                                ],
                                tip: "Movement tells your nervous system you're not actually paralysed. Start microscopic - success creates momentum."
                            },
                            {
                                id: 'sensory-wake',
                                name: 'Sensory Wake-Up',
                                icon: 'üëÉ',
                                steps: [
                                    "Find a strong (but pleasant) smell: coffee, peppermint, citrus",
                                    "Hold it close and breathe in deliberately",
                                    "Notice anything you feel in response",
                                    "Try a taste: something sour or spicy works well",
                                    "Let sensation create connection"
                                ],
                                tip: "Shutdown often includes sensory numbing. Strong (pleasant) sensory input can restart the connection."
                            },
                            {
                                id: 'temperature-shift',
                                name: 'Temperature Shift',
                                icon: 'üå°Ô∏è',
                                steps: [
                                    "Wrap yourself in a warm blanket OR",
                                    "Hold a warm drink (focus on the heat in your hands) OR",
                                    "Take a warm shower if you can manage it",
                                    "Let warmth signal safety to your nervous system"
                                ],
                                tip: "Warmth signals safety to the mammalian nervous system. It's a primal 'you're okay' signal."
                            }
                        ]
                    },
                    {
                        id: 'connection',
                        name: 'üîó Rebuild Connection',
                        tools: [
                            {
                                id: 'body-scan-gentle',
                                name: 'Gentle Body Check',
                                icon: 'ü´Ä',
                                steps: [
                                    "Ask yourself (without judgement): 'Where am I right now?'",
                                    "Notice your feet - are they cold? Warm? Can you feel them?",
                                    "Notice your hands - make fists, then release",
                                    "Put a hand on your chest - can you feel your heartbeat?",
                                    "You don't need to feel 'better' - just MORE"
                                ],
                                tip: "The goal isn't to feel good - it's to feel ANYTHING. Reconnecting to your body is the first step out."
                            },
                            {
                                id: 'anchor-object',
                                name: 'Anchor Object',
                                icon: 'ü™®',
                                steps: [
                                    "Find something with interesting texture (soft, rough, smooth)",
                                    "Hold it. Focus on exactly what it feels like.",
                                    "Notice weight, temperature, texture details",
                                    "This object is in the present. So are you."
                                ],
                                tip: "Shutdown disconnects you from the present moment. Physical objects anchor you back."
                            }
                        ]
                    },
                    {
                        id: 'rest',
                        name: 'üõèÔ∏è Permission to Rest',
                        tools: [
                            {
                                id: 'rest-is-valid',
                                name: 'This Is Not Laziness',
                                icon: 'üíú',
                                steps: [
                                    "Read this: 'My nervous system is protecting me.'",
                                    "Read this: 'Rest IS the work right now.'",
                                    "Read this: 'I am not failing by doing less.'",
                                    "Do the absolute minimum required today. That's enough."
                                ],
                                tip: "Fighting shutdown extends it. Sometimes the fastest way through is to actually rest. Your body knows what it needs, Peri."
                            },
                            {
                                id: 'bare-minimum',
                                name: 'Bare Minimum Protocol',
                                icon: '‚úÖ',
                                steps: [
                                    "Ask: 'What is the ONE thing that absolutely cannot wait?'",
                                    "Do only that. (Or delegate it.)",
                                    "Everything else can wait until you're feeling more like yourself.",
                                    "Send a message to anyone expecting more: 'I'm having a low capacity day.'"
                                ],
                                tip: "You are allowed to have low capacity days. They are not emergencies - they are part of being human."
                            }
                        ]
                    }
                ]
            },
            'dysreg-upper': {
                icon: 'üò§',
                name: 'Getting Wound Up',
                zone: 'Stress is building up',
                color: 'dysreg-upper',
                experience: "You can feel it building. Anxiety is creeping up, thoughts are starting to race, patience is thinning. You're not in crisis yet, but you can feel the escalation starting. Your window is narrowing.",
                neurology: "Your nervous system is beginning to mobilise for fight-or-flight, but you still have access to clear thinking. This is the CRITICAL intervention window - you can still think clearly enough to use tools. Once you tip over, it's much harder.",
                validation: "You noticed, Peri. That's huge. Most people only realise they're overwhelmed when they're already in crisis. Noticing early is a skill, and you're using it right now.",
                categories: [
                    {
                        id: 'early-intervene',
                        name: 'üéØ Early Intervention',
                        tools: [
                            {
                                id: 'pause-30',
                                name: '30-Second Pause',
                                icon: '‚è∏Ô∏è',
                                steps: [
                                    "Stop whatever you're doing. Right now.",
                                    "Take 3 slow breaths (in for 4, out for 6)",
                                    "Ask: 'What does my nervous system need right now?'",
                                    "Is it: Less input? Movement? Food? Connection? Space?"
                                ],
                                tip: "This tiny pause can prevent hours of distress. 30 seconds now saves 3 hours later."
                            },
                            {
                                id: 'stim-check',
                                name: 'Stimulation Audit',
                                icon: 'üìä',
                                steps: [
                                    "Quickly scan: Noise level? Light level? People around?",
                                    "Temperature okay? Hungry? Thirsty? Need the loo?",
                                    "How long since you moved? How long on screens?",
                                    "Fix ONE thing from this list immediately"
                                ],
                                tip: "Escalation often has a physical trigger hiding underneath it. Finding it can defuse the whole thing."
                            },
                            {
                                id: 'move-now',
                                name: 'Movement Discharge',
                                icon: 'üö∂',
                                steps: [
                                    "Stand up immediately (if sitting)",
                                    "Shake out your hands vigorously for 10 seconds",
                                    "Walk for 2 minutes - around the room, outside, anywhere",
                                    "Movement burns off the stress hormones building up"
                                ],
                                tip: "Fight-or-flight is meant for physical action. Give your body an outlet or it will escalate."
                            }
                        ]
                    },
                    {
                        id: 'expand',
                        name: 'üîÑ Expand Your Window',
                        tools: [
                            {
                                id: 'reduce-demand',
                                name: 'Demand Reduction',
                                icon: '‚ûñ',
                                steps: [
                                    "Look at the next 2 hours. What's scheduled?",
                                    "What can you cancel, postpone, or delegate?",
                                    "What can you do at 50% instead of 100%?",
                                    "Remove ONE thing from your plate right now"
                                ],
                                tip: "Your window is narrowing because demands exceed capacity. Reduce demands to widen the window."
                            },
                            {
                                id: 'comfort-anchor',
                                name: 'Comfort Anchor',
                                icon: 'üß∏',
                                steps: [
                                    "Identify something comforting you can access RIGHT NOW",
                                    "A favorite song? A texture? A photo? A smell?",
                                    "Engage with it for 2 minutes. No guilt.",
                                    "This isn't avoidance - it's regulation support."
                                ],
                                tip: "Your nervous system needs a safety signal. Familiar comfort items provide that signal efficiently."
                            }
                        ]
                    }
                ]
            },
            'dysreg-lower': {
                icon: 'üòî',
                name: 'Running on Empty',
                zone: 'Energy is draining away',
                color: 'dysreg-lower',
                experience: "You can feel yourself pulling away, disconnecting. Overwhelm is building but instead of speeding up, you're slowing down. Motivation is draining. Focus is fuzzing. You're starting to feel foggy.",
                neurology: "Your nervous system is beginning to move toward protective shutdown. You can still think and act, but the window is narrowing. Energy conservation mode is activating.",
                validation: "You caught this before full shutdown, Peri. That's awareness, not weakness. Your body is telling you something - probably that you've been running too hard for too long. This is a signal, not a failure.",
                categories: [
                    {
                        id: 'prevent-collapse',
                        name: 'üõü Prevent Collapse',
                        tools: [
                            {
                                id: 'gentle-activation',
                                name: 'Gentle Activation',
                                icon: 'üå∏',
                                steps: [
                                    "Do something that requires just a tiny bit of effort",
                                    "Make a cup of tea. Change your shirt. Open a window.",
                                    "The ACTION doesn't matter - the movement does",
                                    "Small accomplishment signals 'still capable' to your brain"
                                ],
                                tip: "The slide into shutdown often happens because of inertia. One small action creates friction."
                            },
                            {
                                id: 'novelty-dose',
                                name: 'Tiny Novelty Dose',
                                icon: 'üé≤',
                                steps: [
                                    "Change something in your environment - even tiny",
                                    "Move to a different chair. Change the lighting. Open a window.",
                                    "Put on different music or a podcast you like",
                                    "Novelty gently activates the brain without overwhelming it"
                                ],
                                tip: "Collapse is partly about everything feeling 'same same'. Tiny changes wake up your attention."
                            }
                        ]
                    },
                    {
                        id: 'meet-need',
                        name: 'üíß Meet the Underlying Need',
                        tools: [
                            {
                                id: 'body-basics',
                                name: 'Body Basics Check',
                                icon: 'üçé',
                                steps: [
                                    "When did you last eat? (not coffee - actual food)",
                                    "When did you last drink water?",
                                    "Have you been outside today?",
                                    "Fix the most obvious one. NOW."
                                ],
                                tip: "Collapse is often physical depletion in disguise. Your body isn't dramatic - it has needs."
                            },
                            {
                                id: 'social-ping',
                                name: 'Low-Effort Social Ping',
                                icon: 'üì±',
                                steps: [
                                    "Think of ONE person who feels safe",
                                    "Send them a simple message: 'Hey, thinking of you' or a meme",
                                    "You don't have to explain or perform",
                                    "Connection can be tiny and still count"
                                ],
                                tip: "Isolation accelerates collapse. One tiny connection can interrupt the spiral."
                            }
                        ]
                    }
                ]
            }
        };

        // ============================================
        // NEUROTRANSMITTER DATA
        // ============================================

        const NEUROTRANSMITTERS = {
            dopamine: {
                name: 'DOPAMINE',
                icon: 'üíó',
                color: '#E91E63',
                subtitle: 'The Motivation Molecule',
                description: 'Dopamine is what makes you feel motivated and rewarded. It\'s released when you achieve something, experience pleasure, or even just anticipate something exciting. It\'s basically your brain\'s "yes!" chemical.',
                symptoms: [
                    { icon: 'üò¥', text: 'Putting everything off?', tip: '‚úÖ Make a tiny to-do list (3 items max) and tick them off' },
                    { icon: 'üòî', text: 'Feeling rubbish about yourself?', tip: 'üé® Create something small - doodle, playlist, anything' },
                    { icon: 'üîã', text: 'Zero motivation?', tip: 'üéÆ Play a game where you can level up or complete tasks' },
                    { icon: '‚ö°', text: 'Constantly tired?', tip: 'üßÄ Eat some protein - cheese, eggs, nuts, meat' },
                    { icon: 'üéØ', text: 'Can\'t focus on anything?', tip: 'üéØ Set one tiny goal you can finish in 5 mins' },
                    { icon: 'üò∞', text: 'Anxious for no reason?', tip: 'üèÉ Move your body - even a short walk helps' },
                    { icon: 'üí≠', text: 'Everything feels pointless?', tip: '‚úÖ Do literally ONE small thing and celebrate it' },
                    { icon: 'üé≠', text: 'Mood all over the place?', tip: 'üßÄ When did you last eat properly? Protein helps stabilise' }
                ],
                tip: 'Break tasks into tiny chunks so you get more "done it!" moments. Tick things off a list - your brain literally loves that, Peri.'
            },
            oxytocin: {
                name: 'OXYTOCIN',
                icon: 'üß°',
                color: '#FF9800',
                subtitle: 'The Connection Chemical',
                description: 'Oxytocin is released when you bond with others - through hugs, laughing with friends, or even cuddling a pet. It makes you feel safe and connected.',
                symptoms: [
                    { icon: 'üò¢', text: 'Feeling lonely?', tip: 'üì± Send a voice note to someone you like' },
                    { icon: 'üòì', text: 'Stressed out?', tip: 'ü§ó Hug someone you trust (or a pillow/pet)' },
                    { icon: 'üîã', text: 'Can\'t be bothered with anything?', tip: 'üéÆ Play an online game with a friend' },
                    { icon: '‚ö°', text: 'Low energy?', tip: 'üêï Pet cuddles if you can - seriously effective' },
                    { icon: 'üíî', text: 'Feeling distant from people?', tip: 'üë• Do something side-by-side (watch, game, craft together)' },
                    { icon: 'üò∞', text: 'Anxious?', tip: 'üéµ Listen to music that gives you the feels' },
                    { icon: 'üò¥', text: 'Can\'t sleep properly?', tip: 'ü§ó Weighted blanket or tight hug before bed helps' }
                ],
                tip: 'If hanging out feels too much, try doing something side-by-side (gaming, watching something, crafting) instead of intense face-to-face chat. Pet time absolutely counts too!'
            },
            serotonin: {
                name: 'SEROTONIN',
                icon: 'üíô',
                color: '#2196F3',
                subtitle: 'The Chill Chemical',
                description: 'Serotonin keeps your mood stable and helps you feel confident and calm. It also helps you sleep properly and controls your appetite.',
                symptoms: [
                    { icon: 'üòî', text: 'Feeling rubbish about yourself?', tip: 'üìù Write down 3 things you did well today, even tiny ones' },
                    { icon: 'üíß', text: 'Everything feels like too much?', tip: 'üõÅ Warm bath or shower - let your body relax first' },
                    { icon: 'üò∞', text: 'Anxiety or panic?', tip: 'üéß Put on calming music and focus just on breathing' },
                    { icon: 'üé≠', text: 'Mood all over the place?', tip: 'üçå Have you eaten? Try banana, oats, or cheese' },
                    { icon: 'üí≠', text: 'Negative thoughts on repeat?', tip: 'üèÉ Move your body - even a 5 min walk helps break the loop' },
                    { icon: 'üë•', text: 'Dreading social stuff?', tip: '‚òÄÔ∏è Get 10 mins outside in daylight first - it genuinely helps' },
                    { icon: 'üîÑ', text: 'Can\'t stop overthinking?', tip: 'üìù Brain dump everything onto paper to get it out of your head' },
                    { icon: 'üò¥', text: 'Sleep is a mess?', tip: '‚òÄÔ∏è Morning light helps reset your body clock - even through clouds' }
                ],
                tip: 'Getting outside in morning light (even 10 mins) massively helps. And you don\'t need a gym - walking, dancing in your room, or stretching all count.'
            },
            endorphins: {
                name: 'ENDORPHINS',
                icon: 'üíö',
                color: '#4CAF50',
                subtitle: 'The Natural High',
                description: 'Endorphins are your body\'s natural feel-good chemicals. They\'re released when you exercise, laugh really hard, or do something exciting. They literally make pain feel less painful!',
                symptoms: [
                    { icon: 'üò∞', text: 'Feeling on edge?', tip: 'ü•∂ Splash cold water on your face - instant reset' },
                    { icon: 'üòî', text: 'Low mood?', tip: 'üòÇ Watch something that makes you properly laugh' },
                    { icon: 'üé≠', text: 'Mood swings?', tip: 'üíÉ Put on music and dance it out for 3 mins' },
                    { icon: 'ü§ï', text: 'Random aches and tension?', tip: 'üèÉ Any movement helps - stretch, walk, shake it off' },
                    { icon: 'üò¥', text: 'Tired but wired?', tip: 'üç´ Dark chocolate (seriously!) or something spicy' },
                    { icon: '‚ö°', text: 'Wanting to do something reckless?', tip: 'üéµ Blast your favorite songs loud - safer adrenaline hit' }
                ],
                tip: 'When you feel like doing something risky, your brain might just be hunting for endorphins. Try a safer hit: blast music, eat something spicy, dance it out, or splash cold water on your face!'
            }
        };

        // ============================================
        // STATE MANAGEMENT
        // ============================================

        let selectedState = null;
        let selectedNeuro = null;
        let userData = {
            favorites: [],
            triedTools: [],
            history: []
        };

        // Load saved data - unique key for Peri
        function loadUserData() {
            const saved = localStorage.getItem('peris_spark_data');
            if (saved) {
                userData = JSON.parse(saved);
            }
            updateQuickAccess();
            updateHistory();
        }

        function saveUserData() {
            localStorage.setItem('peris_spark_data', JSON.stringify(userData));
        }

        // State to chemical mappings
        const STATE_CHEMICAL_MAP = {
            'ignited': [
                { id: 'dopamine', why: 'Keep momentum' },
                { id: 'serotonin', why: 'Stay balanced' }
            ],
            'dysreg-upper': [
                { id: 'serotonin', why: 'Calm the mind' },
                { id: 'endorphins', why: 'Release tension' }
            ],
            'hyper': [
                { id: 'serotonin', why: 'Find calm' },
                { id: 'oxytocin', why: 'Feel safe' },
                { id: 'endorphins', why: 'Release stress' }
            ],
            'dysreg-lower': [
                { id: 'dopamine', why: 'Get motivated' },
                { id: 'oxytocin', why: 'Feel connected' }
            ],
            'hypo': [
                { id: 'dopamine', why: 'Spark interest' },
                { id: 'oxytocin', why: 'Feel connected' },
                { id: 'endorphins', why: 'Feel something' }
            ]
        };

        function getRecommendedChemicals(stateId) {
            const recommendations = STATE_CHEMICAL_MAP[stateId] || [];
            return recommendations.map(rec => ({
                ...rec,
                ...NEUROTRANSMITTERS[rec.id],
                color: NEUROTRANSMITTERS[rec.id].color
            }));
        }

        function goToChemical(chemicalId) {
            showSelector();
            setTimeout(() => {
                const card = document.querySelector(`.neuro-card.${chemicalId}`);
                if (card) {
                    card.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    card.classList.add('highlighted');
                    setTimeout(() => card.classList.remove('highlighted'), 2000);
                    selectNeuro(chemicalId);
                }
            }, 300);
        }

        // State selection
        function selectState(state) {
            selectedState = state;
            document.querySelectorAll('.state-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            document.querySelector(`.state-option.${state}`).classList.add('selected');
            document.getElementById('continueBtn').disabled = false;
        }

        // Show state detail
        function showStateDetail() {
            if (!selectedState) return;

            userData.history.unshift({
                state: selectedState,
                timestamp: new Date().toISOString()
            });
            userData.history = userData.history.slice(0, 10);
            saveUserData();

            document.getElementById('stateSelector').style.display = 'none';

            const state = STATES[selectedState];
            const detailDiv = document.getElementById('stateDetail');

            detailDiv.innerHTML = `
                <button class="back-btn" onclick="showSelector()">‚Üê Back to States</button>

                <div class="state-header ${state.color}">
                    <div class="icon">${state.icon}</div>
                    <h2>${state.name}</h2>
                    <div class="zone">${state.zone}</div>
                </div>

                <div class="explanation-section">
                    <div class="explanation-card">
                        <h4>üí≠ What you're experiencing</h4>
                        <p>${state.experience}</p>
                    </div>

                    <div class="explanation-card neurology">
                        <h4>üß† What's happening in your brain</h4>
                        <p>${state.neurology}</p>

                        <div class="brain-networks-explainer">
                            <button class="explainer-toggle" onclick="toggleExplainer(event)">
                                <span>‚ÑπÔ∏è What are DMN and TPN?</span>
                                <span class="icon">‚ñº</span>
                            </button>
                            <div class="explainer-content">
                                <div class="network-box dmn">
                                    <h5>üîÆ DMN - Default Mode Network</h5>
                                    <p><strong>Your internal processing mode.</strong> This network activates when you're:</p>
                                    <ul>
                                        <li>Reflecting on yourself or your life</li>
                                        <li>Thinking about others and relationships</li>
                                        <li>Daydreaming or imagining future scenarios</li>
                                        <li>Processing emotions and memories</li>
                                    </ul>
                                    <p style="margin-top: 8px;"><em>When overactive:</em> rumination spirals, overthinking, catastrophising</p>
                                </div>

                                <div class="network-box tpn">
                                    <h5>üéØ TPN - Task Positive Network</h5>
                                    <p><strong>Your external focus mode.</strong> This network activates when you're:</p>
                                    <ul>
                                        <li>Concentrating on a specific task</li>
                                        <li>Paying attention to the outside world</li>
                                        <li>Problem-solving in the present moment</li>
                                        <li>Taking deliberate action</li>
                                    </ul>
                                    <p style="margin-top: 8px;"><em>When overactive:</em> exhaustion, no time for reflection or rest</p>
                                </div>

                                <div class="explainer-summary">
                                    üí° <strong>The key:</strong> A regulated brain can switch smoothly between these networks. Feeling overwhelmed often means being stuck in one (rumination) or losing access to both (shutdown).
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="explanation-card validation">
                        <h4>üíú What you need to know</h4>
                        <p>${state.validation}</p>
                    </div>
                </div>

                <div class="intervention-section">
                    <h3>üß∞ Your ${state.name} Toolkit</h3>

                    <div class="intervention-categories" id="categoryTabs">
                        ${state.categories.map((cat, i) => `
                            <button class="category-tab ${i === 0 ? 'active' : ''}" onclick="selectCategory('${cat.id}')">
                                ${cat.name}
                            </button>
                        `).join('')}
                    </div>

                    <div class="intervention-list" id="interventionList">
                        ${renderTools(state.categories[0].tools)}
                    </div>
                </div>

                <div class="brain-link-section">
                    <h4>üß™ Your brain might need a top-up of...</h4>
                    <p>Based on how you're feeling, these chemicals could help:</p>
                    <div class="brain-link-buttons">
                        ${getRecommendedChemicals(selectedState).map(chem => `
                            <button class="brain-link-btn" onclick="goToChemical('${chem.id}')" style="border-color: ${chem.color}">
                                <span class="chem-icon">${chem.icon}</span>
                                <span class="chem-name">${chem.name}</span>
                                <span class="chem-why">${chem.why}</span>
                            </button>
                        `).join('')}
                    </div>
                </div>
            `;

            detailDiv.classList.add('active', 'fade-in');
            window.currentCategory = state.categories[0].id;
        }

        function renderTools(tools) {
            return tools.map(tool => {
                const isFav = userData.favorites.includes(tool.id);
                const isTried = userData.triedTools.includes(tool.id);

                return `
                    <div class="intervention-item" id="tool-${tool.id}" onclick="toggleTool('${tool.id}')">
                        <div class="intervention-header">
                            <h4>${tool.icon} ${tool.name}</h4>
                            <div class="intervention-actions" onclick="event.stopPropagation()">
                                <button class="fav-btn ${isFav ? 'active' : ''}" onclick="toggleFavourite('${tool.id}')" title="Add to favorites">
                                    ${isFav ? '‚≠ê' : '‚òÜ'}
                                </button>
                                <button class="tried-btn ${isTried ? 'active' : ''}" onclick="markTried('${tool.id}')" title="Mark as tried">
                                    ${isTried ? '‚úì' : '‚óã'}
                                </button>
                            </div>
                        </div>
                        <div class="intervention-content">
                            <ol class="intervention-steps">
                                ${tool.steps.map(step => `<li>${step}</li>`).join('')}
                            </ol>
                            <div class="intervention-tip">
                                üí° ${tool.tip}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function selectCategory(categoryId) {
            const state = STATES[selectedState];
            const category = state.categories.find(c => c.id === categoryId);

            document.querySelectorAll('.category-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');

            document.getElementById('interventionList').innerHTML = renderTools(category.tools);
            window.currentCategory = categoryId;
        }

        function toggleTool(toolId) {
            const element = document.getElementById('tool-' + toolId);
            element.classList.toggle('expanded');
        }

        function showSelector() {
            document.getElementById('stateDetail').classList.remove('active');
            document.getElementById('stateDetail').innerHTML = '';
            document.getElementById('stateSelector').style.display = 'block';
            selectedState = null;
            document.getElementById('continueBtn').disabled = true;
            document.querySelectorAll('.state-option').forEach(opt => opt.classList.remove('selected'));
            updateHistory();
        }

        // Favourites and tracking
        function toggleFavourite(toolId) {
            const index = userData.favorites.indexOf(toolId);
            if (index > -1) {
                userData.favorites.splice(index, 1);
            } else {
                userData.favorites.push(toolId);
            }
            saveUserData();

            const state = STATES[selectedState];
            const category = state.categories.find(c => c.id === window.currentCategory);
            document.getElementById('interventionList').innerHTML = renderTools(category.tools);

            updateQuickAccess();
        }

        function markTried(toolId) {
            if (!userData.triedTools.includes(toolId)) {
                userData.triedTools.push(toolId);
                saveUserData();

                const state = STATES[selectedState];
                const category = state.categories.find(c => c.id === window.currentCategory);
                document.getElementById('interventionList').innerHTML = renderTools(category.tools);
            }
        }

        function updateQuickAccess() {
            const container = document.getElementById('quickAccess');
            const list = document.getElementById('favoritesList');

            if (userData.favorites.length === 0) {
                container.style.display = 'none';
                return;
            }

            container.style.display = 'flex';

            list.innerHTML = userData.favorites.map(favId => {
                let toolName = favId;
                for (const state of Object.values(STATES)) {
                    for (const cat of state.categories) {
                        const tool = cat.tools.find(t => t.id === favId);
                        if (tool) {
                            toolName = tool.icon + ' ' + tool.name;
                            break;
                        }
                    }
                }
                return `<span class="quick-fav" onclick="jumpToFav('${favId}')">${toolName}</span>`;
            }).join('');
        }

        function jumpToFav(toolId) {
            for (const [stateId, state] of Object.entries(STATES)) {
                for (const cat of state.categories) {
                    const tool = cat.tools.find(t => t.id === toolId);
                    if (tool) {
                        selectedState = stateId;
                        showStateDetail();
                        setTimeout(() => {
                            selectCategory(cat.id);
                            setTimeout(() => {
                                toggleTool(toolId);
                                document.getElementById('tool-' + toolId).scrollIntoView({ behavior: 'smooth' });
                            }, 100);
                        }, 100);
                        return;
                    }
                }
            }
        }

        function updateHistory() {
            const section = document.getElementById('historySection');
            const list = document.getElementById('historyList');

            if (userData.history.length === 0) {
                section.style.display = 'none';
                return;
            }

            section.style.display = 'block';

            list.innerHTML = userData.history.slice(0, 5).map(item => {
                const state = STATES[item.state];
                const date = new Date(item.timestamp);
                const timeAgo = getTimeAgo(date);

                return `
                    <div class="history-item">
                        <span class="state-badge ${state.color}">${state.icon} ${state.name}</span>
                        <span style="flex: 1;"></span>
                        <span style="color: #888; font-size: 0.85em;">${timeAgo}</span>
                    </div>
                `;
            }).join('');
        }

        function getTimeAgo(date) {
            const seconds = Math.floor((new Date() - date) / 1000);

            if (seconds < 60) return 'Just now';
            if (seconds < 3600) return Math.floor(seconds / 60) + ' mins ago';
            if (seconds < 86400) return Math.floor(seconds / 3600) + ' hours ago';
            if (seconds < 604800) return Math.floor(seconds / 86400) + ' days ago';
            return date.toLocaleDateString('en-US');
        }

        // ============================================
        // NEUROTRANSMITTER FUNCTIONS
        // ============================================

        function selectNeuro(neuroId) {
            selectedNeuro = neuroId;
            const neuro = NEUROTRANSMITTERS[neuroId];

            document.querySelectorAll('.neuro-card').forEach(card => {
                card.classList.remove('selected');
            });
            document.querySelector(`.neuro-card.${neuroId}`).classList.add('selected');

            const detailDiv = document.getElementById('neuroDetail');
            detailDiv.innerHTML = `
                <h4 style="color: ${neuro.color}; display: flex; align-items: center; gap: 10px;">
                    <span style="font-size: 1.5em;">${neuro.icon}</span>
                    ${neuro.name} - ${neuro.subtitle}
                </h4>
                <p style="color: #555; margin-bottom: 20px; line-height: 1.6;">${neuro.description}</p>

                <div class="symptom-checker">
                    <h5>ü§î Tick what you're feeling right now...</h5>
                    ${neuro.symptoms.map((item, index) => `
                        <div class="symptom-item" onclick="toggleSymptom(this)">
                            <div class="symptom-checkbox">‚úì</div>
                            <div class="symptom-content">
                                <div class="symptom-label">
                                    <span>${item.icon}</span>
                                    <span>${item.text}</span>
                                </div>
                                <div class="symptom-tip">
                                    <div class="tip-label">üí° Try this:</div>
                                    ${item.tip}
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>

                <div style="margin-top: 20px; padding: 15px; background: linear-gradient(135deg, #faf5ff 0%, #e9d5ff 100%); border-radius: 10px; border-left: 4px solid #8b5cf6;">
                    <h5 style="color: #6d28d9; margin-bottom: 8px; font-size: 0.9em;">üíú Pro Tip</h5>
                    <p style="color: #5b21b6; font-size: 0.9em; margin: 0; line-height: 1.6;">${neuro.tip}</p>
                </div>
            `;

            detailDiv.classList.add('active');
            detailDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        function toggleSymptom(element) {
            element.classList.toggle('checked');
        }

        function toggleExplainer(event) {
            event.stopPropagation();
            const toggle = event.currentTarget;
            const content = toggle.nextElementSibling;
            toggle.classList.toggle('open');
            content.classList.toggle('open');
        }

        // ============================================
        // BRAIN DUMP FUNCTIONS (Lightweight)
        // ============================================

        let saveTimeout = null;

        function loadBrainDump() {
            const saved = localStorage.getItem('peris_brain_dump');
            if (saved) {
                document.getElementById('brainDump').value = saved;
            }
        }

        function autoSaveBrainDump() {
            const status = document.getElementById('saveStatus');
            status.textContent = '‚è≥ Saving...';
            status.classList.add('saving');

            if (saveTimeout) {
                clearTimeout(saveTimeout);
            }

            saveTimeout = setTimeout(() => {
                const content = document.getElementById('brainDump').value;
                localStorage.setItem('peris_brain_dump', content);
                status.textContent = '‚úì Saved';
                status.classList.remove('saving');
            }, 500);
        }

        function clearBrainDump() {
            const content = document.getElementById('brainDump').value.trim();

            if (content === '') {
                return;
            }

            if (confirm('Clear everything? This cannot be undone.')) {
                document.getElementById('brainDump').value = '';
                localStorage.removeItem('peris_brain_dump');
                document.getElementById('saveStatus').textContent = '‚úì Cleared';
            }
        }

        // ============================================
        // JOURNAL FUNCTIONS
        // ============================================

        let journalEntries = [];
        let journalSaveTimeout = null;

        function loadJournalData() {
            const saved = localStorage.getItem('peris_journal_entries');
            if (saved) {
                journalEntries = JSON.parse(saved);
            }

            const currentEntry = localStorage.getItem('peris_journal_current');
            if (currentEntry) {
                document.getElementById('journalEntry').value = currentEntry;
            }

            updatePastEntries();
        }

        function insertPrompt(prompt) {
            const textarea = document.getElementById('journalEntry');
            const currentValue = textarea.value;

            if (currentValue.trim() === '') {
                textarea.value = prompt + ' ';
            } else {
                textarea.value = currentValue + '\n\n' + prompt + ' ';
            }

            textarea.focus();
            autoSaveJournal();
        }

        function autoSaveJournal() {
            const status = document.getElementById('journalStatus');
            status.textContent = '‚è≥ Saving...';

            if (journalSaveTimeout) {
                clearTimeout(journalSaveTimeout);
            }

            journalSaveTimeout = setTimeout(() => {
                const entry = document.getElementById('journalEntry').value;
                localStorage.setItem('peris_journal_current', entry);
                status.textContent = '‚úì Auto-saved';
            }, 500);
        }

        function saveJournalEntry() {
            const entry = document.getElementById('journalEntry').value.trim();

            if (entry === '') {
                return;
            }

            journalEntries.unshift({
                text: entry,
                timestamp: new Date().toISOString()
            });
            journalEntries = journalEntries.slice(0, 20);
            localStorage.setItem('peris_journal_entries', JSON.stringify(journalEntries));

            document.getElementById('journalEntry').value = '';
            localStorage.removeItem('peris_journal_current');
            document.getElementById('journalStatus').textContent = '‚úì Entry saved!';

            updatePastEntries();
        }

        function togglePastEntries() {
            const toggle = document.querySelector('.entries-toggle');
            const list = document.getElementById('entriesList');

            toggle.classList.toggle('open');
            list.classList.toggle('open');
        }

        function updatePastEntries() {
            const container = document.getElementById('pastEntries');
            const list = document.getElementById('entriesList');

            if (journalEntries.length === 0) {
                container.style.display = 'none';
                return;
            }

            container.style.display = 'block';

            list.innerHTML = journalEntries.map((entry, index) => {
                const date = new Date(entry.timestamp);
                const dateStr = date.toLocaleDateString('en-US', {
                    month: 'short',
                    day: 'numeric',
                    hour: 'numeric',
                    minute: '2-digit'
                });

                const displayText = entry.text.length > 200
                    ? entry.text.substring(0, 200) + '...'
                    : entry.text;

                return `
                    <div class="entry-card">
                        <button class="entry-delete" onclick="deleteEntry(${index})" title="Delete">√ó</button>
                        <div class="entry-date">${dateStr}</div>
                        <div class="entry-text">${escapeHtml(displayText)}</div>
                    </div>
                `;
            }).join('');
        }

        function deleteEntry(index) {
            if (confirm('Delete this entry?')) {
                journalEntries.splice(index, 1);
                localStorage.setItem('peris_journal_entries', JSON.stringify(journalEntries));
                updatePastEntries();
            }
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Set up auto-save on typing
        document.addEventListener('DOMContentLoaded', function() {
            const brainDump = document.getElementById('brainDump');
            if (brainDump) {
                brainDump.addEventListener('input', autoSaveBrainDump);
            }

            const journal = document.getElementById('journalEntry');
            if (journal) {
                journal.addEventListener('input', autoSaveJournal);
            }
        });

        // Initialize
        loadUserData();
        loadBrainDump();
        loadJournalData();

        // Update greeting based on time
        function updateGreeting() {
            const hour = new Date().getHours();
            let greeting = 'Hey Peri';

            if (hour < 12) {
                greeting = 'Good morning, Peri';
            } else if (hour < 17) {
                greeting = 'Good afternoon, Peri';
            } else {
                greeting = 'Good evening, Peri';
            }

            document.getElementById('greeting').textContent = greeting + ' üíú';
        }

        updateGreeting();
    </script>
</body>
</html>
